{"config":{"lang":["fr"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Introduction","text":""},{"location":"#documentation-pedagogique","title":"Documentation p\u00e9dagogique","text":"<p>Bienvenue dans cette documentation p\u00e9dagogique g\u00e9n\u00e9r\u00e9e automatiquement \u00e0 l'aide de MkDocs et h\u00e9berg\u00e9e sur GitHub Pages. Cette documentation a \u00e9t\u00e9 cr\u00e9\u00e9e dans le but de vous fournir Les informations essentielles sur le contexte commun utilis\u00e9 avec vos enseignants dans les bloc 2 et 3 du BTS SIO SISR 2.</p> <p>Cette production est librement inspir\u00e9e de celle de Ludovic Mery, professeur d'informatique en BTS SIO au lyc\u00e9e Fulbert de Chartres.</p>"},{"location":"#comment-utiliser-cette-documentation","title":"Comment utiliser cette documentation","text":"<ul> <li> <p>Navigation : Utilisez la barre de navigation sur la gauche pour acc\u00e9der aux diff\u00e9rentes sections de la documentation. Cliquez sur les liens pour explorer les sujets qui vous int\u00e9ressent.</p> </li> <li> <p>Recherche : Si vous recherchez des informations sp\u00e9cifiques, utilisez la fonction de recherche en haut de la page pour trouver rapidement ce dont vous avez besoin.</p> </li> <li> <p>Contributions et Corrections : Cette documentation est h\u00e9berg\u00e9e sur GitHub. Si vous identifiez des erreurs, des inexactitudes ou si vous souhaitez contribuer en ajoutant du contenu, vous \u00eates invit\u00e9 \u00e0 soumettre des Pull Requests.</p> </li> </ul>"},{"location":"#hebergement-sur-github-pages","title":"H\u00e9bergement sur GitHub Pages","text":"<p>Cette documentation est automatiquement mise en ligne gr\u00e2ce \u00e0 GitHub Pages, une fonctionnalit\u00e9 de GitHub qui permet de publier facilement du contenu statique. Chaque fois que des modifications sont apport\u00e9es \u00e0 la documentation et pouss\u00e9es vers la branche principale du d\u00e9p\u00f4t (main), les GitHub Actions sont d\u00e9clench\u00e9es pour g\u00e9n\u00e9rer et d\u00e9ployer automatiquement les changements dans la documentation \u00e0 chaque \"Push\". Ce principe d'automatisation s'apparente \u00e0 une approche CI/CD.</p> CI/CD <p>CI/CD est l'acronyme de Continuous Integration (Int\u00e9gration Continue) et Continuous Delivery (Livraison Continue) ou Continuous Deployment (D\u00e9ploiement Continu). Ces pratiques sont utilis\u00e9es dans le d\u00e9veloppement logiciel et la culture DevOps pour am\u00e9liorer la qualit\u00e9 du code et acc\u00e9l\u00e9rer le processus de livraison des logiciels. Voici une d\u00e9finition rapide de chaque terme : -    Continuous Integration (CI) : Pratique consistant \u00e0 int\u00e9grer r\u00e9guli\u00e8rement les modifications de code dans un d\u00e9p\u00f4t central, g\u00e9n\u00e9ralement plusieurs fois par jour. Cela permet de d\u00e9tecter les erreurs t\u00f4t gr\u00e2ce \u00e0 des tests automatis\u00e9s qui v\u00e9rifient chaque int\u00e9gration. -    Continuous Delivery (CD) : Pratique qui \u00e9tend CI en automatisant le processus de livraison du code jusqu'\u00e0 un environnement de staging ou de pr\u00e9-production. Cela permet de garantir que le code est toujours pr\u00eat \u00e0 \u00eatre d\u00e9ploy\u00e9 en production \u00e0 tout moment. -    Continuous Deployment (CD) : Variante de Continuous Delivery o\u00f9 le code est automatiquement d\u00e9ploy\u00e9 en production d\u00e8s qu'il passe les tests automatis\u00e9s. Cela permet des mises \u00e0 jour fr\u00e9quentes et rapides en production. Ces pratiques favorisent une approche agile et r\u00e9active, r\u00e9duisent les risques et am\u00e9liorent la qualit\u00e9 du produit final.</p>"},{"location":"#outils-de-documentation","title":"Outils de documentation","text":"<p>Il existe de nombreux outils d\u00e9di\u00e9s \u00e0 la documentation. Nous vous sugg\u00e9rons d'utiliser mkdocs.</p> <p>L'ensemble des situations auxquelles vous allez \u00eatre confront\u00e9s cette ann\u00e9e devra etre document\u00e9 avec cet outil et heberg\u00e9 via github pages et un compte GitHub. Vous veuillerez \u00e0 transmettre \u00e0 vos enseignants l'URL de la documentation et \u00e0 la publier sur votre Portfolio.</p> <p>Si vous souhaitez utiliser d'autres outils similaires \u00e0 mkdocs, cela reste bien \u00e9videmment envisageable.</p> mkdocsDocusaurus Sphinx <pre><code>https://squidfunk.github.io/mkdocs-material/publishing-your-site/\n</code></pre> <pre><code>https://docusaurus.io/fr/docs/\n</code></pre> <pre><code>https://www.sphinx-doc.org/en/master/usage/installation.html\n</code></pre>"},{"location":"#a-propos-de-la-documentation-stormshield","title":"\u00c0 propos de la documentation Stormshield","text":"<p>L'int\u00e9gralit\u00e9 des fiches techniques Stormshield pr\u00e9sentes sur ce site est issue de la production Mise en oeuvre d'une gestion unifi\u00e9e des menaces informatiques propos\u00e9e dans le cadre du r\u00e9seau Certa par Quentin Demouli\u00e8re et Apollonie Raffalli.</p> <p>Le travail important de mise en forme au format Markdown a \u00e9t\u00e9 r\u00e9alis\u00e9 par Ludovic Mery.</p>"},{"location":"contexte/01-presentation/","title":"Pr\u00e9sentation du contexte CUB","text":"<p>N\u00e9e en d\u00e9cembre 2010, la soci\u00e9t\u00e9 CUB est une entreprise sp\u00e9cialis\u00e9e dans l\u2019incubation de startups partageant les m\u00eames valeurs de solidarit\u00e9 et de d\u00e9veloppement durable. Au travers de sa plate-forme web, CUB permet \u00e0 des professionnels d\u2019acc\u00e9der \u00e0 des espaces de travail d\u00e9di\u00e9s\u00a0: salles de r\u00e9union, de formation ou de s\u00e9minaire.</p> <p>Chaque agence disposera d\u2019une adresse IPv4 publique propre et nominative. Pour cela, l\u2019entreprise CUB a demand\u00e9 aupr\u00e8s du RIPE NCC l\u2019obtention d\u2019un num\u00e9ro d\u2019AS et d\u2019un pr\u00e9fixe IPv4\u00a0: 192.36.0.0/16. Elle est donc consid\u00e9r\u00e9e comme un LIR (Local Internet Registry). De plus, l\u2019entreprise poss\u00e8de \u00e9galement un nom de domaine cub.sioplc.fr dont elle a la charge g\u00e9r\u00e9 par le bureau d\u2019enregistrement OVH.</p> <p>CUB met \u00e0 disposition de ses clients un ensemble de solutions techniques d\u2019acc\u00e8s dans un millier de salles de r\u00e9union situ\u00e9es dans une quarantaine de villes diff\u00e9rentes. Les ressources et outils du Web\u00a02.0 qui permettent aux entreprises de g\u00e9rer leurs contenus et leurs connaissances de mani\u00e8re s\u00e9curis\u00e9e sont accessibles ind\u00e9pendamment via des prestataires de type informatique dans les nuages (cloud computing)\u00a0: partage de fichiers, gestion de projet, r\u00e9seau social d\u2019entreprise, wiki d\u2019entreprise, etc.</p> <p>Le si\u00e8ge social de CUB est situ\u00e9 \u00e0 Paris, des agences sont implant\u00e9es dans plusieurs grandes villes internationales\u00a0: Anvers, Barcelone, Hong-Kong, Los Angeles et en Corse.</p> <p>La direction des syst\u00e8mes d\u2019information (DSI), situ\u00e9e \u00e0 Paris, participe \u00e9troitement aux choix strat\u00e9giques de CUB, elle a pour mission de d\u00e9finir et mettre en \u0153uvre la politique informatique en accord avec la strat\u00e9gie g\u00e9n\u00e9rale et ses objectifs de performance. </p> <p>Le si\u00e8ge social est le c\u0153ur du syst\u00e8me d\u2019information interne de CUB, mais un service informatique de proximit\u00e9 (SIP) est pr\u00e9sent sur chaque agence. Le SIP est responsable de l\u2019assistance aux utilisateurs locaux et de la maintenance des ressources locales (infrastructure r\u00e9seau et serveurs). Le SIP prend \u00e9galement en charge des projets qui concernent ponctuellement leur site.</p>"},{"location":"contexte/02-schemas/","title":"Sch\u00e9mas r\u00e9seaux de l'entreprise CUB","text":"<p>L'entreprise CUB dispose d'une infrastructure complexe avec un site central et diff\u00e9rentes agences interconnect\u00e9es. De plus, cette infrastructure est transpos\u00e9e dans le laboratoire SISR 2 du BTS SIO. Ainsi, il est indispensable de disposer de ces informations afin d'avoir une vue compl\u00e8te et pr\u00e9cise de l'architecture.</p>"},{"location":"contexte/02-schemas/#schema-reseau-physique","title":"Sch\u00e9ma r\u00e9seau physique","text":""},{"location":"contexte/02-schemas/#schema-reseau-logique","title":"Sch\u00e9ma r\u00e9seau logique","text":""},{"location":"contexte/03-infra/","title":"Description de l'infrastructure","text":""},{"location":"contexte/03-infra/#plan-dadressage-ipv4-de-lentreprise","title":"Plan d'adressage IPv4 de l'entreprise","text":"Structure Adresses            de sous-r\u00e9seaux Adresses            IP des pare-feux Agence          Anvers LAN 1 \u2013 192.168.1.0/24               R1-FW1             \u2013 192.168.11.252/30              DMZ            1 \u2013 192.36.1.0/24            WAN            \u2013 192.36.253.0/24 In :            192.168.11.254               DMZ :          192.36.1.254             Out :          192.36.253.10 Agence          Barcelone LAN             2 \u2013 192.168.2.0/24               R2-FW2             \u2013 192.168.22.252/30              DMZ            2 \u2013 192.36.2.0/24            WAN            \u2013 192.36.253.0/24 In :            192.168.22.254               DMZ :          192.36.2.254             Out :          192.36.253.20 Agence          Californie LAN             3 \u2013 192.168.3.0/24               R3-FW3             \u2013 192.168.33.252/30              DMZ            3 \u2013 192.36.3.0/24            WAN            \u2013 192.36.253.0/24 In :            192.168.33.254               DMZ :          192.36.3.254             Out :          192.36.253.30 Agence          Dortmund LAN             7 \u2013 192.168.4.0/24               R4-FW4             \u2013 192.168.44.252/30              DMZ            7 \u2013 192.36.4.0/24            WAN            \u2013 192.36.253.0/24 In :            192.168.44.254               DMZ :          192.36.4.254             Out :          192.36.253.40 Agence          Edimbourg LAN             5 \u2013 192.168.5.0/24               R5-FW5             \u2013 192.168.55.252/30              DMZ            5 \u2013 192.36.5.0/24            WAN            \u2013 192.36.253.0/24 In :            192.168.55.254               DMZ :          192.36.5.254             Out :          192.36.253.50 Agence          Frankfurt LAN             6 \u2013 192.168.6.0/24               R6-FW6             \u2013 192.168.66.252/30              DMZ            6 \u2013 192.36.6.0/24            WAN            \u2013 192.36.253.0/24 In :            192.168.66.254               DMZ :          192.36.6.254             Out :          192.36.253.60 Agence          Galway LAN             4 \u2013 192.168.7.0/24               R7-FW7             \u2013 192.168.77.252/30              DMZ            4 \u2013 192.36.7.0/24            WAN            \u2013 192.36.253.0/24 In :            192.168.77.254               DMZ :          192.36.7.254             Out :          192.36.253.70 Agence          Hong-Kong LAN             8 \u2013 192.168.8.0/24               R8-FW8             \u2013 192.168.88.252/30              DMZ            8 \u2013 192.36.8.0/24            WAN            \u2013 192.36.253.0/24 In :            192.168.88.254               DMZ :          192.36.8.254             Out :          192.36.253.80 Si\u00e8ge           CUB LAN             Si\u00e8ge \u2013 192.168.20.0/24              RS-FWS             \u2013 192.168.201.252/30             DMZ            Si\u00e8ge \u2013 192.36.250.0/24              WAN            \u2013 192.36.253.0/24            P\u00e9dago             \u2013 172.16.28.0/22 In :            192.168.20.254               DMZ :          192.36.250.254               WAN :          192.36.253.254               Out :          172.16.29.199"},{"location":"contexte/03-infra/#liste-des-serveurs-presents-sur-le-site-du-siege","title":"Liste des serveurs pr\u00e9sents sur le site du si\u00e8ge","text":"Serveur Configuration r\u00e9seau Description ns0.cub.sioplc.fr IP : 192.36.250.10/24 Passerelle : 192.36.250.254 DNS : 172.16.20.11, 9.9.9.9 Serveur DNS ma\u00eetre faisant autorit\u00e9 sur le domaine cub.sioplc.fr. ns1.cub.sioplc.fr IP : 192.36.250.11/24 Passerelle : 192.36.250.254 DNS : 172.16.20.11, 9.9.9.9 Serveur DNS esclave faisant autorit\u00e9 sur le domaine cub.sioplc.fr. www.cub.sioplc.fr IP : 192.36.250.20/24 Passerelle : 192.36.250.254 DNS : 172.16.20.11, 9.9.9.9 Serveur web vitrine de l\u2019entreprise CUB"},{"location":"contexte/03-infra/#description-des-services-presents-dans-le-reseau-local-de-chaque-agence","title":"Description des services pr\u00e9sents dans le r\u00e9seau local de chaque agence","text":"Intitul\u00e9 des services Description VLAN Nombre d\u2019h\u00f4tes par service Production VLAN 5X 60 h\u00f4tes Client 1 VLAN 10 16 h\u00f4tes Administration syst\u00e8mes et r\u00e9seaux VLAN 20 3 h\u00f4tes <p>NB\u00a0: L'\u00e9volution du r\u00e9seau est un \u00e9l\u00e9ment primordial \u00e0 prendre en compte. Ainsi, en cas de d\u00e9coupage r\u00e9seau, il est indispensable de pr\u00e9voir un plan d'adressage capable d'accueillir au minimum le double d'\u00e9quipements par rapport au recensement initial afin d'\u00e9viter toute possibilit\u00e9 de saturation.</p>"},{"location":"contexte/03-infra/#administration-des-equipements-reseaux","title":"Administration des \u00e9quipements r\u00e9seaux","text":"Mat\u00e9riel Administration Description fw.local.agence.cub.sioplc.fr 192.168.XX.254/30 depuis 192.168.X.192/28 uniquement Le pare-feu de l\u2019agence doit \u00eatre administr\u00e9 uniquement sur son interface IN (r\u00e9seau d\u2019interco) depuis le VLAN d\u2019Administration. sw0.local.agence.cub.sioplc.fr 192.168.X.205/28 depuis 192.168.X.192/28 uniquement Le switch c\u0153ur de r\u00e9seau L3 doit disposer d\u2019une configuration r\u00e9seau dans le VLAN d\u2019Administration uniquement et \u00eatre administr\u00e9 depuis ce VLAN. sw1.local.agence.cub.sioplc.fr 192.168.X.204/28 depuis 192.168.X.192/28 uniquement Le switch de distribution doit disposer d\u2019une configuration r\u00e9seau dans le VLAN d\u2019Administration uniquement et \u00eatre administr\u00e9 depuis ce VLAN."},{"location":"contexte/03-infra/#gestion-des-ports-sur-les-commutateurs","title":"Gestion des ports sur les commutateurs","text":"Ports des commutateurs Attribution Les ports 1 \u00e0 10 R\u00e9serv\u00e9s aux \u00e9quipements dit \u00ab terminaux \u00bb (PC, t\u00e9l\u00e9phone, PC portable). Les ports de 11 \u00e0 18 R\u00e9serv\u00e9s aux serveurs Les ports de 19 \u00e0 24 R\u00e9serv\u00e9s \u00e0 l\u2019interconnexion avec d\u2019autres \u00e9quipements r\u00e9seaux (commutateurs, routeurs, pare-feu, borne-wifi). <p>Pourquoi cette approche ?</p> <p>L\u2019int\u00e9r\u00eat d\u2019appliquer une telle m\u00e9thodologie est d\u2019avoir une rigueur dans l\u2019organisation du r\u00e9seau permettant de savoir tr\u00e8s rapidement rep\u00e9rer la fonction d\u2019un port sur un commutateur.</p>"},{"location":"contexte/bonnespratiques/","title":"R\u00e9f\u00e9rentiel d\u00e9fini par la DSI","text":""},{"location":"contexte/bonnespratiques/#quest-ce-quun-referentiel","title":"Qu'est-ce qu'un r\u00e9f\u00e9rentiel ?","text":"<p>Un r\u00e9f\u00e9rentiel est une collection de bonnes pratiques sur un sujet donn\u00e9. Lorsqu'il fait l'objet d'une large diffusion et qu'il est reconnu par le march\u00e9, on parle alors de standard. Les r\u00e9f\u00e9rentiels sont donc des bo\u00eetes \u00e0 outils permettant d'extraire la bonne pratique dont on a besoin.</p> <p>ex: ITIL 4, Guides de recommandation de l'ANSSI, COBIT.</p> <p>La norme se diff\u00e9rencie des r\u00e9f\u00e9rentiels dans la mesure o\u00f9 il s'agit d'un document \u00e9dit\u00e9 par une instance de normalisation ind\u00e9pendante faisant \u00e9tat de l'art d'un sujet donn\u00e9. La norme peut aussi avoir un niveau de contrainte suppl\u00e9mentaire par rapport au r\u00e9f\u00e9rentiel. Elle peut enfin amener une entreprise \u00e0 \u00eatre certifi\u00e9e via un audit r\u00e9alis\u00e9 par un organisme ind\u00e9pendant. C'est l'AFNOR qui assure les certifications en France.<sup>1</sup></p> <p>ex: ISO-9001, ISO-27001.</p> <p>Attention !</p> <p>La DSI impose donc \u00e0 l'ensemble de son personnel de respecter le r\u00e9f\u00e9rentiel pr\u00e9sent\u00e9 ci-dessous</p>"},{"location":"contexte/bonnespratiques/#extrait-des-bonnes-pratiques-reseaux","title":"Extrait des bonnes pratiques r\u00e9seaux","text":"<ol> <li>R\u00e9alisez OBLIGATOIREMENT un sch\u00e9ma physique et un sch\u00e9ma logique du r\u00e9seau de votre agence (\u00e0 imprimer).</li> <li>Respectez le processus suivant : maquettage, prototypage, mise en production.</li> <li>Une maquette sous le simulateur Packet Tracer doit obligatoirement \u00eatre valid\u00e9e individuellement avant la phase de prototypage.</li> <li>Pour r\u00e9duire les risques Cyber, il est n\u00e9cessaire de proc\u00e9der \u00e0 un d\u00e9coupage du SI administr\u00e9 en zones diff\u00e9renci\u00e9es en appliquant le principe du moindre privil\u00e8ge.</li> <li>Les fichiers de configuration de tous vos \u00e9quipements r\u00e9seaux devront \u00eatre sauvegard\u00e9s.</li> <li>Les r\u00e8gles de filtrage d\u00e9finies en production doivent \u00eatre maintenues. Elles ne peuvent \u00eatre d\u00e9sactiv\u00e9es que lors d'op\u00e9rations de test ou de diagnostic.</li> </ol>"},{"location":"contexte/bonnespratiques/#extrait-des-bonnes-pratiques-systemes","title":"Extrait des bonnes pratiques syst\u00e8mes","text":"<ol> <li>Sur vos serveurs Debian GNU/Linux, il est obligatoire de mettre en place une gestion de version de vos fichiers de configuration \u00e0 l'aide du logiciel etckeeper.</li> </ol>"},{"location":"contexte/bonnespratiques/#hygiene-numerique","title":"Hygi\u00e8ne num\u00e9rique","text":"<ol> <li>Les mots de passe de chaque \u00e9quipe doivent \u00eatre stock\u00e9s dans un gestionnaire de mots de passe accessible par l'ensemble de l'\u00e9quipe (Bitwarden, LastPass, KeePass, etc).</li> <li>Les connexions administrateur aux serveurs de chaque agence devront se faire via une authentification multifacteur \u00e0 l'aide d'un mot de passe et d'un code \u00e0 usage unique TOTP (utilisation des smartphones avec une application d\u00e9di\u00e9e type FreeOTP+).</li> </ol> <ol> <li> <p>Les r\u00e9f\u00e9rentiels de la DSI, \u00e9tat de l'art, usages et bonnes pratiques publi\u00e9 par le CIGREF\u00a0\u21a9</p> </li> </ol>"},{"location":"documentation/DNS/1--Pr%C3%A9ambule/","title":"Introduction","text":""},{"location":"documentation/DNS/1--Pr%C3%A9ambule/#1-preambule","title":"1. Pr\u00e9ambule","text":"<p>Attention</p> <p>Ces annexes ont pour objectif de vous fournir l\u2019aide n\u00e9cessaire \u00e0 la r\u00e9alisation des activit\u00e9s confi\u00e9es. Vous trouverez des exemples de configuration que vous devrez recontextualiser vis-\u00e0-vis de l\u2019environnement qui est le v\u00f4tre.</p> <p>Vigilance</p> <p>Une attention toute particuli\u00e8re doit \u00eatre apport\u00e9e \u00e0 la rigueur syntaxique utilis\u00e9e afin d\u2019obtenir un service DNS fonctionnel.</p> <p>DNS est une des pierres angulaires du r\u00e9seau Internet et des r\u00e9seaux locaux. Ce service est sollicit\u00e9 dans de tr\u00e8s nombreux cas. Il est aussi important que les protocoles Ethernet, IPv4, IPv6 et TCP/UDP. Sans lui, des outils comme la messagerie ne peuvent fonctionner correctement. Vous devez ainsi maitriser les fondamentaux \u00e0 ce sujet tant d'un point de vue technique que th\u00e9orique.</p>"},{"location":"documentation/DNS/1--Pr%C3%A9ambule/#2-arborescence-dns-mise-en-oeuvre-dans-cette-documentation","title":"2. Arborescence DNS mise en oeuvre dans cette documentation","text":""},{"location":"documentation/DNS/2--Resolver/","title":"Serveur DNS r\u00e9cursif","text":"<p>Attention</p> <p>Puisque vous allez \u00eatre amen\u00e9 \u00e0 modifier des fichiers de configuration pr\u00e9sents dans le dossier /etc, vous devez utiliser etckeeper pour faire du versioning.</p>"},{"location":"documentation/DNS/2--Resolver/#1-verification-prealable","title":"1.  V\u00e9rification pr\u00e9alable","text":"<p>Mettez \u00e0 jour votre serveur</p> <pre><code>sudo apt update &amp;&amp; sudo apt upgrade\n</code></pre> <p>Sur votre serveur Debian 12, installez le service de journalisation rsyslog \u00e0 la place de journalctl. Cela vous permettra de disposer de fichiers de log clairs au format texte situ\u00e9s dans /var/log.</p> <pre><code>sudo apt install rsyslog\n</code></pre>"},{"location":"documentation/DNS/2--Resolver/#2-definir-les-parametres-reseaux-du-serveur","title":"2. D\u00e9finir les param\u00e8tres r\u00e9seaux du serveur","text":"<pre><code>sudoedit /etc/network/interfaces\n</code></pre> <pre><code># This file describes the network interfaces available on your system\n# and how to activate them. For more information, see interfaces(5).\n\nsource /etc/network/interfaces.d/*\n\n# The loopback network interface\nauto lo\niface lo inet loopback\n\n# The primary network interface\nallow-hotplug ens192\nauto ens192\niface ens192 inet static\naddress 192.168.1.10\nnetmask 255.255.255.0\ngateway 192.168.1.254\n</code></pre>"},{"location":"documentation/DNS/2--Resolver/#3-definir-le-serveur-dns-recursif-a-utiliser","title":"3. D\u00e9finir le serveur DNS r\u00e9cursif \u00e0 utiliser","text":"<pre><code>sudoedit /etc/resolv.conf\n</code></pre> <pre><code>nameserver 8.8.8.8\n</code></pre> <p>Attention</p> <p>Lorsque le service Unbound sera op\u00e9rationnel, remplacer 8.8.8.8 par 127.0.0.1 et ajouter ensuite le second serveur r\u00e9cursif produit par votre bin\u00f4me. </p>"},{"location":"documentation/DNS/2--Resolver/#4-prendre-en-compte-les-modifications-des-parametres-reseaux","title":"4. Prendre en compte les modifications des param\u00e8tres r\u00e9seaux","text":"<pre><code>sudo systemctl restart networking\n</code></pre>"},{"location":"documentation/DNS/2--Resolver/#5-configurer-correctement-les-fichiers-etchostname-et-etchosts","title":"5. Configurer correctement les fichiers /etc/hostname et /etc/hosts","text":"<p>Le fichier hostname sert \u00e0 donner un nom \u00e0 votre serveur.</p> <pre><code>sudoedit /etc/hostname\n</code></pre> <pre><code>dns0\n</code></pre> <p>Information</p> <p>Le fichier hosts, anc\u00eatre des stubresolver DNS, permet de faire la correspondance entre un nom et une IP. Il est g\u00e9n\u00e9ralement prioritaire sur la r\u00e9solution DNS (pour modifier l\u2019ordre de pr\u00e9f\u00e9rence, \u00e9ditez le fichier /etc/nsswitch.conf). Dans ce fichier, il est important de renseigner la correspondance entre votre adresse de boucle locale et un nom. Ainsi, si votre machine sollicite le nom indiqu\u00e9 lors d'un processus particulier, cela la renverra vers l'adresse de loopback.</p> <p><pre><code>sudoedit /etc/hosts\n</code></pre> <pre><code>127.0.0.1   localhost\n127.0.1.1   dns0.local.tours.tierslieux86.fr    dns0\n\n# The following lines are desirable for IPv6 capable hosts\n::1     localhost ip6-localhost ip6-loopback\nff02::1 ip6-allnodes\nff02::2 ip6-allrouters\n</code></pre> Il est n\u00e9cessaire de red\u00e9marrer le serveur pour prendre en compte le changement de nom.</p> <pre><code>sudo shutdown -r now\n</code></pre>"},{"location":"documentation/DNS/2--Resolver/#6-installer-unbound-et-les-outils-dadministration-appropries","title":"6. Installer Unbound et les outils d'administration appropri\u00e9s","text":"<pre><code>sudo apt install unbound dnsutils tcpdump tmux curl\n</code></pre>"},{"location":"documentation/DNS/2--Resolver/#7-configurer-unbound","title":"7. Configurer Unbound","text":"<pre><code>sudoedit /etc/unbound/unbound.conf\n</code></pre> <pre><code># Unbound configuration file for Debian.\n#\n# See the unbound.conf(5) man page.\n#\n# See /usr/share/doc/unbound/examples/unbound.conf for a commented\n# reference config file.\n#\n# The following line includes additional configuration files from the\n# /etc/unbound/unbound.conf.d directory.\ninclude: \"/etc/unbound/unbound.conf.d/*.conf\"\n\nserver:\n\n# Interface d\u2019\u00e9coute IPv4 sur le r\u00e9seau\ninterface: 192.168.1.10\ninterface: 127.0.0.1\n\n# Quels r\u00e9seaux ont le droit de se servir du serveur DNS recursif\n# Attention !! Ne pas laisser votre serveur r\u00e9cursif ouvert \u00e0 tous !\n# Allow_snoop autorise le tracage des requetes DNS avec la \n# commande dig +trace\naccess-control: 192.168.1.0/24 allow_snoop\naccess-control: 127.0.0.0/8 allow_snoop\n\n# Fichier indiquant les serveurs DNS racines\nroot-hints: \"/var/lib/unbound/root.hints\"\n\n# 0n cache la version de Unbound\n# et on augmente la securite\nhide-version: yes\nhide-identity: yes\nqname-minimisation: yes\n\n\n# On autorise l\u2019IPv4\ndo-ip4: yes\n\n# On journalise et garde une trace des evenements\n# Tres important\u00a0!!!!\nlogfile: /var/log/unbound.log\nverbosity: 1\nlog-queries: yes\n</code></pre> <p>Il est important de v\u00e9rifier ensuite que la syntaxe des lignes contenues dans le fichier de configuration est correcte. Pour cela, il existe la commande unbound-checkconf.</p> <pre><code>sudo unbound-checkconf\n</code></pre> <p>Notre serveur r\u00e9cursif va nativement s\u2019adresser aux serveurs faisant autorit\u00e9 sur Internet en sollicitant en premier l\u2019un des serveurs racines. Dans le cas o\u00f9 le serveur r\u00e9cursif serait amen\u00e9 \u00e0 devoir traiter des domaines locaux qui se trouvent en dehors de l\u2019arborescence DNS r\u00e9elle (ex\u00a0: btssio.lan ou epoka.local), il est important de l\u2019indiquer dans le fichier de configuration (/etc/unbound/unbound.conf) de la mani\u00e8re suivante\u00a0:</p> <pre><code># Comme le domaine btssio.lan est local et en dehors de l\u2019arborescence officielle, il est indispensable\n# d'indiquer au r\u00e9cursif qu'il doit contacter les serveurs internes faisant autorit\u00e9\n# sur cette zone plutot que l'un des serveurs racines.\n\n# On precise ici que le domaine local ne g\u00e8re pas DNSSEC et qu\u2019il faut donc desactiver la verification \n# realisee par Unbound\ndomain-insecure: \"btssio.lan.\"\nprivate-domain: btssio.lan.\n\nstub-zone:\nname: \"btssio.lan.\"\nstub-addr: 172.16.20.10\nstub-addr: 172.16.20.11\n</code></pre> <p>On r\u00e9cup\u00e8re les adresses des serveurs racines et nous les stockons dans le fichier /var/lib/unbound/root.hints. Ce fichier est indispensable et permet au service Unbound de savoir comment contacter le serveur racine le plus proche ou rapide.</p> <pre><code>sudo curl --output /var/lib/unbound/root.hints https://www.internic.net/domain/named.cache\nsudo chown -R unbound:unbound /var/lib/unbound/\n</code></pre> <p>On cr\u00e9e le fichier de log sp\u00e9cifique \u00e0 Unbound.</p> <pre><code>sudo touch /var/log/unbound.log\nchown unbound:unbound /var/log/unbound.log\nsudo systemctl restart unbound\nsudo systemctl status unbound\n</code></pre> <p>Attention</p> <p>Sur les syst\u00e8mes Debian r\u00e9cents, un logiciel de s\u00e9curit\u00e9 de type MAC (Mandatory Access Control) nomm\u00e9 AppArmor est activ\u00e9 par d\u00e9faut. Il surveille entre autres les droits d\u2019acc\u00e8s des diff\u00e9rents processus lanc\u00e9s sur le syst\u00e8me. Par d\u00e9faut, AppArmor emp\u00eache le service unbound de lire et d\u2019\u00e9crire dans le r\u00e9pertoire /var/log/. Il est donc indispensable de changer ces permissions.</p> <pre><code>sudoedit /etc/apparmor.d/usr.sbin.unbound\n</code></pre> <pre><code># On autorise le daemon unbound \u00e0 lire et ecrire dans le fichier /var/log/unbound.log\n\n/var/log/unbound.log rw,\n</code></pre> <p>On v\u00e9rifie que le nouveau fichier de configuration de AppArmor ne contient pas d\u2019erreurs puis on red\u00e9marre le service.</p> <pre><code>sudo apparmor_parser -r /etc/apparmor.d/usr.sbin.unbound\nsudo systemctl restart apparmor\n</code></pre> <p>Si l\u2019on souhaite observer les \u00e9v\u00e8nements journalis\u00e9s\u00a0:</p> <pre><code>sudo cat /var/log/unbound.log\n</code></pre> <p>Si l\u2019on souhaite observer les derniers \u00e9v\u00e8nements enregistr\u00e9s dans le fichier de log en temps r\u00e9el\u00a0:</p> <pre><code>sudo  tail -f /var/log/unbound.log\n</code></pre>"},{"location":"documentation/DNS/3--Autority/","title":"Serveur DNS ma\u00eetre faisant autorit\u00e9","text":"<p>Attention</p> <p>Puisque vous allez \u00eatre amen\u00e9 \u00e0 modifier des fichiers de configuration pr\u00e9sents dans le dossier /etc, vous devez utiliser etckeeper pour faire du versioning.</p>"},{"location":"documentation/DNS/3--Autority/#1-verification-prealable","title":"1.  V\u00e9rification pr\u00e9alable","text":"<p>Mettez \u00e0 jour votre serveur</p> <pre><code>sudo apt update &amp;&amp; sudo apt upgrade\n</code></pre> <p>Sur votre serveur Debian 12, installez le service de journalisation rsyslog \u00e0 la place de journalctl. Cela vous permettra de disposer de fichiers de log clairs au format texte situ\u00e9s dans /var/log.</p> <pre><code>sudo apt install rsyslog\n</code></pre> <p>Installez le service Bind 9 et les outils diagnostics DNS</p> <pre><code>sudo apt install bind9 dnsutils\n</code></pre>"},{"location":"documentation/DNS/3--Autority/#2-definir-les-parametres-reseaux-du-serveur","title":"2. D\u00e9finir les param\u00e8tres r\u00e9seaux du serveur","text":"<pre><code>sudoedit /etc/network/interfaces\n</code></pre> <pre><code># This file describes the network interfaces available on your system\n# and how to activate them. For more information, see interfaces(5).\n\nsource /etc/network/interfaces.d/*\n\n# The loopback network interface\nauto lo\niface lo inet loopback\n\n# The primary network interface\nallow-hotplug ens192\nauto ens192\niface ens192 inet static\naddress 172.16.3.10\nnetmask 255.255.255.0\ngateway 172.16.3.254\n</code></pre>"},{"location":"documentation/DNS/3--Autority/#3-definir-le-serveur-dns-recursif-a-utiliser","title":"3. D\u00e9finir le serveur DNS r\u00e9cursif \u00e0 utiliser","text":"<pre><code>sudoedit /etc/resolv.conf\n</code></pre> <pre><code>nameserver 86.54.11.100\nnameserver 9.9.9.9\n</code></pre> Pourquoi choisir ces serveurs DNS r\u00e9cursifs ? <p>Pour rappel, les serveurs DNS faisant autorit\u00e9 g\u00e8rent, dans la majorit\u00e9 des cas, des zones publiques appartenant \u00e0 l'arborescence r\u00e9elle. Ainsi, ils seront la plupart du temps h\u00e9berg\u00e9s dans une DMZ contrairement aux serveurs DNS r\u00e9cursifs qui seront install\u00e9s dans le LAN. Pour des raisons \u00e9videntes de s\u00e9curit\u00e9, il est plus pertinent que les serveurs d\u00e9finis dans le fichier /etc/resolv.conf soient des r\u00e9solveurs publics plut\u00f4t que les r\u00e9solveurs internes param\u00e9tr\u00e9s pr\u00e9c\u00e9demment. </p>"},{"location":"documentation/DNS/3--Autority/#4-prendre-en-compte-les-modifications-des-parametres-reseaux","title":"4. Prendre en compte les modifications des param\u00e8tres r\u00e9seaux","text":"<pre><code>sudo systemctl restart networking\n</code></pre>"},{"location":"documentation/DNS/3--Autority/#5-configurer-correctement-les-fichiers-etchostname-et-etchosts","title":"5. Configurer correctement les fichiers /etc/hostname et /etc/hosts","text":"<p>Le fichier hostname sert \u00e0 donner un nom \u00e0 votre serveur.</p> <pre><code>sudoedit /etc/hostname\n</code></pre> <pre><code>ns0\n</code></pre> <p>Information</p> <p>Le fichier hosts, anc\u00eatre des stubresolver DNS, permet de faire la correspondance entre un nom et une IP. Il est g\u00e9n\u00e9ralement prioritaire sur la r\u00e9solution DNS (pour modifier l\u2019ordre de pr\u00e9f\u00e9rence, \u00e9ditez le fichier /etc/nsswitch.conf). Dans ce fichier, il est important de renseigner la correspondance entre votre adresse de boucle locale et un nom. Ainsi, si votre machine sollicite le nom indiqu\u00e9 lors d'un processus particulier, cela la renverra vers l'adresse de loopback.</p> <p><pre><code>sudoedit /etc/hosts\n</code></pre> <pre><code>127.0.0.1   localhost\n127.0.1.1   ns0.tours.tierslieux86.fr   ns0\n\n# The following lines are desirable for IPv6 capable hosts\n::1     localhost ip6-localhost ip6-loopback\nff02::1 ip6-allnodes\nff02::2 ip6-allrouters\n</code></pre> Il est n\u00e9cessaire de red\u00e9marrer le serveur pour prendre en compte le changement de nom.</p> <pre><code>sudo shutdown -r now\n</code></pre>"},{"location":"documentation/DNS/3--Autority/#6-principes-generaux-concernant-bind9-et-le-service-dns","title":"6. Principes g\u00e9n\u00e9raux concernant Bind9 et le service DNS.","text":"<ol> <li>Cr\u00e9er dans le r\u00e9pertoire /var/named/ les zones ad\u00e9quates \u00e0 l\u2019aide d\u2019un fichier db.xxxxxx (ou xxxxxx correspond \u00e0 votre nom de domaine) par exemple, db.tours.btsssio.fr.</li> <li>Initialiser la ou les zones dans /etc/bind/named.conf.local</li> <li>Ajouter ou g\u00e9rer les options globales du daemon Bind 9 dans /etc/bind/named.conf.options</li> <li>Faire particuli\u00e8rement attention \u00e0 la syntaxe. </li> <li>Penser aux commandes de test et red\u00e9marrer ou recharger le service.</li> </ol> <p>Les commandes \u00e0 conna\u00eetre absolument sont les suivantes et vous seront utiles tout au long de votre activit\u00e9\u00a0:</p> <ul> <li>dig</li> <li>host</li> <li>nslookup (sous Windows)</li> <li>named-checkconf</li> <li>named-checkzone</li> <li>service bind9 stop|start|restart|reload|status (fonctionne avec SysVinit, systemd)</li> <li>avec systemd, systemctl stop|start|restart|reload|status bind9</li> </ul>"},{"location":"documentation/DNS/3--Autority/#7-exemple-de-configuration-dun-serveur-dns-maitre-faisant-autorite","title":"7. Exemple de configuration d'un serveur DNS ma\u00eetre faisant autorit\u00e9","text":"<p>Attention</p> <p>Il est recommand\u00e9 de supprimer le contenu des fichiers de configuration par d\u00e9faut et d'utiliser le contenu fourni ci-dessous. N'oubliez pas que etckeeper doit \u00eatre mobilis\u00e9.</p> <pre><code>sudo cat /etc/bind/named.conf\n</code></pre> <pre><code>// This is the primary configuration file for the BIND DNS server named.\n// If you are just adding zones, please do that in /etc/bind/named.conf.local\n\ninclude \"/etc/bind/named.conf.options\";\ninclude \"/etc/bind/named.conf.local\";\ninclude \"/etc/bind/named.conf.default-zones\";\n</code></pre> <p>Le fichier /etc/bind/named.conf est le fichier de configuration global du service DNS. Il est possible d'y renseigner tous les param\u00e8tres de configuration du service.</p> <p>Sous Debian, il a \u00e9t\u00e9 d\u00e9cid\u00e9 dans un souci de lisibilit\u00e9, de scinder la configuration en plusieurs fichiers. Ces fichiers sont appel\u00e9s par le fichier de configuration g\u00e9n\u00e9ral \u00e0 l'aide de la directive include.</p> <ul> <li>Le fichier named.conf.options est utilis\u00e9 pour d\u00e9clarer les options de configuration li\u00e9es \u00e0 Bind.</li> <li>Le fichier named.conf.local sert \u00e0 d\u00e9clarer les zones nouvellement cr\u00e9\u00e9es.</li> <li>Le fichier named.conf.default-zones contient les d\u00e9clarations de fichier de zone concernant la racine DNS et la boucle locale.</li> <li>Le fichier named.conf.log n'existe pas mais vous permettra de g\u00e9rer la journalisation de votre service dans un fichier texte d\u00e9di\u00e9.</li> </ul> <pre><code>sudo cat /etc/bind/named.conf.options\n</code></pre> <p><pre><code>options {\n    // Directory permet de d\u00e9finir o\u00f9 se situe le cache du serveur DNS\n    directory \"/var/cache/bind\";\n\n    // D\u00e9finit le port et la ou les adresses IPv4 d\u2019\u00e9coute du service Bind\n    listen-on port 53 { 127.0.0.1; 172.16.3.10; };\n\n\n    // Forwarders (redirecteurs) permet de d\u00e9finir les serveurs DNS r\u00e9cursifs qui seront sollicit\u00e9s par \n    // Bind lorsqu'il ne sera pas r\u00e9pondre \u00e0 une requ\u00eate.\n    // forwarders {\n    //  0.0.0.0;\n    // };\n\n    // Recursion permet  d'autoriser ou d'interdire la r\u00e9cursivit\u00e9 sur un serveur DNS. Par d\u00e9faut un\n    // serveur DNS faisant autorit\u00e9 ne doit pas \u00eatre r\u00e9cursif.\n    recursion no;\n\n    // Emp\u00eache la diffusion de la version du service Bind utilis\u00e9e. M\u00e9canisme de s\u00e9curit\u00e9 qui ralentit\n    // un potentiel attaquant \u00e0 la recherche d\u2019une faille li\u00e9e \u00e0 une version pr\u00e9cise du service.\n    version none;\n};\n</code></pre> <pre><code>sudoedit /etc/bind/named.conf.local\n</code></pre></p> <pre><code>zone \"tours.tierslieux86.fr\" {\n    type master;\n    allow-transfer { 172.16.3.11; };\n    file \"/var/cache/bind/db.tours.tierslieux86.fr\";\n};\n</code></pre> <p>Ce fichier sert \u00e0 d\u00e9clarer les zones que vous aurez \u00e0 g\u00e9rer. Votre serveur peut-\u00eatre ma\u00eetre sur une zone ou esclave. La directive file sert \u00e0 d\u00e9clarer le fichier de zone contenant les enregistrements li\u00e9s (SOA, NS, A\u2026). La directive allow-transfer permet de d\u00e9clarer les serveurs esclaves habilit\u00e9s.</p> <p>Attention</p> <p>Le num\u00e9ro de s\u00e9rie ne doit jamais \u00eatre choisi au hasard et syst\u00e9matiquement incr\u00e9ment\u00e9 \u00e0 chaque modification du fichier de zone. Les guides de bonnes pratiques recommande de choisir la date du jour sous 2025090101 (ann\u00e9e/mois/jour/id). Dans le cas d'une architecture ma\u00eetre-esclave si le num\u00e9ro de s\u00e9rie pr\u00e9sent sur le ma\u00eetre se retrouve d\u00e9cr\u00e9ment\u00e9 et inf\u00e9rieur \u00e0 celui du serveur esclave, le transfert de zone ne se fera plus !</p> <pre><code>sudoedit /var/cache/bind/db. tours.tierslieux86.fr\nsudo chown bind:bind /var/cache/bind/db.tours.tierslieux86.fr\n</code></pre> <pre><code>; La directive TTL d\u00e9finie la dur\u00e9e de conservation en cache d'informations concernant cette zone par les \n; serveurs DNS r\u00e9solveurs. Lorsque ce TTL arrive \u00e0 expiration les r\u00e9solveurs vident leur cache et \n; consultent \u00e0 nouveau le serveur faisant autorit\u00e9.\n$TTL 43200;     12 heures\n\n; Pour le domaine d\u00e9fini dans le fichier de zone, on d\u00e9clare le serveur SOA ainsi que le mail de la \n; personne \u00e0 contacter pour cette zone (sans le @).\n\n; Le num\u00e9ro de s\u00e9rie est important. Souvent, il correspond \u00e0 la date du jour suivi d'un chiffre ou d'une \n; valeur que l'on incr\u00e9mente lors des modifications. Le num\u00e9ro de s\u00e9rie d'une zone stock\u00e9e par un \n; serveur esclave ne doit jamais \u00eatre sup\u00e9rieur \u00e0 celle pr\u00e9sente sur un serveur ma\u00eetre. Lorsque l'on \n; incr\u00e9mente le num\u00e9ro de s\u00e9rie, cela signifie aux serveurs esclaves qu'une modification sur la zone a \u00e9t\u00e9 \n; op\u00e9r\u00e9e.\n\n; Les valeurs suivantes permettent aux serveurs esclaves d'obtenir les d\u00e9lais maximums avant de \n; rafra\u00eechir leur zone, de r\u00e9essayer \u00e0 contacter le serveur ma\u00eetre en cas d'interruption de service. En cas \n; d'interruption du service sur le ma\u00eetre pendant plus d'une semaine, l'esclave consid\u00e9rera ce dernier \n; comme expir\u00e9.\n\ntours.tierslieux86.fr. IN SOA ns0.tours.tierslieux86.fr. postmaster.tours.tierslieux86.fr. (\n    2021070601  ; Serial\n        1D  ; Refresh\n        1H  ; Retry\n        1W  ; Expire\n        3H )    ; Negative Cache TTL\n\n; D\u00e9claration des serveurs DNS faisant autorit\u00e9 sur la zone tours.tierslieux86.fr \u00e0 l\u2019aide de \n; l\u2019enregistrement NS.\n\ntours.tierslieux86.fr.  IN  NS  ns0.tours.tierslieux86.fr.\ntours.tierslieux86.fr.  IN  NS  ns1.tours.tierslieux86.fr.\n\n; D\u00e9claration des correspondances entre un nom de domaine et une adresse IP \u00e0 l\u2019aide de l\n; \u2019enregistrement A. Il est indispensable de d\u00e9clarer les correspondances pour les serveurs DNS (nsx).\n\nns0     IN  A   172.16.3.10\nns1     IN  A   172.16.3.11\nwww.    IN  A   172.16.3.2\n\n; Exemple d\u2019utilisation d\u2019un alias. Ici extranet.tours.tierslieux86.fr renvoie vers \n; www.tours.tierslieux86.fr. \n\nextranet IN CNAME www.tours.tierslieux86.fr.\n</code></pre> <p>Attention</p> <p>Ceci est un exemple de fichier de zone \u00e0 r\u00e9adapter sans les commentaires (;). Tous les enregistrements pr\u00e9sents dans cet exemple ne servent pas forc\u00e9ment dans le TP. Par contre, il est pertinent de rechercher leurs significations sur Internet pour comprendre \u00e0 quoi ils peuvent servir dans un contexte professionnel.</p> <p>Mise en place d\u2019une journalisation des \u00e9v\u00e8nements du service DNS</p> <pre><code>sudoedit /etc/bind/named.conf.log\n</code></pre> <pre><code>logging {\n\n    channel bind_log {\n                    file \"/var/log/bind.log\" versions 3 size 100m;\n                   severity info;\n                    print-category  yes;\n                    print-severity  yes;\n                    print-time      yes;\n    };\n\n    category default { bind_log; };\n\n};\n</code></pre> <p>Ce fichier permet d'activer la journalisation des \u00e9v\u00e8nements pour le service DNS. Vous pouvez pr\u00e9ciser le niveau de verbosit\u00e9 avec la directive severity mais aussi la taille maximale du fichier de log. Comme pour le fichier de zone esclave, il est n\u00e9cessaire de cr\u00e9er un fichier vide de log avec les bonnes permissions au pr\u00e9alable :</p> <pre><code>sudo touch /var/log/bind.log\nsudo chown bind:bind /var/log/bind.log\n</code></pre> <p>Enfin, on n\u2019oublie pas de d\u00e9clarer ce nouveau fichier de configuration dans /etc/bind/named.conf.</p> <pre><code>sudoedit /etc/bind/named.conf\n</code></pre> <pre><code>// This is the primary configuration file for the BIND DNS server named.\n// If you are just adding zones, please do that in /etc/bind/named.conf.local\ninclude \"/etc/bind/named.conf.options\";\ninclude \"/etc/bind/named.conf.local\";\ninclude \"/etc/bind/named.conf.default-zones\";\n\n// Ajout du fichier de parametrage de la journalisation du service BIND\ninclude \"/etc/bind/named.conf.log\";\n</code></pre> <p>Attention</p> <p>Sur les syst\u00e8mes Debian r\u00e9cents, un logiciel de s\u00e9curit\u00e9 de type MAC (Mandatory Access Control) nomm\u00e9 AppArmor est activ\u00e9 par d\u00e9faut. Il surveille entre autres les droits d\u2019acc\u00e8s des diff\u00e9rents processus lanc\u00e9s sur le syst\u00e8me. Par d\u00e9faut, AppArmor emp\u00eache le service Bind 9 de lire et \u00e9crire dans le r\u00e9pertoire /var/log/. Il est donc indispensable de changer ces permissions.</p> <pre><code>sudoedit /etc/apparmor.d/usr.sbin.named\n</code></pre> <pre><code># On autorise le daemon Bind 9 \u00e0 lire et ecrire dans le fichier /var/log/bind.log\n\n/var/log/bind.log rw,\n</code></pre> <p>On v\u00e9rifie que le nouveau fichier de configuration de AppArmor ne contient pas d\u2019erreurs puis on red\u00e9marre le service.</p> <pre><code>sudo apparmor_parser -r /etc/apparmor.d/usr.sbin.named\nsudo systemctl restart apparmor\n</code></pre> named-checkconf <p>La commande named-checkconf permet de v\u00e9rifier si des erreurs de syntaxe sont pr\u00e9sentes et de fournir les \u00e9l\u00e9ments ou lignes qui posent probl\u00e8me dans un fichier en particulier.</p> <pre><code>sudo named-checkconf -z\nsudo systemctl restart bind9\nsudo systemctl status bind9\n</code></pre>"},{"location":"documentation/DNS/4--Slave/","title":"Serveur DNS esclave faisant autorit\u00e9","text":"<p>Attention</p> <p>Puisque vous allez \u00eatre amen\u00e9 \u00e0 modifier des fichiers de configuration pr\u00e9sents dans le dossier /etc, vous devez utiliser etckeeper pour faire du versioning.</p>"},{"location":"documentation/DNS/4--Slave/#1-verification-prealable","title":"1.  V\u00e9rification pr\u00e9alable","text":"<p>Mettez \u00e0 jour votre serveur</p> <pre><code>sudo apt update &amp;&amp; sudo apt upgrade\n</code></pre> <p>Sur votre serveur Debian 12, installez le service de journalisation rsyslog \u00e0 la place de journalctl. Cela vous permettra de disposer de fichiers de log clairs au format texte situ\u00e9s dans /var/log.</p> <pre><code>sudo apt install rsyslog\n</code></pre> <p>Installez le service Bind 9 et les outils diagnostics DNS</p> <pre><code>sudo apt install bind9 dnsutils\n</code></pre>"},{"location":"documentation/DNS/4--Slave/#2-definir-les-parametres-reseaux-du-serveur","title":"2. D\u00e9finir les param\u00e8tres r\u00e9seaux du serveur","text":"<pre><code>sudoedit /etc/network/interfaces\n</code></pre> <pre><code># This file describes the network interfaces available on your system\n# and how to activate them. For more information, see interfaces(5).\n\nsource /etc/network/interfaces.d/*\n\n# The loopback network interface\nauto lo\niface lo inet loopback\n\n# The primary network interface\nallow-hotplug ens192\nauto ens192\niface ens192 inet static\naddress 172.16.3.11\nnetmask 255.255.255.0\ngateway 172.16.3.254\n</code></pre>"},{"location":"documentation/DNS/4--Slave/#3-definir-le-serveur-dns-recursif-a-utiliser","title":"3. D\u00e9finir le serveur DNS r\u00e9cursif \u00e0 utiliser","text":"<pre><code>sudoedit /etc/resolv.conf\n</code></pre> <pre><code>nameserver 86.54.11.100\nnameserver 9.9.9.9\n</code></pre> Pourquoi choisir ces serveurs DNS r\u00e9cursifs ? <p>Pour rappel, les serveurs DNS faisant autorit\u00e9 g\u00e8rent, dans la majorit\u00e9 des cas, des zones publiques appartenant \u00e0 l'arborescence r\u00e9elle. Ainsi, ils seront la plupart du temps h\u00e9berg\u00e9s dans une DMZ contrairement aux serveurs DNS r\u00e9cursifs qui seront install\u00e9s dans le LAN. Pour des raisons \u00e9videntes de s\u00e9curit\u00e9, il est plus pertinent que les serveurs d\u00e9finis dans le fichier /etc/resolv.conf soient des r\u00e9solveurs publics plut\u00f4t que les r\u00e9solveurs internes param\u00e9tr\u00e9s pr\u00e9c\u00e9demment. </p>"},{"location":"documentation/DNS/4--Slave/#4-prendre-en-compte-les-modifications-des-parametres-reseaux","title":"4. Prendre en compte les modifications des param\u00e8tres r\u00e9seaux","text":"<pre><code>sudo systemctl restart networking\n</code></pre>"},{"location":"documentation/DNS/4--Slave/#5-configurer-correctement-les-fichiers-etchostname-et-etchosts","title":"5. Configurer correctement les fichiers /etc/hostname et /etc/hosts","text":"<p>Le fichier hostname sert \u00e0 donner un nom \u00e0 votre serveur.</p> <pre><code>sudoedit /etc/hostname\n</code></pre> <pre><code>ns1\n</code></pre> <p>Information</p> <p>Le fichier hosts, anc\u00eatre des stubresolver DNS, permet de faire la correspondance entre un nom et une IP. Il est g\u00e9n\u00e9ralement prioritaire sur la r\u00e9solution DNS (pour modifier l\u2019ordre de pr\u00e9f\u00e9rence, \u00e9ditez le fichier /etc/nsswitch.conf). Dans ce fichier, il est important de renseigner la correspondance entre votre adresse de boucle locale et un nom. Ainsi, si votre machine sollicite le nom indiqu\u00e9 lors d'un processus particulier, cela la renverra vers l'adresse de loopback.</p> <p><pre><code>sudoedit /etc/hosts\n</code></pre> <pre><code>127.0.0.1   localhost\n127.0.1.1   ns1.tours.tierslieux86.fr   ns1\n\n# The following lines are desirable for IPv6 capable hosts\n::1     localhost ip6-localhost ip6-loopback\nff02::1 ip6-allnodes\nff02::2 ip6-allrouters\n</code></pre> Il est n\u00e9cessaire de red\u00e9marrer le serveur pour prendre en compte le changement de nom.</p> <pre><code>sudo shutdown -r now\n</code></pre>"},{"location":"documentation/DNS/4--Slave/#6-exemple-de-configuration-dun-serveur-dns-esclave-faisant-autorite","title":"6. Exemple de configuration d'un serveur DNS esclave faisant autorit\u00e9","text":"<p>D\u00e9claration de la zone que l\u2019on souhaite transf\u00e9rer depuis le serveur ma\u00eetre sur le serveur esclave\u00a0:</p> <pre><code>sudoedit /etc/bind/named.conf.local\n\nzone \"tours.tierslieux86.fr\" {\n    type slave;\n    masters { 172.16.3.10; };\n    file \"/var/cache/bind/db.tours.tierslieux86.fr\";\n};\n</code></pre> <p>Gr\u00e2ce \u00e0 cette configuration, le serveur esclave r\u00e9alisera un transfert de zone aupr\u00e8s du serveur ma\u00eetre. Pour que le contenu du transfert soit stock\u00e9 dans un fichier de zone, il est n\u00e9cessaire de le cr\u00e9er au pr\u00e9alable avec les permissions ad\u00e9quates :</p> <pre><code>sudo touch /var/cache/bind/db.tours.tierslieux86.fr\nsudo chown bind:bind /var/cache/bind/db.tours.tierslieux86.fr\n</code></pre>"},{"location":"documentation/DNS/4--Slave/#7-mise-en-place-de-la-journalisation","title":"7. Mise en place de la journalisation","text":"<pre><code>sudoedit /etc/bind.named.conf.log\n```bash\n\n```bash\nlogging {\n\n    channel bind_log {\n                    file \"/var/log/bind.log\" versions 3 size 100m;\n                   severity info;\n                    print-category  yes;\n                    print-severity  yes;\n                    print-time      yes;\n    };\n\n    category default { bind_log; };\n};\n</code></pre> <pre><code>sudo touch /var/log/bind.log\nsudo chown bind:bind /var/log/bind.log\n</code></pre> <pre><code>sudoedit /etc/bind/named.conf\n</code></pre> <pre><code>// This is the primary configuration file for the BIND DNS server named.\n// If you are just adding zones, please do that in /etc/bind/named.conf.local\n\ninclude \"/etc/bind/named.conf.options\";\ninclude \"/etc/bind/named.conf.local\";\ninclude \"/etc/bind/named.conf.default-zones\";\n\n// Ajout du fichier de parametrage de la journalisation du service BIND\ninclude \"/etc/bind/named.conf.log\";\n</code></pre> <p>Attention</p> <p>Sur les syst\u00e8mes Debian r\u00e9cents, un logiciel de s\u00e9curit\u00e9 de type MAC (Mandatory Access Control) nomm\u00e9 AppArmor est activ\u00e9 par d\u00e9faut. Il surveille entre autres les droits d\u2019acc\u00e8s des diff\u00e9rents processus lanc\u00e9s sur le syst\u00e8me. Par d\u00e9faut, AppArmor emp\u00eache le service Bind 9 de lire et \u00e9crire dans le r\u00e9pertoire /var/log/. Il est donc indispensable de changer ces permissions.</p> <pre><code>sudoedit /etc/apparmor.d/usr.sbin.named\n</code></pre> <pre><code># On autorise le daemon Bind 9 \u00e0 lire et ecrire dans le fichier /var/log/bind.log\n\n/var/log/bind.log rw,\n</code></pre> <p>On v\u00e9rifie que le nouveau fichier de configuration de AppArmor ne contient pas d\u2019erreurs puis on red\u00e9marre le service.</p> <pre><code>sudo apparmor_parser -r /etc/apparmor.d/local/usr.sbin.named\nsudo systemctl restart apparmor\n</code></pre> named-checkconf <p>La commande named-checkconf permet de v\u00e9rifier si des erreurs de syntaxe sont pr\u00e9sentes et de fournir les \u00e9l\u00e9ments ou lignes qui posent probl\u00e8me dans un fichier en particulier.</p> <pre><code>sudo named-checkconf -z\nsudo systemctl restart bind9\nsudo systemctl status bind9\n</code></pre>"},{"location":"documentation/DNS/5--Delegation/","title":"D\u00e9l\u00e9gation de zone","text":"<p>Pour r\u00e9aliser une d\u00e9l\u00e9gation de zone entre un serveur parent et un serveur enfant, il suffit de se connecter sur le serveur parent.</p>"},{"location":"documentation/DNS/5--Delegation/#1-connexion-ssh-au-serveur-maitre-parent","title":"1. Connexion SSH au serveur ma\u00eetre parent","text":"<p>Attention</p> <p>Lorsque vous ajoutez les nouveaux enregistrements n\u00e9cessaires \u00e0 la mise en place de la d\u00e9l\u00e9gation de zone, assurez-vous d'\u00eatre les seuls \u00e0 \u00e9diter le fichier de zone. Il faut absolument \u00e9viter d'\u00e9diter le m\u00eame fichier en simultan\u00e9 !</p> <pre><code>ssh admineleve@ns0.tierslieux86.fr\nThe authenticity of host 'ns0.sisr.sfda37.fr (172.16.253.10)' can't be established.ECDSA key fingerprint is SHA256:86URTSy4kQ4hHHPu9nTP3oXRAEH9RCTp4/3JHv0qe+g.\nAre you sure you want to continue connecting (yes/no/[fingerprint])?y\nWarning: Permanently added 'ns0.sisr.sfda37.fr' (ECDSA) to the list of known hosts.\nadmineleve@ns0.tierslieux86.fr's password:\n</code></pre>"},{"location":"documentation/DNS/5--Delegation/#2-ajout-des-enregistrements-necessaires-dans-la-zone-du-serveur-maitre-parent","title":"2. Ajout des enregistrements n\u00e9cessaires dans la zone du serveur ma\u00eetre parent","text":"<p>Il est n\u00e9cessaire d\u2019ajouter les lignes suivantes \u00e0 la fin du fichier de zone en pensant \u00e0 incr\u00e9menter le num\u00e9ro de s\u00e9rie</p> <pre><code>sudoedit /var/cache/bind/db.tierslieux86.fr\n</code></pre> <pre><code>$TTL 43200;     12 heures\n\nsisr.tierslieux86.fr. IN SOA ns0..tierslieux86.fr. postmaster.tierslieux86.fr. (\n    2021070601  ; Serial\n        1D  ; Refresh\n        1H  ; Retry\n        1W  ; Expire\n        3H )    ; Negative Cache TTL\n\n; Les points de suspension mettent en \u00e9vidence que nous sommes en pr\u00e9sence d\u2019un extrait de fichier de \n; zone. Ce sont les enregistrements en gras qui doivent \u00eatre ajout\u00e9s \u00e0 l\u2019existant.\n.\u2026\n\n; D\u00e9claration des serveurs faisant autorit\u00e9 pour le sous-domaine. Indispensable \u00e0 la d\u00e9l\u00e9gation\ntours.tierslieux86.fr.  IN NS   ns0.tours\ntours.tierslieux86.fr.  IN NS   ns1.tours\n\n; Enregistrements de type glue ou colle indispensables \u00e0 la d\u00e9l\u00e9gation de zone\nns0.tours   IN A    172.16.3.10\nns1.tours   IN A    172.16.3.11\n</code></pre> Qu'est-ce que les glue records (colle ou enregistrements de raccord) ? <p>Lorsqu'une zone est d\u00e9l\u00e9gu\u00e9e \u00e0 des serveurs dont le nom est dans la zone fille, la r\u00e9solution DNS se heurte \u00e0 un probl\u00e8me d'\u0153uf et de poule. Pour trouver l'adresse de ns1.mazone.example, le r\u00e9solveur doit passer par les serveurs de mazone.example, qui est d\u00e9l\u00e9gu\u00e9e \u00e0 ns1.mazone.example et ainsi de suite... On rompt ce cercle vicieux en ajoutant, dans la zone parente, des donn\u00e9es qui ne font pas autorit\u00e9 sur les adresses de ces serveurs (RFC 1034, section 4.2.1). Il faut donc bien veiller \u00e0 les garder synchrones avec la zone fille<sup>1</sup>. Si vous voulez en savoir plus, jetez un oeil \u00e0 cet article de l'AFNIC.</p> <p>Enfin, il est n\u00e9cessaire de tester la validit\u00e9 de la syntaxe des nouveaux enregistrements puis de prendre en compte les modifications du fichier de zone \u00e0 l\u2019aide des commandes suivantes\u00a0:</p> <pre><code>sudo named-checkconf -z\nsudo systemctl reload bind9\n</code></pre> <ol> <li> <p>D\u00e9finition tir\u00e9e du site de S. Bortzmeyer et de son article sur la terminologie li\u00e9e \u00e0 DNS \u21a9</p> </li> </ol>"},{"location":"documentation/DNS/6--Resolutioninverse/","title":"La r\u00e9solution inverse","text":""},{"location":"documentation/DNS/6--Resolutioninverse/#1-quest-ce-que-la-resolution-inverse","title":"1. Qu'est-ce que la r\u00e9solution inverse ?","text":"<p>Une recherche DNS invers\u00e9e est une requ\u00eate DNS pour obtenir le nom de domaine associ\u00e9 \u00e0 une adresse IP donn\u00e9e. Cette m\u00e9thode est le contraire de la recherche DNS directe, plus couramment utilis\u00e9e, qui consiste \u00e0 interroger le syst\u00e8me DNS pour obtenir une adresse IP.</p> <p>Il existe des normes de l'Internet Engineering Task Force (IETF) sugg\u00e9rant que chaque domaine devrait \u00eatre capable de recherche DNS invers\u00e9e, mais comme les recherches invers\u00e9es ne sont pas essentielles au fonctionnement normal d'Internet, elles ne constituent pas une exigence stricte. Par cons\u00e9quent, les recherches DNS invers\u00e9es ne sont pas universellement adopt\u00e9es.</p> <p>Les recherches DNS invers\u00e9es interrogent les serveurs DNS pour obtenir un enregistrement PTR (pointeur). Si le serveur n'a pas d'enregistrement PTR, il ne peut pas r\u00e9soudre une recherche invers\u00e9e. Les enregistrements PTR stockent les adresses IP avec leurs segments invers\u00e9s, et leur ajoutent \u00ab .in-addr.arpa \u00bb. Par exemple, si un domaine a pour adresse IP 192.0.2.1, l'enregistrement PTR stockera cette information sous la forme 1.2.0.192.in-addr.arpa.</p> <p>Dans IPv6, la derni\u00e8re version du protocole Internet, les enregistrements PTR sont stock\u00e9s dans le domaine \u00ab .ip6.arpa \u00bb au lieu de \u00ab .in-addr.arpa. \u00bb [^1]</p> <p>Attention</p> <p>Une r\u00e9solution inverse op\u00e9rationnelle est indispensable notamment dans le cadre de la mise en place d'un service de messagerie (mail) lors de la v\u00e9rification de la l\u00e9gitimit\u00e9 des serveurs SMTP utilis\u00e9s.</p>"},{"location":"documentation/DNS/6--Resolutioninverse/#2-mise-en-place-dune-resolution-inverse","title":"2. Mise en place d'une r\u00e9solution inverse","text":""},{"location":"documentation/DNS/6--Resolutioninverse/#21-creation-dun-fichier-de-zone-pour-le-reseau-172163024","title":"2.1 Cr\u00e9ation d\u2019un fichier de zone pour le r\u00e9seau 172.16.3.0/24","text":"<pre><code>sudoedit /var/cache/bind/db.172.16.3\n</code></pre> <pre><code>$TTL    43200\n\n3.16.172.in-addr.arpa.       IN      SOA     ns0.tours.tierslieux86.fr. postmaster.tours.tierslieux86.fr. (\n                         2021070601; Serial\n                         604800         ; Refresh\n                        86400         ; Retry\n                        2419200         ; Expire\n                        604800 )       ; Negative Cache TTL\n;\n3.16.172.in-addr-arpa.       IN      NS      ns0.tours.tierslieux86.fr.\n10.3.16.172.in-addr.arpa.      IN      PTR     ns0.tours.tierslieux86.fr.\n\n2.3.16.172.in-addr.arpa.      IN      PTR     www.tours.tierslieux86.fr.\n</code></pre> <p>Ce fichier de zone inverse ressemble \u00e0 un fichier de zone classique. Il sert \u00e0 mettre en \u0153uvre la r\u00e9solution DNS invers\u00e9e. Il est n\u00e9cessaire que le service Bind dispose des droits afin d\u2019acc\u00e9der au fichier de zone inverse nouvellement cr\u00e9\u00e9.</p> <pre><code>sudo chown bind:bind /var/cache/bind/db.172.16.3\n</code></pre>"},{"location":"documentation/DNS/6--Resolutioninverse/#22-declaration-de-la-zone-inverse-dans-le-fichier-etcbindnamedconflocal","title":"2.2 D\u00e9claration de la zone inverse dans le fichier /etc/bind/named.conf.local","text":"<pre><code>sudoedit /etc/bind/named.conf.local\n</code></pre> <pre><code>zone \"3.16.172.in-addr.arpa\" {\n    type master;\n    file \"/var/cache/bind/db.172.16.3\";\n};\n</code></pre>"},{"location":"documentation/DNS/6--Resolutioninverse/#23-prise-en-compte-des-modifications","title":"2.3 Prise en compte des modifications","text":"<pre><code>sudo systemctl reload bind9\n</code></pre> <p>[^1] Source : Cloudflare</p>"},{"location":"documentation/DNS/7--Tests/","title":"Tests et diagnostics DNS","text":"<p>Information</p> <p>Cette partie de la documentation DNS est issue de la production Mise en oeuvre du syst\u00e8me DNS publi\u00e9e par Fr\u00e9d\u00e9ric Varni et Apollonie Raffalli sur le site du r\u00e9seau CERTA.</p>"},{"location":"documentation/DNS/7--Tests/#1-les-outils-de-diagnostic-dont-on-doit-disposer","title":"1. Les outils de diagnostic dont on doit disposer","text":"<p>Le paquet dnsutils (parfois install\u00e9 par d\u00e9faut sur le syst\u00e8me debian) fournit quelques commandes utiles\u00a0:</p> <ul> <li>Pour v\u00e9rifier les fichiers de configuration globale : named-checkconf et named-checkconf -z</li> </ul> <p>Si la commande ne renvoie rien, c'est qu'il n'y a pas d'erreurs de syntaxe dans les fichiers. </p> <ul> <li>Pour v\u00e9rifier la syntaxe des fichiers de zone : named-checkzone zonename filename</li> </ul> <p>Il ne faut pas toujours se fier au \"OK\" final mais lire les phrases qui pr\u00e9c\u00e8dent... </p> <ul> <li>Les commandes nslookup, host et dig permettent de v\u00e9rifier les donn\u00e9es relatives \u00e0 chaque zone.</li> </ul> <p>Mais pour ne pas perdre de temps, il est important de proc\u00e9der m\u00e9thodiquement.</p>"},{"location":"documentation/DNS/7--Tests/#2-premiere-batterie-de-tests-le-serveur-bind-9-a-til-correctement-demarre-ou-redemarre","title":"2. Premi\u00e8re batterie de tests : le serveur bind 9 a-t'il correctement d\u00e9marr\u00e9 ou red\u00e9marr\u00e9 ?","text":"<p>Attention</p> <p>SAUF s'il y a une erreur de syntaxe dans les fichiers de configuration globaux, le serveur va apparemment d\u00e9marrer ou red\u00e9marrer sans erreur. Pour voir si tout c'est r\u00e9ellement bien passer, il faut lire les fichiers de trace (logs).</p> <p>Lorsque vous lancez ou relancez le serveur, il est judicieux d'ouvrir une autre console, d'y lancer la commande \"tail -f /var/log/bind.log\" pour lire en direct les fichiers de trace concernant le d\u00e9mon named.</p> <p>Voici par exemple 2 cas o\u00f9 il y a un probl\u00e8me :</p> <p>Premier cas - le fichier de zone n'est pas trouv\u00e9 : <pre><code>Jan 26 16:01:33 ns1 named[21056]: zone tours.tierslieux86.fr/IN: loading from master file /var/named/db.tours.tierslieux86.fr failed: file not found\n</code></pre></p> <p>Il n'y a pas ici une erreur de syntaxe, la commande named-checkconf n'aurait rien renvoy\u00e9e.</p> <p>Deuxi\u00e8me cas : le fichier de zone est trouv\u00e9 mais pr\u00e9sente une erreur : <pre><code>Jan 26 16:13:57 ns1 named[21652]: zone tours.tierslieux86.fr/IN: loading from master file /var/named/db.tours.tierslieux86.fr failed: unexpected end of input\n</code></pre></p> <p>Une erreur se situe ici dans le fichier de configuration de la zone.</p> <p>On a le d\u00e9tail des erreurs avec la commande : <pre><code>named-checkzone zonename filename /var/named/db.tours.tierslieux86.fr\n</code></pre></p> <p>Erreurs courantes : * les nombreux \";\"  des fichiers de configuration globale ; * les noms DNS pleinement qualifi\u00e9s dans les fichiers de zone non suffix\u00e9s par un point ; * les parenth\u00e8ses mal plac\u00e9es de l'enregistrement SOA ; * la non relecture de bind9 lorsqu'un fichier de configuration est modifi\u00e9 et le non vidage du cache.</p>"},{"location":"documentation/DNS/7--Tests/#3-deuxieme-batterie-de-tests-verification-des-donnees-relatives-a-chaque-zone","title":"3. Deuxi\u00e8me batterie de tests : v\u00e9rification des donn\u00e9es relatives \u00e0 chaque zone.","text":"<p>L'utilisation des commandes nslookup, host ou dig vous permettra de v\u00e9rifier les donn\u00e9es relatives \u00e0 chaque zone. Nous ne d\u00e9taillerons ici que la commande dig (Domain Information Groper) qui donne beaucoup de d\u00e9tails... \u00c0 l'inverse de nslookup, cette commande n'est pas interactive.</p> <pre><code>dig www.reseaucerta.org\n\n; &lt;&lt;&gt;&gt; DiG 9.5.0-P2 &lt;&lt;&gt;&gt; www.reseaucerta.org\n;; global options:  printcmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 26702\n;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 3, ADDITIONAL: 3\n\n\n\n\n;; QUESTION SECTION: (1)\n;www.reseaucerta.org.           IN      A\n\n;; ANSWER SECTION: (2)\nwww.reseaucerta.org.    1785    IN      CNAME   strasbourg.reseaucerta.org.\nstrasbourg.reseaucerta.org. 3585 IN     A       130.79.130.89\n\n;; AUTHORITY SECTION: (3)\nreseaucerta.org.        10785   IN      NS      c.dns.gandi.net.\nreseaucerta.org.        10785   IN      NS      b.dns.gandi.net.\nreseaucerta.org.        10785   IN      NS      a.dns.gandi.net.\n\n;; ADDITIONAL SECTION: (4)\na.dns.gandi.net.        117683  IN      A       217.70.179.40\nb.dns.gandi.net.        117683  IN      A       217.70.184.40\nc.dns.gandi.net.        117683  IN      A       217.70.182.20\n\n;; Query time: 2 msec (5)\n;; SERVER: 192.168.1.1#53(192.168.1.1)\n;; WHEN: Wed Jan 28 12:20:18 2009\n;; MSG SIZE  rcvd: 187\n</code></pre> <p>(1) La section QUESTION reprend  la requ\u00eate \u00e9mise.\\ (2) La section ANSWER donne la r\u00e9ponse \u00e0 la requ\u00eate.\\ (3) La section AUTHORITY donne les serveurs de noms ayant autorit\u00e9 sur la zone.\\ (4) La section ADDITIONAL donne les adresses IP des serveurs de noms autoritaires.\\ (5) La section Query time donne le temps de r\u00e9ponse de la requ\u00eate. Cette valeur indique donc si la r\u00e9ponse est en cache ou pas.</p> <p>Pour filtrer les r\u00e9sultats, on peut pr\u00e9ciser, dans la requ\u00eate, les diff\u00e9rents types de RR : <pre><code>dig www.reseaucerta.org NS\ndig www.reseaucerta.org A\ndig www.reseaucerta.org MX\ndig -x 192.168.1.124\n...\n</code></pre></p> <p>L'option +trace de la commande dig permet de faire la recherche en parcourant l'arborescence depuis la racine jusqu'\u00e0 la r\u00e9ponse.</p> <pre><code>dig +trace www.domaine-grp1.com\n\n; &lt;&lt;&gt;&gt; DiG 9.5.0-P2 &lt;&lt;&gt;&gt; +trace www.domaine-grp1.com\n;; global options:  printcmd\n.                       3600000 IN      NS      A.ROOT-SERVERS.NET.\n;; Received 48 bytes from 192.168.1.2#53(192.168.1.2) in 0 ms\n\ndomaine-grp1.com.      3600    IN      NS      ns.domaine-grp1.com.\n;; Received 72 bytes from 192.168.1.124#53(A.ROOT-SERVERS.NET) in 14 ms\n\nwww.domaine-grp1.com. 86400 IN      CNAME      ns.domaine-grp1.com.\nns1.domaine-grp1.com. 86400 IN      A           192.168.10.10\ndomaine-grp1.com.     86400 IN      NS         ns.domaine-grp1.com.\n;; Received 72 bytes from 192.168.10.10#53(ns.domaine1-grp1.com) in 3 ms\n</code></pre> <p>Observons maintenant une requ\u00eate qui fournit une r\u00e9ponse n\u00e9gative.</p> <pre><code>dig www.domaine-grp1.com\n\n; &lt;&lt;&gt;&gt; DiG 9.5.0-P2 &lt;&lt;&gt;&gt; www.domaine1-grp1.com\n;; global options:  printcmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NXDOMAIN, id: 9054\n;; flags: qr aa rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 0\n\n;; QUESTION SECTION:\n;www.domaine-grp1.com.          IN      A\n\n;; AUTHORITY SECTION:\ndomaine-grp1.com.       3600    IN      SOA     ns.domaine-grp1.com. hostmaster.domaine-grp1.com. 20090126 86400 21600 3600000 3600\n\n;; Query time: 3 msec\n;; SERVER: 192.168.1.2#53(192.168.1.2)\n;; WHEN: Wed Jan 28 15:31:44 2009\n;; MSG SIZE  rcvd: 97\n</code></pre> <p>Il existe un autre type de r\u00e9ponse n\u00e9gative : NODATA  qui indique qu'aucune donn\u00e9e pour le triplet (nom, type, classe) demand\u00e9 n'existe ; mais il existe d'autres enregistrements poss\u00e9dant ce nom, mais de  type diff\u00e9rent.</p> <p>Si l'on trouve, apr\u00e8s status, le mot cl\u00e9 SERVFAIL, il n'y a pas de r\u00e9ponse et il faut revenir \u00e0 la premi\u00e8re batterie de test car le serveur a mal d\u00e9marr\u00e9.</p> <p>Attention</p> <p>Cela ne vient pas forc\u00e9ment de votre serveur mais d'un des serveurs interrog\u00e9s de mani\u00e8re r\u00e9cursive.</p> <p>Remarque</p> <p>Attention au cache qui pourrait fournir des r\u00e9ponses qui ne sont plus valables ; la commande rndc flush  permet de supprimer toutes donn\u00e9es en cache.</p>"},{"location":"documentation/DNS/7--Tests/#4troisieme-batterie-de-tests-verification-de-la-non-recursivite-dun-serveur-dns","title":"4.Troisi\u00e8me batterie de tests : v\u00e9rification de la non r\u00e9cursivit\u00e9 d'un serveur DNS","text":"<p>Vous devez configurer le client DNS d'un poste n'appartenant pas \u00e0 votre r\u00e9seau sur votre serveur DNS qui n'accepte pas la r\u00e9cursivit\u00e9 externe.</p> <p>Une m\u00eame requ\u00eate doit \u00eatre :</p> <ul> <li>refus\u00e9e si demande r\u00e9cursive \u00e0 partir d'un poste n'appartenant pas au r\u00e9seau.</li> </ul> <pre><code>dig www.domaine-grp1.com\n; &lt;&lt;&gt;&gt; DiG 9.5.0-P2 &lt;&lt;&gt;&gt; www.domaine-grp1.com\n;; global options:  printcmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: REFUSED, id: 20371\n;; flags: qr rd; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 0\n;; WARNING: recursion requested but not available\n\n;; QUESTION SECTION:\n;www.domaine-grp1.com.                        IN      A\n\n;; Query time: 0 msec\n;; SERVER: 192.168.1.2#53(192.168.1.2)\n;; WHEN: Wed Jan 28 19:06:41 2009\n;; MSG SIZE  rcvd: 32\n</code></pre> <ul> <li>accept\u00e9e si provenant du r\u00e9seau interne.</li> </ul> <pre><code>dig www.domaine-grp1.com\n\n; &lt;&lt;&gt;&gt; DiG 9.5.0-P2 &lt;&lt;&gt;&gt; www.domaine-grp1.com\n;; global options:  printcmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 12560\n;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 1, ADDITIONAL: 0\n\n;; QUESTION SECTION:\n;www.domaine-grp1.com.                        IN      A\n\n;; ANSWER SECTION:\nwww.domaine-grp1.com.   86233       IN   CNAME   ns.domaine-grp1.com.\nns1.domaine-grp1.com.   86233   IN      A       192.168.10.10\n\n;; AUTHORITY SECTION:\ndomaine-grp1.com.     86233   IN      NS      ns.domaine-grp1.com.\n\n;; Query time: 17 msec\n;; SERVER: 192.168.1.2#53(192.168.1.2)\n;; WHEN: Wed Jan 28 19:14:01 2009\n;; MSG SIZE  rcvd: 90\n</code></pre>"},{"location":"documentation/DNS/7--Tests/#5quatrieme-batterie-de-tests-controle-des-transferts-de-zone","title":"5.Quatri\u00e8me batterie de tests : contr\u00f4le des transferts de zone","text":"<p>Il suffit en fait de lire les fichiers de trace (logs) lorsque vous lancez pour la premi\u00e8re fois votre serveur secondaire ou que vous modifiez le contenu d'un fichier de zone (sans oublier de modifier le num\u00e9ro de s\u00e9rie).</p> <p>Dans les fichiers de trace du serveur secondaire, vous devriez trouver quelque chose de ce style :</p> <pre><code>Jan 29 16:15:26 nsd named[20736]: zone domaine-grp1.com/IN: Transfer started.\nJan 29 16:15:26 nsd named[20736]: transfer of 'domaine-grp1.com/IN' from 192.168.1.2#53: connected using 192.168.10.100#56170\nJan 29 16:15:26 nsd named[20736]: zone domaine-grp1.com/IN: transferred serial 20090126\nJan 29 16:15:26 nsd named[20736]: transfer of 'domaine-grp1.com/IN' from 192.168.10.10#53: Transfer completed: 1 messages, 7 records, 225 bytes, 0.015 secs (15000 bytes/sec)\nJan 29 16:15:26 nsd named[20736]: zone domaine-grp1.com/IN: sending notifies (serial 20090126)\n</code></pre> <p>Sur le serveur ma\u00eetre :</p> <pre><code>Jan 29 16:21:29 ns1 named[8190]: client 192.168.10.100#56170: transfer of 'domaine-grp1.com/IN': AXFR started\nJan 29 16:21:29 ns1 named[8190]: client 192.168.10.100#56170: transfer of 'domaine-grp1.com/IN': AXFR ended\n</code></pre> <p>Vous pouvez maintenant v\u00e9rifier que les fichiers de zones sur le serveur secondaire ont bien \u00e9t\u00e9 cr\u00e9\u00e9s.</p> <p>L'erreur fr\u00e9quente consiste \u00e0 ne pas accorder le droit d'\u00e9crire au groupe syst\u00e8me bind sur le r\u00e9pertoire /var/cache/bind/. C'est certainement le cas si vous avez les traces suivantes sur le serveur secondaire :</p> <pre><code>Jan 29 16:20:23 ns1 named[20970]: dumping master file: /var/cache/bind/slave/tmp-FqJO3iWCxz: open: permission denied\nJan 29 16:20:23 ns1 named[20970]: transfer of 'domaine-grp1.com/IN' from 192.168.10.10#53: failed while receiving responses: permission denied\n</code></pre> <p>Pour tester le serveur secondaire, vous devez configurer les DNS du client de mani\u00e8re \u00e0 ce qu'il pointe vers le serveur secondaire.</p>"},{"location":"documentation/Linux/2--OTP/","title":"Authentification TOTP sur Debian","text":""},{"location":"documentation/Linux/2--OTP/#1-rappel-sur-les-mots-de-passe-a-usage-unique-hotptotp","title":"1. Rappel sur les mots de passe \u00e0 usage unique (HOTP/TOTP)","text":"<p>HOTP</p> <p>HOTP (pour HMAC One Time Password) est un m\u00e9canisme d\u2019authentification reposant sur l\u2019utilisation d\u2019une cl\u00e9 secr\u00e8te et d\u2019un compteur commun entre le client et le serveur. HOTP ne n\u00e9cessite donc pas l\u2019utilisation d\u2019une horloge. Il se base sur HMAC. HMAC est un type de code d\u2019authentification de message qui combine l\u2019utilisation d\u2019une fonction de hachage (SHA-256) avec une cl\u00e9 secr\u00e8te dans le but de v\u00e9rifier simultan\u00e9ment l\u2019int\u00e9grit\u00e9 des donn\u00e9es et l\u2019authenticit\u00e9 du message. Toutefois, HOTP est susceptible de perdre la synchronisation du compteur entre le client (par exemple la cl\u00e9 de s\u00e9curit\u00e9) et le serveur. Il peut ainsi s\u2019av\u00e9rer difficile de maintenir un compteur commun.</p> <p></p> <p>TOTP</p> <p>Un mot de passe \u00e0 usage unique bas\u00e9 sur le temps (TOTP, Time based One Time Password en anglais) est un algorithme permettant de g\u00e9n\u00e9rer un mot de passe \u00e0 usage unique. Ainsi, TOTP permet la g\u00e9n\u00e9ration d\u2019une s\u00e9quence de caract\u00e8res valable seulement pendant un intervalle de temps limit\u00e9 afin de constituer un m\u00e9canisme de double authentification. C\u2019est une extension du mot de passe \u00e0 usage unique bas\u00e9 sur HMAC. Contrairement \u00e0 HOTP qui n\u00e9cessite un compteur incr\u00e9mental partag\u00e9 entre les deux entit\u00e9s pour garantir l'utilisation unique, TOTP utilise l'heure (sous r\u00e9serve que les horloges soient synchronis\u00e9es) et un secret partag\u00e9. Un intervalle de temps de validit\u00e9 est d\u00e9fini pour tol\u00e9rer une d\u00e9synchronisation des horloges.<sup>1</sup></p> <p>Phase d'enregistrement</p> <p></p> <p>Phase d'authentification</p> <p></p> <p>Dans le sch\u00e9ma ci-dessus, nous constatons que la cl\u00e9 secr\u00e8te est commune et qu\u2019elle a \u00e9t\u00e9 transmise au client lors de la phase d\u2019enregistrement. L\u2019avantage de passer par une cl\u00e9 de s\u00e9curit\u00e9 est de pouvoir stocker cette cl\u00e9 secr\u00e8te sur un mat\u00e9riel sp\u00e9cifique et non directement sur le smartphone ou sur l\u2019ordinateur client.</p> <p>Attention</p> <p>Contrairement \u00e0 la norme FIDO 2, TOTP ne prot\u00e8ge pas d\u2019un certain nombre d\u2019attaques (phishing, fuite du secret commun sur le serveur). Cette m\u00e9thode d\u2019authentification est donc moins robuste que FIDO 2 et ne respecte pas l\u2019\u00e9tat de l\u2019art. Cependant, elle reste une alternative int\u00e9ressante \u00e0 l'usage d'un simple mot de passe pour l'acc\u00e8s \u00e0 des comptes sensibles.</p>"},{"location":"documentation/Linux/2--OTP/#2-schema-de-principe-concernant-la-configuration-de-totp-sur-un-systeme-debian","title":"2. Sch\u00e9ma de principe concernant la configuration de TOTP sur un syst\u00e8me Debian","text":""},{"location":"documentation/Linux/2--OTP/#3-prerequis-sur-le-smartphone-et-le-poste-client","title":"3. Pr\u00e9requis sur le smartphone et le poste client","text":"<p>Sur votre smartphone, installez l\u2019application FreeOTP+ sur Android ou FreeOTP Authenticator sur IOS (ou toute application OTP compatible). Sur votre poste client Kali ou Ubuntu, installez le paquet qrencode qui permet de g\u00e9n\u00e9rer un QR code afin de param\u00e9trer l\u2019application FreeOTP+ (ou toute application similaire dans un environnement Windows) en lien avec le service oath pr\u00e9sent sur le serveur Debian 12.</p> <pre><code>sudo apt install qrencode\n</code></pre> <p>On s\u2019assurera \u00e9galement que la connexion SSH entre le poste client et le serveur Debian est pleinement op\u00e9rationnelle. Si ce n\u2019est pas le cas, il sera imp\u00e9ratif d\u2019installer le service OpenSSH sur le serveur Debian 12 (sudo apt install openssh-server).</p> <pre><code>ssh etudiant@192.168.1.90\netudiant@192.168.1.90's password: \nLinux serveur 6.1.0-17-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.69-1 (2023-12-30) x86_64\n\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nLast login: Wed Jan  3 19:34:10 2024 from 192.168.1.85\netudiant@serveur:~$\n</code></pre>"},{"location":"documentation/Linux/2--OTP/#4-configuration-du-serveur-debian","title":"4. Configuration du serveur Debian","text":"<p>Dans un premier temps, il sera n\u00e9cessaire d\u2019installer les paquets permettant de mettre en \u0153uvre le m\u00e9canisme d\u2019OTP nomm\u00e9 OATH<sup>2</sup> sur le serveur.</p> <pre><code>sudo apt install libpam-oath oathtool\n</code></pre> <p>Puis, nous allons d\u00e9finir un secret sous forme hexad\u00e9cimal qui sera utilis\u00e9 par le g\u00e9n\u00e9rateur TOTP/HOTP en lien avec l\u2019utilisateur \u00e9tudiant et qui sera soumis \u00e0 la double authentification.</p> <p>Attention</p> <p>Ce secret doit \u00eatre jalousement gard\u00e9 car c\u2019est la cl\u00e9 de vo\u00fbte servant \u00e0 la g\u00e9n\u00e9ration des mots de passe \u00e0 usage unique. S\u2019il est compromis, c\u2019est l\u2019ensemble de l\u2019authentification OTP qui sera impact\u00e9.</p> <pre><code>sudo -i\nKEY=$(openssl rand -hex 20)\necho \"HOTP/T30/6 etudiant - ${KEY}\" &gt;&gt; /etc/security/users.oath\nchown root /etc/security/users.oath \nchown 600 /etc/security/users.oath\n</code></pre> <p>Nous allons maintenant configurer PAM (Pluggable Authentication Modules), le service qui contr\u00f4le les authentifications sur le serveur Debian.</p> <pre><code>nano /etc/pam.d/sshd\n</code></pre> <pre><code># PAM configuration for the Secure Shell service\n\n# Standard Un*x authentication.\n#@include common-auth\n\nauth required pam_unix.so nullok_secure\nauth required pam_oath.so usersfile=/etc/security/users.oath window=30 digits=6\n</code></pre> <p>Nous commentons la ligne @include common-auth car elle emp\u00eache l\u2019authentification OTP m\u00eame en cas de connexion avec le bon mot de passe.</p> <p>La ligne suivante impose l\u2019authentification par mot de passe stock\u00e9 en local sur le syst\u00e8me et interdit les mots de passe vides.</p> <p>La derni\u00e8re impose une fois l\u2019authentification par mot de passe r\u00e9ussie, une deuxi\u00e8me authentification par OTP. Nous faisons r\u00e9f\u00e9rence au fichier contenant le (ou les) nom d\u2019utilisateur concern\u00e9 ainsi que le secret servant \u00e0 g\u00e9n\u00e9rer des mots de passe \u00e0 usage unique. Ce mot de passe disposera de 6 chiffres et aura une dur\u00e9e de validit\u00e9 de 30 secondes.</p> <p>Il nous reste maintenant \u00e0 \u00e9diter le fichier de configuration du service SSH afin de d\u00e9finir l\u2019usage de l\u2019authentification 2FA.</p> <pre><code>nano /etc/ssh/sshd_config\n</code></pre> <pre><code>ChallengeResponseAuthentication yes\n#KbdInteractiveAuthentication no\nUsePAM yes\n</code></pre> <p>Nous nous assurons de commenter la ligne KdbInteractiveAuthentication et d\u2019avoir les deux autres lignes activ\u00e9es avec la valeur yes. Nous pouvons ensuite red\u00e9marrer le service SSH.</p> <pre><code>systemctl restart ssh\n</code></pre> <p>Enfin, il nous reste \u00e0 r\u00e9cup\u00e9rer le secret en base 32 qui nous permettra ensuite de g\u00e9n\u00e9rer sur le poste client un QR code pour notre application Android.</p> <pre><code>cat /etc/security/users.oath\n</code></pre> <pre><code>HOTP/T30/6 etudiant \u2013 65f43c705ce51c9c058ec8bb4b7f64b656681866\nroot@serveur:~# oathtool -v -d 6 65f43c705ce51c9c058ec8bb4b7f64b656681866\nHex secret: 65f43c705ce51c9c058ec8bb4b7f64b656681866\nBase32 secret: MX2DY4C44UOJYBMOZC5UW73EWZLGQGDG\nDigits: 6\nWindow size: 0\nStart counter: 0x0 (0)\n</code></pre> <p>Attention</p> <p>Pour que la partie TOTP soit pleinement fonctionnelle, vous devez vous assurer que les horloges des diff\u00e9rentes machines sont synchronis\u00e9es et \u00e0 l\u2019heure.</p>"},{"location":"documentation/Linux/2--OTP/#5-configuration-du-poste-client-et-de-lapplication-android-freeotp","title":"5. Configuration du poste client et de l'application Android FreeOTP+","text":"<p>Il s\u2019agit maintenant de param\u00e9trer correctement la machine cliente et l\u2019application Android FreeOTP+ afin de rendre op\u00e9rationnel l\u2019authentification SSH 2FA.</p> <p>Nous allons d\u2019abord g\u00e9n\u00e9rer sur le poste client (Ubuntu ou Kali) un fichier png contenant un QR code que nous soumettrons \u00e0 l\u2019application FreeOTP+.</p> <pre><code>qrencode -o etudiant.png 'otpauth://totp/etudiant@192.168.1.90?secret=MX2DY4C44UOJYBMOZC5UW73EWZLGQGDG'\n</code></pre> <pre><code>ls -l\n\u2026\n-rw-r--r-- 1 etudiant etudiant        471  3 janv. 23:08  etudiant.png\n</code></pre> <p>Nous pouvons ouvrir ce fichier PNG sur le poste client puis ouvrir l\u2019application FreeOTP+ sur le smartphone.</p> <p>S\u00e9lectionner l\u2019ic\u00f4ne \u00ab\u00a0Appareil photo\u00a0\u00bb en bas \u00e0 droite. Puis prenez en photo le QR code pr\u00e9sent sur l\u2019\u00e9cran du client. Une nouvelle configuration pour votre utilisateur et votre serveur est automatiquement cr\u00e9\u00e9e.</p> <p>Nous pouvons ensuite supprimer le fichier PNG contenant le QR code, car il contient le secret \u00e0 ne pas compromettre.</p> <p>Sur le client, nous pouvons lancer une connexion SSH vers le serveur avec le compte etudiant. Apr\u00e8s avoir entr\u00e9 votre mot de passe, un OTP vous est demand\u00e9. Dans l\u2019application FreeOTP+, s\u00e9lectionnez la nouvelle configuration. Celle-ci vous fournit un code de 6 chiffres valable 30 secondes.</p> <pre><code>ssh etudiant@192.168.1.90               \n(etudiant@192.168.1.90) Password: \n(etudiant@192.168.1.90) One-time password (OATH) for `etudiant': \nLinux serveur 6.1.0-17-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.69-1 (2023-12-30) x86_64\n\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nLast login: Wed Jan  3 22:17:13 2024 from 192.168.1.85\netudiant@serveur:~$\n</code></pre> <ol> <li> <p>Source - Wikip\u00e9dia\u00a0\u21a9</p> </li> <li> <p>Initiative pour l\u2019authentification ouverte est une collaboration industrielle visant \u00e0 d\u00e9velopper une architecture de r\u00e9f\u00e9rence ouverte utilisant des normes ouvertes pour promouvoir l\u2019adoption d\u2019une authentification plus robuste que le simple mot de passe\u00a0\u21a9</p> </li> </ol>"},{"location":"documentation/Stormshield/commandesUtilesConsole_SNS/","title":"CheatSheet","text":""},{"location":"documentation/Stormshield/commandesUtilesConsole_SNS/#commandes-utiles-de-console-ou-en-ssh-des-vm-pare-feu-sns","title":"Commandes utiles de console (ou en ssh) des VM Pare-feu SNS","text":""},{"location":"documentation/Stormshield/commandesUtilesConsole_SNS/#reinitialiser-le-pare-feu-avec-la-commande-defaultconfig","title":"R\u00e9initialiser le pare-feu avec la commande defaultconfig","text":"<pre><code>defaultconfig\u00a0\n\nUsage: \\[options\\]\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -f:\u00a0\u00a0\u00a0\u00a0 Force\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -r:\u00a0\u00a0\u00a0\u00a0 Reboot after defaultconfig\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -D:\u00a0\u00a0\u00a0\u00a0 Only Restore the data partition\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -p:\u00a0\u00a0\u00a0\u00a0 Reset password\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -u:\u00a0\u00a0\u00a0\u00a0 Check usb token boot restoration\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -d:\u00a0\u00a0\u00a0\u00a0 Dump root partition after defaultconfig\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -k:\u00a0\u00a0\u00a0\u00a0 Keep autoupdate data (Pattern, Pvm, Clamav, Kaspersky, URLFiltering), default SSL proxy authority, default sslvpn full authority and ssh host keys\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -l:\u00a0\u00a0\u00a0\u00a0 Keep network configuration file\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -n:\u00a0\u00a0\u00a0\u00a0 Do not mark firewall as having a defaultconfig configuration\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -c:\u00a0\u00a0\u00a0\u00a0 No backup files (.old)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -L:\u00a0\u00a0\u00a0\u00a0 Remove logs\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -s:\u00a0\u00a0\u00a0\u00a0 Safe mode. Restore network configuration with only first interface enabled.\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 -t:\u00a0\u00a0\u00a0\u00a0 Reset TPM (TPM password required)\n</code></pre> <ul> <li>taper ceci  pour red\u00e9marrer en configuration usine. <pre><code>defaultconfig --f --r --p --c -L\n</code></pre></li> </ul>"},{"location":"documentation/Stormshield/commandesUtilesConsole_SNS/#principe-de-la-modification-de-la-configuration","title":"Principe de la modification de la configuration","text":"<p>La configuration du pare-feu se trouve dans le dossier ConfigFiles. Il est possible d'intervenir directement dans les fichiers (des exemples sont tr\u00e8s souvent pr\u00e9sents).</p> <p>Une fois la modification r\u00e9alis\u00e9e, il est n\u00e9cessaire de recharger la configuration. L\u00e0 aussi, cela suit un m\u00eame principe\u00a0: la commande commence par \u00ab\u00a0en\u00a0\u00bb, en saisissant ces 2 lettres et en \u00ab\u00a0tabulant\u00a0\u00bb, on dispose de l'ensemble des commandes qui sont dans /usr/Firewall/sbin. Il faut bien s\u00fbr lancer la commande correspondante \u00e0 la modification op\u00e9r\u00e9e.</p> <p>Par exemple, pour modifier l'adresse IP d'une interface\u00a0:</p> <p><pre><code>vi ConfigFiles/network \n</code></pre> \u21d2 Modification des param\u00e8tres souhait\u00e9s \u00e0 l'aide de vi. D\u00e9finition des principaux param\u00e8tres sous le nom de section de l'interface ( [ethernet0] )\u00a0:</p> <ul> <li>State = 1 ou 0 Connectivit\u00e9 de l\\'interface activ\u00e9e ou non</li> <li>Media = 0 \u00e0 6 D\u00e9finit la vitesse de m\u00e9dia (0 = auto-n\u00e9gociation)</li> <li>Protected = 1 ou 0 Interface prot\u00e9g\u00e9e ou non (anti-spoofing sur des     interfaces internes)</li> <li>Address</li> <li>Mask</li> <li>Gateway</li> <li>Sauvegarder les modifications.</li> <li>Il suffit ensuite de recharger les configurations\u00a0:</li> </ul> <pre><code>ennetwork\n</code></pre> <p>Un ifconfig permet de valider la prise en compte des nouveaux param\u00e8tres.</p> <p>Si on modifie la politique de filtrage\u00a0:  <pre><code>enfilter -u\n</code></pre></p>"},{"location":"documentation/Stormshield/fiche01_initialiser_SNS/","title":"Fiche 01 -- Initialiser un Pare-feu SNS","text":""},{"location":"documentation/Stormshield/fiche01_initialiser_SNS/#procedure-de-remise-a-zero-des-pare-feu-sns","title":"Proc\u00e9dure de remise \u00e0 z\u00e9ro des pare-feu SNS","text":"<p>Cette proc\u00e9dure ne doit \u00e9videmment \u00eatre d\u00e9roul\u00e9e que sur un SNS qui aurait d\u00e9j\u00e0 \u00e9t\u00e9 configur\u00e9.</p> <p>Un RAZ du pare-feu peut \u00eatre fait via la console (sur les VM ou les boitiers physiques), ceci n\u00e9cessite un red\u00e9marrage (reboot). Sur les bo\u00eetiers physiques\u00a0: un appui sur le bouton reset pour les bo\u00eetiers physiques permet de restaurer la configuration d'usine et red\u00e9marrer en bridge sur toutes les interfaces.</p> <p>Vous pouvez faire le choix de r\u00e9initialiser un boitier physique via l'acc\u00e8s console. Pour cela, installer le driver du c\u00e2ble console sur Windows\u00a0: https://ftdichip.com/drivers/vcp-drivers/.</p> <p>Lancer un logiciel permettant l'acc\u00e8s console (Putty, Teraterm, minicom) et utilisant en d\u00e9bit 115200.</p> <p></p> <p>Sur une VM\u00a0:</p> <ul> <li>d\u00e9marrer (ou red\u00e9marrer) la machine virtuelle et s'authentifier pour     acc\u00e9der \u00e0 la console en administrateur\u00a0;</li> <li>saisir la commande </li> </ul> <pre><code>defaultconfig --f --r --p --c -L\n</code></pre>"},{"location":"documentation/Stormshield/fiche01_initialiser_SNS/#configuration-initiale","title":"Configuration initiale","text":"<p>La configuration d'usine par d\u00e9faut du *pare-feu SNS * est la suivante.</p> <p>Dans une configuration usine, notamment pour les machines virtuelles et les mod\u00e8les SN310, la premi\u00e8re interface (1) du pare-feu SNS physique est nomm\u00e9e \u00ab\u00a0OUT\u00a0\u00bb, la seconde \u00ab\u00a0IN\u00a0\u00bb et le reste des interfaces \u00ab\u00a0DMZx\u00a0\u00bb. L'interface \u00ab\u00a0OUT\u00a0\u00bb est une interface externe, utilis\u00e9e pour connecter le pare-feu SNS \u00e0 internet et le reste des interfaces sont internes et servent principalement \u00e0 connecter le pare-feu SNS \u00e0 des r\u00e9seaux locaux.</p> Attention <p>Attention au brassage ! La distinction interne/externe pour les interfaces permet de se prot\u00e9ger contre les attaques d'usurpation d'adresse IP IPSpoofing.</p> <p></p> <p>Le sch\u00e9ma pr\u00e9sent\u00e9 ci-dessous correspond, quant \u00e0 lui, \u00e0 un bo\u00eetier SN210. Comme vous pouvez le constater, l'organisation des interfaces est diff\u00e9rente de celle des machines virtuelles ou des mod\u00e8les SN310 et sup\u00e9rieur.</p> <p></p> <p>Pour initialiser le pare-feu, il faut se brancher sur l'interface IN.</p> <p>En configuration usine, sur un bo\u00eetier physique de type SN210 ou SN310, toutes les interfaces sont incluses dans un bridge dont l'adresse est 10.0.0.254/8. Sur les bo\u00eetiers physiques, un serveur DHCP est actif sur toutes les interfaces du bridge et il distribue des adresses IP comprises entre 10.0.0.10 et 10.0.0.100. L'acc\u00e8s \u00e0 l'interface web de configuration du pare-feu SNS se fait avec l'url\u00a0: https://10.0.0.254/admin.</p> <ul> <li>Sur le bo\u00eetier</li> </ul> <p>Par d\u00e9faut, seul le compte syst\u00e8me admin (mot de passe par d\u00e9faut admin), disposant de tous les privil\u00e8ges sur le bo\u00eetier, existe et peut se connecter.</p> <ul> <li>Sur une VM</li> </ul> <p>La configuration usine lance un dialogue de pr\u00e9-configuration qui demande de changer le mot de passe par d\u00e9faut, de configurer vos interfaces, le clavier de la console, etc\u00a0:</p> <p>Un premier \u00e9cran propose un choix qu'il n'est pas n\u00e9cessaire de valider, le syst\u00e8me continue automatiquement\u00a0:</p> <p></p> <p>Un premier red\u00e9marrage automatique est fait et la configuration continue\u00a0:</p> <p></p> <ul> <li>S\u00e9lectionner 4 pour fr (sur le clavier le chiffre 4 sans utiliser la     touche Maj).</li> </ul> <p></p> <ul> <li>Saisir un mot de passe de 8 caract\u00e8res minimum avec Maj/min/chiffre/caract\u00e8res sp\u00e9ciaux.</li> </ul> <p></p> <p>Passons \u00e0 la configuration des interfaces r\u00e9seau\u00a0:</p> <p></p> <p>M\u00eame si plusieurs interfaces ont \u00e9t\u00e9 ajout\u00e9es sur l'hyperviseur (Proxmox, VirtualBox ou VmWare), seulement 2 sont modifiables via l'assistant du d\u00e9marrage.</p> <p>Les interfaces peuvent \u00eatre laiss\u00e9es en DHCP ou \u00eatre configur\u00e9es via une adresse IP fixe.</p> <p>V\u00e9rifications</p> <p>Sachant qu'il est d\u00e9conseill\u00e9 d'administrer le pare-feu via l'interface OUT, l'id\u00e9e est de configurer l'interface IN de mani\u00e8re \u00e0 ce qu'elle se trouve connect\u00e9e \u00e0 un r\u00e9seau logique sur lequel est \u00e9galement connect\u00e9 (ou peut \u00eatre connect\u00e9) un poste de travail permettant de proc\u00e9der \u00e0 l'administration du Stormshield.</p> <p>Lors de cette configuration, le param\u00e9trage pourra \u00eatre, bien s\u00fbr, modifi\u00e9e et, par exemple, une autre interface pourra \u00eatre d\u00e9di\u00e9e \u00e0 l'administration, nottament via l'usage d'un vlan de management</p> <p>Pour ce premier d\u00e9marrage</p> <ul> <li>Laisser l'interface OUT en DHCP m\u00eame si aucun serveur DHCP n'est     reli\u00e9 au r\u00e9seau \u21d2 r\u00e9pondre \u00ab\u00a0n\u00a0\u00bb ou E</li> <li>Laisser l'interface IN en DHCP uniquement s'il y a un serveur     DHCP sur le r\u00e9seau sinon r\u00e9pondre \u00ab\u00a0y\u00a0\u00bb pour mettre une adresse IP     accessible via le r\u00e9seau. Par exemple\u00a0:</li> </ul> <p></p> <p>R\u00e9pondre \u00ab\u00a0n\u00a0\u00bb sur la derni\u00e8re question, en effet il n'est pas recommand\u00e9 d'autoriser l'administration sur votre interface OUT.</p> <p></p> <p>Votre syst\u00e8me est install\u00e9 avec les valeurs rappel\u00e9es ci-dessus, vous pouvez tester que la configuration du clavier a bien \u00e9t\u00e9 prise en compte en saisissant votre login/mdp.</p> <p></p> <p>L'interface d'administration est accessible \u00e0 l'adresse https://@IP-IN/admin/ \u00e0 partir d'un poste sur le m\u00eame r\u00e9seau.</p> <p>Basculer sur la fiche n\u00b02 pour une premi\u00e8re configuration du bo\u00eetier ou de la VM.</p> <p>Plus d'informations</p> <p>https://documentation.stormshield.eu/SNS/v4/fr/Content/Software_Recovery_via_USB_key/SN150-SN160-SN160W-SN210-SN210W-SN310.htm</p>"},{"location":"documentation/Stormshield/fiche02_priseEnMain_SNS/","title":"Fiche 02 -- Prise en main d'un Pare-feu SNS","text":"<p>Documentation officielle</p> <p>https://documentation.stormshield.eu/SNS/v4/fr/Content/User_Configuration_Manual_SNS_v4/Welcome/WELCOME.htm</p>"},{"location":"documentation/Stormshield/fiche02_priseEnMain_SNS/#connexion-au-pare-feu-sns","title":"Connexion au pare-feu SNS","text":"<p>Pour acc\u00e9der \u00e0 l'interface d'administration du pare-feu SNS, il est indispensable de connecter votre machine cliente (physique ou virtuelle) sur une interface interne (IN ou DMZ1 ou 2 sur les bo\u00eetiers SN310 et les machines virtuelles, IN sur les boitiers SN210) sous peine de devoir red\u00e9marrer le pare-feu qui aura d\u00e9tect\u00e9 une tentative d'usurpation d'adresse IP sur le bridge et bloquera tout le trafic g\u00e9n\u00e9r\u00e9 par la machine connect\u00e9e sur l'interface OUT.</p> <p>L'interface IN doit \u00eatre dans le m\u00eame r\u00e9seau que la machine \u00e0 partir de laquelle il va \u00eatre proc\u00e9d\u00e9 \u00e0 une premi\u00e8re configuration.</p> <p>L'acc\u00e8s \u00e0 l'interface graphique d'administration du pare-feu SNS se fait par https://@IP/admin (https://10.0.0.254/admin sur un bo\u00eetier) \u00e0 partir d'un navigateur web\u00a0:</p> L'\u00e9cran ci-contre appara\u00eet pour vous connecter une fois le pare-feu SNS d\u00e9marr\u00e9. - Pour modifier les options de langue de l'interface web d'administration, d\u00e9pliez Options puis choisissez la langue. La fen\u00eatre est actualis\u00e9e, vous pouvez vous connecter \u00e0 nouveau. - Saisir l'identifiant admin, le mot de passe admin ou celui que vous avez configur\u00e9 si vous avez effectu\u00e9 la r\u00e9initialisation de la machine virtuelle (par ex. Sio2022* ou autre). Remarque : pour s'authentifier, l'utilisateur peut \u00e9galement s\u00e9lectionner un certificat SSL dans le magasin de son navigateur (\u00e0 configurer au pr\u00e9alable dans les pr\u00e9f\u00e9rences du pare-feu SNS). Nous \u00e9tudierons cette possibilit\u00e9 dans la partie avanc\u00e9e sur la mise en place d'une PKI avec Stormshield. <p>S\u00e9curit\u00e9</p> <p>Pour des raisons \u00e9videntes de s\u00e9curit\u00e9, il conviendra de modifier ce mot de passe lorsque le pare-feu SNS sera utilis\u00e9 en contexte r\u00e9el d'entreprise.</p> <p>La page d'accueil de votre pare-feu SNS s'ouvre sur un\u00a0Tableau de bord qui permet de visualiser un certain nombre d'informations sur votre \u00e9quipement et est personnalisable.</p> <p></p>"},{"location":"documentation/Stormshield/fiche02_priseEnMain_SNS/#premiere-configuration","title":"Premi\u00e8re configuration","text":"<p>Nous verrons ci-apr\u00e8s un certain nombre d'\u00e9l\u00e9ments de configuration g\u00e9n\u00e9rale utiles pour la bonne mise en \u0153uvre de votre pare-feu SNS (pour des configurations plus avanc\u00e9es et autres d\u00e9tails, cf fichier v4CSNA_v4_Livre_formation_Stomshield.pdf).</p> <p>Vigilence</p> <p>Afin de ne jamais \u00eatre d\u00e9connect\u00e9 en cas d'inactivit\u00e9 sur l'interface d'administration pendant ces exercices pratiques, il conviendra de modifier vos pr\u00e9f\u00e9rences, en usage r\u00e9el vous utiliserez un d\u00e9lai de 5 minutes pour \u00e9viter de laisser votre session ouverte sur le pare-feu SNS.</p> <ul> <li>Cliquer sur la fl\u00e8che \u00e0 droite de l'ic\u00f4ne repr\u00e9sentant l'utilisateur     connect\u00e9      en haut \u00e0 droite.</li> <li>Cliquer sur l'ic\u00f4ne     Pr\u00e9f\u00e9rences </li> <li>Dans la zone Param\u00e8tres de connexion, s\u00e9lectionner dans la liste     \u00ab\u00a0D\u00e9connexion en cas d'inactivit\u00e9\u00a0:\u00a0\u00bb la valeur Toujours rester connect\u00e9.</li> </ul> <p></p> <p>Nous \u00e9tudierons notamment les \u00e9l\u00e9ments du menu Configuration / Syst\u00e8me qui correspond \u00e0 la configuration g\u00e9n\u00e9rale\u00a0: licence, mise \u00e0 jour, mot de passe, etc.</p>"},{"location":"documentation/Stormshield/fiche02_priseEnMain_SNS/#configuration-generale","title":"Configuration g\u00e9n\u00e9rale","text":"<ul> <li>S\u00e9lectionner dans le menu \u00e0 gauche\u00a0Configuration / Syst\u00e8me puis     Configuration. Le volet Configuration g\u00e9n\u00e9rale est affich\u00e9.</li> <li>Commencer par donner un nom \u00e0 votre bo\u00eetier\u00a0et changer la langue de la console.</li> </ul> <p>Il est pr\u00e9f\u00e9rable de mettre les logs en anglais\u00a0: Langue du pare-feu (traces) afin de pouvoir rechercher plus facilement des r\u00e9f\u00e9rences \u00e0 d'\u00e9ventuels probl\u00e8mes dans les ressources documentaires Stormshield et sur les forums avec les bons mots-cl\u00e9s.</p> <p>La zone Politique de mots de passe permet de d\u00e9finir la longueur du mot de passe (8 par d\u00e9faut) et la zone Types de caract\u00e8res obligatoires permet de g\u00e9rer la complexit\u00e9 du mot de passe\u00a0(Aucun, Alphanum\u00e9riques, Alphab\u00e9tiques et sp\u00e9ciaux), la zone Entropie minimale correspond \u00e0 la robustesse du mot de passe. En utilisation en entreprise, il est recommand\u00e9 de changer le mot de passe de l'administrateur et d'augmenter \u00e0 12 le nombre de caract\u00e8res.</p> <p></p> <p>La zone \u00ab\u00a0Param\u00e8tres de date et d'heure\u00a0\u00bb permet de modifier le fuseau horaire dans la zone Fuseau horaire, s\u00e9lectionnez Europe/Paris.</p> <p></p> <p>NB</p> <p>La modification du fuseau horaire implique un red\u00e9marrage imm\u00e9diat, pour ne pas avoir de d\u00e9calage dans les journaux ou avec une PKI*.</p> <ul> <li>Cliquer le bouton Appliquer pour sauvegarder la configuration et Sauvegarder</li> </ul> <p>Un avertissement puis une ic\u00f4ne  apparaissent vous invitant \u00e0 red\u00e9marrer le pare-feu. Il est bien s\u00fbr possible de le faire une fois les autres configurations r\u00e9alis\u00e9es.</p> <ul> <li> <p>Cliquer sur l'ic\u00f4ne et s\u00e9lectionner Red\u00e9marrer maintenant.</p> </li> <li> <p>Apr\u00e8s le red\u00e9marrage (au bout d'environ 3 minutes), revenir au menu     Configuration / Syst\u00e8me puis Configuration et dans la zone     Param\u00e8tres de date et d'heure cliquer sur Maintenir le     pare-feu \u00e0 l'heure (NTP) pour que les mises \u00e0 jour d'heure     d'\u00e9t\u00e9/heure d'hiver soient \u00e9galement effectives.</p> </li> </ul>"},{"location":"documentation/Stormshield/fiche02_priseEnMain_SNS/#administration-du-pare-feu","title":"Administration du pare-feu","text":"<ul> <li>Dans le volet Syst\u00e8me / Configuration, ouvrir l'onglet     Administration du pare-feu pour visualiser les options de     configuration de l'administration du pare-feu.</li> </ul> <p>Plusieurs options sont configurables mais ne sont pas d\u00e9taill\u00e9es ici (cf. fichier CSNA_v4_Livre_formation_Stomshield.pdf).</p>"},{"location":"documentation/Stormshield/fiche02_priseEnMain_SNS/#parametres-reseaux","title":"Param\u00e8tres r\u00e9seaux","text":"<ul> <li>Dans le volet Syst\u00e8me / Configuration, ouvrir l'onglet     Param\u00e8tres r\u00e9seaux pour visualiser les options de configuration     r\u00e9seau du pare-feu.</li> </ul> <p>Les pare-feu Stormshield Network supportent le protocole IPv6 et plusieurs fonctionnalit\u00e9s (interface, routage, filtrage, VPN et administration) sont compatibles IPv6. Cependant, ce support est optionnel et son activation s'effectue via le bouton Activer le support du protocole IPv6 sur ce pare-feu (ce qui est inutile ici).</p> <p>NOTE</p> <p>Cette action \u00e9tant irr\u00e9versible, la sauvegarde de la configuration du pare-feu vous sera propos\u00e9e automatiquement lorsque vous cliquerez sur ce bouton. Le retour \u00e0 un support IPv4 exclusif (sans IPv6) n'est possible qu'apr\u00e8s une remise \u00e0 la configuration usine (reset) du pare-feu.</p> <p>Dans le cas o\u00f9 le pare-feu transite par un proxy pour acc\u00e9der \u00e0 Internet, les param\u00e8tres se renseignent depuis ce menu.</p> <p>Un ou plusieurs serveurs DNS peuvent \u00eatre ajout\u00e9s. Le pare-feu contacte ces serveurs pour toute r\u00e9solution qu'il \u00e9met ou doit relayer. Ces r\u00e9solutions de noms sont n\u00e9cessaires pour des fonctionnalit\u00e9s telles que Active Update qui interroge les serveurs de mise \u00e0 jour pour t\u00e9l\u00e9charger les bases de donn\u00e9es (signatures contextuelles, antivirus, Vulnerability Manager, etc.).</p> <p>Pour ajouter un DNS\u00a0:</p> <ul> <li>Cliquer sur Ajouter puis saisir (ou choisir ou cr\u00e9er) un     \u00ab\u00a0objet\u00a0\u00bb (cf fiche 4) et cliquer sur le bouton Appliquer pour     sauvegarder la configuration et Sauvegarder.</li> </ul> <p>NOTE</p> <p>Ci-dessous, les trois DNS par d\u00e9faut (la machine elle-m\u00eame, et deux DNS de Google\u00a0!). Si on passe la souris sur l'objet, on voit les valeurs des propri\u00e9t\u00e9s de l'objet.</p> <p></p>"},{"location":"documentation/Stormshield/fiche02_priseEnMain_SNS/#autres-configurations","title":"Autres configurations","text":""},{"location":"documentation/Stormshield/fiche02_priseEnMain_SNS/#modification-du-mot-de-passe-de-ladministrateur","title":"Modification du mot de passe de l'administrateur","text":"<p>La modification du mot de passe admin (recommand\u00e9e) se fait dans le menu Configuration/Syst\u00e8me/Administrateurs puis onglet Compte ADMIN. Le mot de passe doit par d\u00e9faut, comporter au moins 8 caract\u00e8res et doit respecter la politique de mot de passe d\u00e9finie dans le menu Configuration. La robustesse du mot de passe choisit s'affiche alors. Elle indique son niveau de s\u00e9curit\u00e9 : Tr\u00e8s faible, faible, moyen, bon, excellent. Il est fortement conseill\u00e9 d'utiliser les majuscules et les caract\u00e8res sp\u00e9ciaux pour augmenter le niveau de s\u00e9curit\u00e9.</p>"},{"location":"documentation/Stormshield/fiche02_priseEnMain_SNS/#activation-de-la-licence","title":"Activation de la licence","text":"<p>Le menu Configuration / Syst\u00e8me / Licence affiche les d\u00e9tails de la licence et permet le cas \u00e9ch\u00e9ant de l'installer\u00a0:</p> <ul> <li>pour un bo\u00eetier\u00a0: \u00e0 r\u00e9cup\u00e9rer par l'administrateur sur le site     mystormshield.eu avec les informations figurant sous le bo\u00eetier.</li> <li>Pour une VM\u00a0: il est n\u00e9cessaire au pr\u00e9alable de proc\u00e9der \u00e0     l'activation du kit \u00e0 t\u00e9l\u00e9charger sur le site de Stormshield (voir     \u00e9galement page suivante)\u00a0:     https://documentation.stormshield.eu/SNS/v4/fr/Content/PDF/InstallationGuides/sns-fr_EVA_Guide_Installation.pdf</li> </ul> <p>Attention</p> <p>\u00c0 noter que si vous n'activez pas la licence au bout d'un certain temps les fonctionnalit\u00e9s se r\u00e9duisent et surtout vous ne pourrez pas stocker les logs sur les bo\u00eetiers physiques.</p> <p>Sur une VM, les fonctionnalit\u00e9s sans activation sont limit\u00e9es\u00a0:</p> <p></p> <ul> <li> <p>Pour activer la licence sur une VM\u00a0:</p> </li> <li> <p>Se connecter sur     https://mystormshield.eu.</p> </li> <li>Cliquer sur \u00ab\u00a0Product management\u00a0\u00bb (menu gauche) et t\u00e9l\u00e9charger le     kit d'activation.</li> <li>Revenir \u00e9ventuellement sur la page pour t\u00e9l\u00e9charger le fichier     licence, mais cette derni\u00e8re pourra \u00eatre activ\u00e9e automatiquement une     fois le kit d'activation int\u00e9gr\u00e9 via l'interface du pare-feu.</li> </ul> <p>Attention</p> <p></p> <p>Il est n\u00e9cessaire d'importer d'abord le fichier de mise \u00e0 jour t\u00e9l\u00e9charg\u00e9 via le kit d'activation.</p> <ul> <li>Activer le menu Configuration / Syst\u00e8me / Maintenance.</li> <li>L'onglet sur \u00ab\u00a0Mise \u00e0 jour du syst\u00e8me\u00a0\u00bb est activ\u00e9. Cliquer le     bouton \u00ab\u00a0...\u00a0\u00bb et s\u00e9lectionner la mise \u00e0 jour r\u00e9cup\u00e9r\u00e9e dans le kit     d'activation \u00e0 partir d'un poste client ou d'une cl\u00e9 USB.</li> </ul> <p></p> <p>Depuis la zone Configuration avanc\u00e9e, vous pouvez choisir de T\u00e9l\u00e9charger le firmware et l'activer ce qui appliquera la mise \u00e0 jour ou bien de la t\u00e9l\u00e9charger uniquement, son activation pourra se faire ult\u00e9rieurement avec l'option Activer le firmware pr\u00e9c\u00e9demment t\u00e9l\u00e9charg\u00e9.</p> <ul> <li>Dans la zone\u00a0Configuration avanc\u00e9e choisir T\u00e9l\u00e9charger le     firmware et l'activer.</li> <li> <p>Cliquer sur le     bouton\u00a0 L'op\u00e9ration prendra plusieurs minutes surtout ne d\u00e9branchez pas le pare-feu pendant la mise \u00e0 jour. Le pare-feu sera ensuite red\u00e9marr\u00e9.</p> </li> <li> <p>Une fois cette op\u00e9ration r\u00e9alis\u00e9e, activer le menu Configuration /     Syst\u00e8me / Licence puis cliquer sur \u00ab\u00a0Installer la nouvelle     licence\u00a0\u00bb. Cette derni\u00e8re s'active alors automatiquement.</p> </li> </ul> <p></p>"},{"location":"documentation/Stormshield/fiche02_priseEnMain_SNS/#mise-a-jour-du-systeme","title":"Mise \u00e0 jour du syst\u00e8me","text":"<p>Le menu Configuration / Syst\u00e8me / Maintenance / onglet Mise \u00e0 jour du syst\u00e8me permet de mettre \u00e0 jour le syst\u00e8me le cas \u00e9ch\u00e9ant. Afin d'appliquer un fichier de mise \u00e0 jour du firmware, vous devrez le t\u00e9l\u00e9charger sur le pare-feu (soit directement via le lien  une fois que la configuration du r\u00e9seau et de la passerelle par d\u00e9faut est r\u00e9alis\u00e9e et que le pare-feu a acc\u00e8s \u00e0 Internet, soit en allant le t\u00e9l\u00e9charger sur le site https://mystormshield.eu).</p> <p>Attention</p> <p>Pour que la mise \u00e0 jour puisse se faire, la date et l'heure doivent \u00eatre synchronis\u00e9 via le protocole NTP.roduct management\u00a0\u00bb (menu gauche)\u00a0:</p> <p>Attention</p> <p>Il est parfois n\u00e9cessaire de r\u00e9aliser les mises \u00e0 jour interm\u00e9diaires \u00e0 r\u00e9cup\u00e9rer sur le site de Stormshield (cela a \u00e9t\u00e9 le cas sur le SNS510 mais non sur les VM) m\u00eame en dehors de celles qui sont propos\u00e9es.</p> <ul> <li>Cliquer Configuration / Syst\u00e8me /     Maintenance / onglet Mise \u00e0 jour du syst\u00e8me.</li> <li>Cliquer le bouton \u00ab\u00a0...\u00a0\u00bb et s\u00e9lectionner le fichier de mise \u00e0 jour     pr\u00e9sent sur le poste client ou une cl\u00e9 USB.</li> <li>D\u00e9plier la zone Configuration avanc\u00e9e.</li> <li>Dans la \u00ab\u00a0configuration avanc\u00e9e\u00a0\u00bb, vous pouvez choisir de     T\u00e9l\u00e9charger le firmware et l'activer ce qui appliquera la     mise \u00e0 jour ou bien de la t\u00e9l\u00e9charger uniquement, son activation     pourra se faire ult\u00e9rieurement avec l'option Activer le firmware pr\u00e9c\u00e9demment t\u00e9l\u00e9charg\u00e9.</li> <li>Dans la zone\u00a0Configuration avanc\u00e9e choisir T\u00e9l\u00e9charger le     firmware et l'activer.</li> <li>Cliquer sur le     bouton\u00a0</li> </ul> <p>L'op\u00e9ration prendra plusieurs minutes surtout ne d\u00e9branchez pas le pare-feu pendant la mise \u00e0 jour. Le pare-feu sera ensuite red\u00e9marr\u00e9.</p> <p>Attention</p> <p></p> <p>Recharger la page si cette fen\u00eatre boucle ind\u00e9finiment.</p> <p>Le menu Configuration / Syst\u00e8me / Maintenance / onglet Configuration permet uniquement sur les bo\u00eetiers physiques de d\u00e9terminer la partition active et ainsi de garder deux versions du syst\u00e8me disponibles avec une partition de sauvegarde qui permet de revenir en arri\u00e8re sur le boitier (firmware n-1, config n-1).</p> <p>NB\u00a0: Pour revenir \u00e0 une configuration ou version n-2 ou sup\u00e9rieure il faut utiliser USB Recovery accessible seulement sur mystormshield.eu avec un compte client.</p> <p>Le menu Configuration / Syst\u00e8me / Active update permet de contr\u00f4ler la mise \u00e0 jour automatique des modules de Bases d'URLs embarqu\u00e9es, IPS : signatures de protection contextuelles, G\u00e9olocalisation / R\u00e9putation IP publiques, signatures antispam, antivirus et autres listes noires pr\u00e9configur\u00e9es par Stormshield. Il est conseill\u00e9 d'activer uniquement celles qui vous sont utiles.</p>"},{"location":"documentation/Stormshield/fiche02_priseEnMain_SNS/#sauvegarde-et-restauration-de-la-configuration","title":"Sauvegarde et restauration de la configuration","text":"<p>La sauvegarde de la configuration se fait dans le menu Configuration / Syst\u00e8me / Maintenance / onglet Sauvegarder.</p> <ul> <li>Au besoin, modifier le nom du fichier et cliquez sur le bouton pour     le t\u00e9l\u00e9charger. La sauvegarde automatique du fichier de     configuration peut \u00eatre mise en place et effectu\u00e9e sur le Cloud     Stormshield.</li> </ul> <p>Info</p> <p>le fichier de configuration est un fichier texte chiffr\u00e9 (extension \u00ab\u00a0na\u00a0\u00bb).</p> <p>La restauration d'une configuration s'effectue dans le menu Configuration / Syst\u00e8me / Maintenance / onglet Restaurer.</p> <ul> <li>S\u00e9lectionner le fichier \u00e0 restaurer en cliquant sur le bouton ...</li> </ul>"},{"location":"documentation/Stormshield/fiche03_gestionJournaux_SNS/","title":"Fiche 03 -- Traces, Journaux et supervision","text":"<p>Le stockage des journaux (logs) des pare-feu Stormshield peut \u00eatre configur\u00e9 soit en local, soit vers un serveur Syslog, soit avec le protocole IPFIX.\u00a0Les journaux, rapports d'activit\u00e9s et graphiques d'historiques sont disponibles sur les pare-feus ne disposant pas de stockage local des journaux. Cependant, ils sont limit\u00e9s \u00e0 5 rapports et graphiques au total avec un historique maximal de 7 jours.</p>"},{"location":"documentation/Stormshield/fiche03_gestionJournaux_SNS/#configuration-du-stockage-des-journaux-logs","title":"Configuration du stockage des journaux (logs)","text":"<p>Le stockage en local n'est activ\u00e9 par d\u00e9faut que sur les machines virtuelles, il faut donc le cas \u00e9ch\u00e9ant le configurer.</p> <ul> <li>S\u00e9lectionner dans le menu \u00e0 gauche Configuration / Notifications /     Traces -- Syslog - IPFIX puis dans l'onglet / Traces -- Syslog     -- IPFIX choisir Stockage local. </li> </ul> <p>Sur une machine virtuelle, celui-ci est activ\u00e9 par d\u00e9faut et occupe un espace disque de 6Go\u00a0:</p> <p></p> <p>Sur un bo\u00eetier physique, le stockage local des logs n'est pas activ\u00e9 par d\u00e9faut.</p> <ul> <li>Ins\u00e9rer une carte SD dans l'emplacement en fa\u00e7ade du pare-feu SNS,     lorsque le pare-feu est \u00e9teint, elle sera automatiquement d\u00e9tect\u00e9e     lors du d\u00e9marrage (sauf si vous n'avez pas install\u00e9 la licence) et     le syst\u00e8me vous proposera de la formater avant utilisation.</li> </ul> <p></p> <p>La zone Support de stockage permet de s\u00e9lectionner le support de stockage local \u00ab\u00a0disque dur interne\u00a0\u00bb ou \u00ab\u00a0carte m\u00e9moire SD\u00a0\u00bb. Au besoin\u00a0:</p> <ul> <li>cocher le bouton     ON\u00a0;</li> <li>dans la zone Support de stockage s\u00e9lectionner dans la liste     P\u00e9riph\u00e9rique la carte SD comme support de stockage.</li> </ul> <p>Le syst\u00e8me vous propose de la formater avant utilisation.</p> <p></p> <ul> <li>Cliquer Formater Carte SD. Cette op\u00e9ration prend quelques secondes.</li> </ul> <p>Attention</p> <p>Afin de stocker les journaux du pare-feu SNS sur un support externe (carte SD) vous devez d'abord enregistrer la licence, le message d'erreur qui appara\u00eet alors n'est pas explicite, le syst\u00e8me fait comme s'il ne pouvait d\u00e9tecter la carte SD.</p> <p>Une fois le support format\u00e9, la liste des journaux pr\u00e9-configur\u00e9s est activ\u00e9e avec pour chaque journal un espace d\u00e9di\u00e9. Vous pouvez d\u00e9sactiver certains journaux si vous le souhaitez.</p> <p></p> <ul> <li>Le cas \u00e9ch\u00e9ant, cliquer Appliquer puis Sauvegarder pour     activer le stockage local des journaux.</li> </ul> <p></p> <ul> <li>Le cas \u00e9ch\u00e9ant, cliquer Conserver les rapports d'activit\u00e9     d\u00e9sactiv\u00e9s.</li> </ul> <p></p> <p>La zone Configuration de l'espace r\u00e9serv\u00e9 pour les traces permet d'activer ou non l'\u00e9criture des traces pour une famille donn\u00e9e en double-cliquant dans la colonne \u00c9tat correspondante. Elle permet \u00e9galement de configurer le pourcentage de l'espace disque r\u00e9serv\u00e9 pour la famille de trace dans la partie Pourcentage. Il est important de noter que le total des pourcentages ne doit pas d\u00e9passer 100\u00a0%. La taille r\u00e9elle de l'espace disque r\u00e9serv\u00e9 \u00e0 une famille de traces est indiqu\u00e9e dans la partie Quota d'espace disque.</p> <p>Les entr\u00e9es de journal anciennes sont \u00e9cras\u00e9es par les nouvelles entr\u00e9es (rotation)\u00a0: il s'agit du comportement par d\u00e9faut. Pour une journalisation sans rotation, il faut un stockage externe (serveur SYSLOG par exemple).</p> <p>L'activation des rapports s'effectue depuis le menu Configuration / Notifications / Configuration des rapports.</p> <ul> <li>Cliquer Configuration / Notifications / Configuration des     rapports et activez l'option Rapports statiques, ensuite     s\u00e9lectionnez les rapports souhait\u00e9s dans le panneau Liste des     rapports.</li> </ul> <p></p> <p>Par d\u00e9faut le rapport sur le Top des protocoles par volume est activ\u00e9 si vous activez les rapports.</p> <p>L'onglet Liste des graphiques historiques permet de visualiser et modifier les graphiques activ\u00e9s par d\u00e9faut.</p> <p></p>"},{"location":"documentation/Stormshield/fiche03_gestionJournaux_SNS/#les-journaux","title":"Les Journaux","text":"<p>Les fichiers journaux sont organis\u00e9s en plusieurs cat\u00e9gories dont les plus importantes sont list\u00e9es ci-dessous.</p> <ul> <li>Administration\u00a0: regroupe les \u00e9v\u00e8nements li\u00e9s \u00e0 l'administration     du pare-feu SNS. Ainsi, toutes les modifications de configuration     effectu\u00e9es sur le pare-feu sont journalis\u00e9es.</li> <li>Authentification\u00a0: regroupe les \u00e9v\u00e8nements li\u00e9s \u00e0     l'authentification des utilisateurs sur le pare-feu SNS.</li> <li>Connexions r\u00e9seaux\u00a0: regroupe les \u00e9v\u00e8nements li\u00e9s aux connexions     TCP/UDP traversant ou \u00e0 destination du pare-feu SNS non trait\u00e9es par     un plugin applicatif.</li> <li>\u00c9v\u00e8nements syst\u00e8mes\u00a0: regroupe les \u00e9v\u00e8nements li\u00e9s directement     au syst\u00e8me: arr\u00eat/d\u00e9marrage du pare-feu SNS, erreurs syst\u00e8me,     allumage/extinction d'une interface, haute disponibilit\u00e9, mises \u00e0     jour Active Update, etc.</li> <li>Alarmes\u00a0: regroupe les \u00e9v\u00e8nements li\u00e9s aux fonctions de     pr\u00e9vention d'intrusions (IPS) et les \u00e9v\u00e8nements trac\u00e9s avec le     niveau alarme mineure ou majeure de la politique de filtrage.</li> <li>Proxy HTTP\u00a0: regroupe les \u00e9v\u00e8nements li\u00e9s aux connexions     traversant le proxy HTTP.</li> <li>Connexions applicatives (plugin)\u00a0: regroupe les \u00e9v\u00e8nements li\u00e9s     aux connexions trait\u00e9es par un plugin applicatif (HTTP, FTP, SIP,     etc).</li> <li>Politique de filtrage\u00a0: regroupe les \u00e9v\u00e8nements li\u00e9s aux r\u00e8gles     de filtrages et/ou de NAT, lorsque la journalisation des r\u00e8gles est     en mode verbeux.</li> </ul> <p>Dans le contexte Monitoring, le menu LOGS - JOURNAUX D'AUDIT permet de visualiser les journaux et traces sauvegard\u00e9s en local sur le pare-feu SNS, regroup\u00e9s par famille de journaux\u00a0: trafic r\u00e9seau, alarmes, web, etc.</p> <p>Exemple\u00a0: la famille Trafic r\u00e9seau concat\u00e8ne les journaux Connexions r\u00e9seaux, filtrage, Proxy FTP, connexions applicatives, Proxy POP3, Proxy SMTP, Proxy SSL, Proxy HTTP, VPN SSL.</p> <p>Les traces sont affich\u00e9es par ordre anti chronologique (la trace la plus r\u00e9cente est en t\u00eate de liste).</p> <p>Important</p> <p>Pour appliquer le r\u00e8glement g\u00e9n\u00e9ral sur la protection des donn\u00e9es (RGPD), l'acc\u00e8s aux logs des pare-feus SNS est restreint par d\u00e9faut pour tous les administrateurs.</p> <p></p> <p>Le super administrateur \u00ab\u00a0admin\u00a0\u00bb, ainsi que les administrateurs disposant du droit \u00ab\u00a0Acc\u00e8s aux donn\u00e9es personnelles\u00a0\u00bb peuvent acc\u00e9der aux logs complets en cliquant simplement sur Obtenir le droit d'acc\u00e8s aux donn\u00e9es personnelles (logs). Cette manipulation ajoute une entr\u00e9e dans les journaux qui permet de la tracer.</p> <p></p>"},{"location":"documentation/Stormshield/fiche03_gestionJournaux_SNS/#consultation-des-journaux","title":"Consultation des Journaux","text":"<ul> <li>Cliquer Monitoring puis LOGS - JOURNAUX D'AUDIT puis, par     exemple, Trafic r\u00e9seau.</li> </ul> <p>Pour voir l'ensemble des donn\u00e9es relatives \u00e0 une trace, mettez la ligne d\u00e9sir\u00e9e en surbrillance et cliquez sur la fl\u00e8che en haut \u00e0 droite D\u00e9tails de la ligne de log.</p> <p></p> <p>L'affichage des journaux peut \u00eatre restreint \u00e0 une plage temporelle pr\u00e9d\u00e9finie (derni\u00e8re heure, aujourd'hui, hier, semaine derni\u00e8re ou mois dernier) ou personnalis\u00e9e.</p> <p>En cliquant sur un type de trace, une fen\u00eatre s'affiche pour offrir des raccourcis vers plusieurs fonctionnalit\u00e9s qui diff\u00e8rent suivant le type de trace affich\u00e9e : afficher de l'aide, ajouter la machine \u00e0 la base objet, filtrer les traces en se basant sur la valeur, voir la ligne compl\u00e8te de la trace, etc.</p> <p>Pour filtrer les traces, une barre de recherche simple permet de rechercher une cha\u00eene de caract\u00e8res dans toutes les colonnes de toutes les traces, voir l'exemple ci-dessous pour icmp.</p> <p></p>"},{"location":"documentation/Stormshield/fiche04_configurationReseau_SNS/","title":"Fiche 04 -- Configuration du r\u00e9seau","text":""},{"location":"documentation/Stormshield/fiche04_configurationReseau_SNS/#configuration-des-interfaces-reseau","title":"Configuration des interfaces r\u00e9seau","text":"<p>Dans une configuration usine, la premi\u00e8re interface du pare-feu SNS 210 est nomm\u00e9e \u00ab\u00a0OUT\u00a0\u00bb (qui correspond \u00e0 l'interface WAN sur un boitier physique) et la seconde* \u00ab\u00a0IN\u00a0\u00bb. Les suivantes (3 \u00e0 7) sont des ports de commutateurs. La derni\u00e8re interface \u00ab\u00a0DMZ1\u00a0\u00bb (qui correspond \u00e0 l'interface \u00a0DMZ\u00a0 sur un boitier physique 210) sert \u00e0 connecter le pare-feu sur une zone d\u00e9militaris\u00e9e. *</p> <p>L'interface \u00ab\u00a0OUT\u00a0\u00bb est une interface externe, utilis\u00e9e pour connecter le pare-feu SNS \u00e0 internet (WAN) et le reste des interfaces sont internes et servent principalement \u00e0 connecter le pare-feu SNS \u00e0 des r\u00e9seaux locaux. La distinction interface interne/externe permet de se prot\u00e9ger contre les attaques d'usurpation d'adresse IP.</p> <p>Attention</p> <p>Pour acc\u00e9der \u00e0 l'interface d'administration du pare-feu SNS, il faut connecter votre machine sur une interface interne (in, dmz1, dmz2, etc) **sous peine d'\u00eatre d\u00e9tect\u00e9 comme tentative d'intrusion qui n\u00e9cessite le red\u00e9marrage du firewall.</p> <p>Attention</p> <p>Dans ce cas, on aura un message \u00ab\u00a0forbidden\u00a0\u00bb sur le navigateur, on peut d\u00e9connecter le c\u00e2ble (faisable aussi en virtuel en d\u00e9sactivant la carte), changer son IP et se reconnecter \u00e0 une autre interface interne sans red\u00e9marrage.*</p> <p>La configuration des interfaces s'effectue dans le menu Configuration / R\u00e9seau / Interfaces, en faisant \u00ab\u00a0sortir\u00a0\u00bb les interfaces Ethernet de l'interface bridge cr\u00e9\u00e9e par d\u00e9faut sur le bo\u00eetier.</p> <ul> <li>S\u00e9lectionner Configuration / R\u00e9seau / Interfaces.</li> </ul> <p>Configuration par d\u00e9faut avec bridge</p> <p></p> <p>Configuration en mode routeur</p> <p></p> <ul> <li>Choisir une interface (par exemple IN), pour la sortir du bridge     ou la configurer avec une IP fixe, les manipulations sont     identiques.</li> </ul> <p></p> <p>Attention</p> <p>Il s'agit ici d'une interface interne (prot\u00e9g\u00e9e), le bouton radio correspondant doit \u00eatre coch\u00e9.</p> <ul> <li>Le cas \u00e9ch\u00e9ant, cliquer dans la zone Plan d'adressage sur     Dynamique/Statique.</li> <li>Cliquer Ip fixe (statique), un tableau appara\u00eet\u00a0:</li> </ul> <p></p> <ul> <li>Cliquer +Ajouter\u00a0et dans la zone Adresse / Masque et saisir     l'adresse IP de l'interface IN puis le masque en CIDR (/24 par     exemple) ou en notation d\u00e9cimale point\u00e9e\u00a0: 255.255.255.0.</li> </ul> <p></p> <ul> <li>Cliquer le bouton Appliquer puis Sauvegarder et \u00e0 nouveau     Sauvegarder.</li> </ul>"},{"location":"documentation/Stormshield/fiche04_configurationReseau_SNS/#route-par-defaut","title":"Route par d\u00e9faut","text":"<ul> <li>Cliquer Configuration / R\u00e9seau / Routage / onglet Routes     statiques IPv4.</li> </ul> <ul> <li>Cliquer sur     l'ic\u00f4ne\u00a0 pour ajouter un objet r\u00e9seau (cf. fiche 4 pour     plus de d\u00e9tails), choisir Machine et renseigner les champs     Nom (Ex\u00a0: FW-Siege) et Adresse IPv4 du     pare-feu SNS Si\u00e8ge puis cliquer sur le bouton Cr\u00e9er.</li> </ul> <p>Par exemple\u00a0:</p> <p></p> <p>Il est bien s\u00fbr possible de proc\u00e9der autrement en cr\u00e9ant au pr\u00e9alable l'objet r\u00e9seau. Il suffit ensuite de le s\u00e9lectionner.</p>"},{"location":"documentation/Stormshield/fiche04_configurationReseau_SNS/#configuration-du-proxy-cache-dns","title":"Configuration du proxy cache DNS","text":"<p>Le proxy cache DNS doit \u00eatre activ\u00e9 pour permettre la r\u00e9solution de noms DNS de fa\u00e7on correcte pour la mise en \u0153uvre des activit\u00e9s (labs).</p> <ul> <li>Dans le volet Syst\u00e8me / Configuration, ouvrez l'onglet     Param\u00e8tres r\u00e9seaux pour visualiser les options de configuration     r\u00e9seau du pare-feu.</li> </ul> <p></p> <p>La liste des serveurs DNS utilis\u00e9s par le pare-feu doit permettre la r\u00e9solution DNS vers des serveurs de l'Internet, vous pouvez conserver les serveurs de google (par d\u00e9faut) ou les remplacer par d'autres.</p> <p>Le pare-feu intercepte les requ\u00eates DNS \u00e0 destination d'Internet, et effectue lui-m\u00eame la requ\u00eate vers le serveur DNS configur\u00e9. Si le nom demand\u00e9 est dans son cache, le pare-feu r\u00e9pond directement \u00e0 la demande selon les informations qu'il poss\u00e8de. Il est possible de configurer le proxy cache afin que le serveur DNS pr\u00e9sent sur la DMZ puisse l'interroger.</p> <ul> <li>Dans le volet Configuration / R\u00e9seau, ouvrir Proxy cache     DNS.</li> <li>Cliquer sur OFF pour activer le cache DNS, il passe \u00e0 ON.</li> <li>Dans la \u00ab\u00a0liste des clients autoris\u00e9s \u00e0 utiliser le cache DNS\u00a0\u00bb,     cliquer + Ajouter puis cliquer sur l'ic\u00f4ne      pour ajouter un objet Machine, dans Nom de     l'objet, saisir un nom (par exemple srv_dns_priv), dans     Adresse IPv4 saisir l'adresse du DNS puis Cr\u00e9er pour     l'ajouter puis Appliquer.</li> </ul>"},{"location":"documentation/Stormshield/fiche04_configurationReseau_SNS/#politique-de-securite-et-nat-en-bref","title":"Politique de s\u00e9curit\u00e9 et NAT en bref","text":"<p>Le d\u00e9tail des diff\u00e9rentes possibilit\u00e9s de param\u00e9trage figure dans les fiches 5 et 6.</p> <p> Dans les pare-feu SNS, les r\u00e8gles de filtrage et NAT (traduction d'adresses) sont regroup\u00e9es sous une m\u00eame politique. Il est possible de d\u00e9finir 10 politiques diff\u00e9rentes mais une seule politique est active \u00e0 la fois, identifi\u00e9e par l'ic\u00f4ne\u00a0:</p> <p>La politique de s\u00e9curit\u00e9 active en configuration usine est (1) Block all, elle n'autorise que le ping des interfaces du pare-feu et l'acc\u00e8s en https \u00e0 l'administration du bo\u00eetier.</p> <p>Une politique implicite Block all est \u00e9galement configur\u00e9e sur le pare-feu SNS.</p> <p>Pour modifier\u00a0:</p> <ul> <li>Ouvrir le menu Configuration / Politique de s\u00e9curit\u00e9 /     Filtrage et NAT.</li> </ul> <p>{width=\"15.947cm\" height=\"6.075cm\"}</p> <ul> <li>Proc\u00e9der aux modifications voulues (cf. fiche 6)</li> <li>Cliquer Sauvegarder les modifications.</li> </ul> <p>Voici ci-dessus le r\u00e9sultat si on applique la derni\u00e8re politique \u00ab\u00a0Pass all\u00a0\u00bb.</p> <p></p> <p>Pour ajouter une r\u00e8gle de NAT dynamique NAPT afin que les machines du r\u00e9seau interne (Network_internals) puissent acc\u00e9der au r\u00e9seau externe (Network_Out) et \u00e0 Internet</p> <p>La r\u00e8gle de NAT dynamique est cr\u00e9\u00e9e avec le bouton Nouvelle r\u00e8gle / r\u00e8gle de partage d'adresse source (masquerading) qui ajoute automatiquement la plage de ports pr\u00e9d\u00e9finie\u00a0ephemeral_fw\u00a0[20000-59999] au niveau du port source dans le trafic apr\u00e8s traduction. Par d\u00e9faut, les ports sont choisis s\u00e9quentiellement dans cette plage, cependant une option est disponible pour permettre un choix al\u00e9atoire du num\u00e9ro de port pour chaque nouvelle connexion et le rendre ainsi moins pr\u00e9dictible.</p> <ul> <li>Dans votre politique (10), s\u00e9lectionner l'onglet NAT puis     Nouvelle r\u00e8gle / r\u00e8gle de partage d'adresse source     (masquerading) </li> </ul> <p></p> <p>Une nouvelle r\u00e8gle non activ\u00e9e appara\u00eet avec des valeurs par d\u00e9faut any, any. Dans la section Trafic apr\u00e8s translation, le port source sera traduit par un num\u00e9ro de port choisi dans la plage ephemeral_fw.</p> <p>La configuration du Trafic original (avant translation) permet de renseigner les valeurs des param\u00e8tres avant traduction (par d\u00e9faut any, any)\u00a0:</p> <ul> <li>Source permet de d\u00e9finir l'adresse IP d'un h\u00f4te ou du r\u00e9seau     source\u00a0;</li> <li>Destination permet de d\u00e9finir l'adresse IP d'un h\u00f4te ou du     r\u00e9seau destination.</li> </ul> <p>La configuration du Trafic apr\u00e8s translation permet de renseigner les nouvelles valeurs des param\u00e8tres apr\u00e8s traduction (par d\u00e9faut any, any)\u00a0:</p> <ul> <li>Source d\u00e9finit l'adresse IP ou le r\u00e9seau source et le port     source vus de l'ext\u00e9rieur.</li> <li>Destination d\u00e9finit l'adresse IP ou le r\u00e9seau destination et     Port destination translat\u00e9e le port de destination.</li> </ul> <p>Pour configurer un NAT/PAT pour permettre la sortie sur Internet</p> <ul> <li>Double-cliquer sur une zone vide de la r\u00e8gle pour ouvrir la fen\u00eatre     de configuration d\u00e9taill\u00e9e \u00ab\u00a0Edition de la r\u00e8gle N\u00b01\u00a0\u00bb.</li> <li>Cliquer l'onglet du menu de gauche G\u00e9n\u00e9ral, dans la     zone Commentaire, saisir un commentaire, par exemple     \u00ab\u00a0Configuration de la r\u00e8gle de NAT/PAT pour la sortie internet\u00a0\u00bb.</li> <li>Cliquer sur l'onglet du menu de gauche Source Originale.</li> <li>Double-cliquer sur Any et avec la fl\u00e8che choisir     Network_internals (qui renvoie \u00e0 tous les r\u00e9seaux internes     prot\u00e9g\u00e9s), dans l'onglet Configuration avanc\u00e9e, laissez Any pour     le port de destination.</li> </ul> <p></p> <ul> <li>Cliquer sur l'onglet du menu de gauche Destination originale.</li> <li>Double-cliquer sur Any et avec la fl\u00e8che choisir Internet,     laissez Any pour le port de destination.</li> </ul> <p></p> <p>Vigilence</p> <p>Attention : si dans la zone destination originale, vous laissez Any, plut\u00f4t qu'Internet qui d\u00e9signe tous les r\u00e9seaux sauf ceux internes au pare-feu SNS, le pare-feu SNS bloquera les flux d'administration (en ssh et en https). En effet, les flux d'administration subiront \u00e9galement une traduction NAT vers l'interface OUT qui l'interpr\u00e9tera comme une tentative d'intrusion et les bloquera.</p> <p>Vigilence</p> <p>Vous pouvez rendre cette r\u00e8gle plus restrictive en choisissant explicitement l'interface de sortie.</p> <ul> <li>Cliquer sur l'onglet Configuration avanc\u00e9e et s\u00e9lectionnez     out dans Interface de sortie.</li> </ul> <p></p> <ul> <li>Cliquer sur l'onglet Source translat\u00e9e et     s\u00e9lectionner Firewall_Out dans Machine source translat\u00e9e.</li> <li>Dans Port source translat\u00e9, laisser ephemeral_fw et cocher     choisir al\u00e9atoirement le port source translat\u00e9.</li> </ul> <p>Vigilence</p> <p>Cette option choisit al\u00e9atoirement le port source translat\u00e9, ce qui permet d'\u00e9viter les attaques utilisant la pr\u00e9dictibilit\u00e9 des ports utilis\u00e9s. Ainsi si le premier port est 10000, le suivant ne sera pas 10001. Cette pr\u00e9caution n'emp\u00eache pas les attaques, elle permet de les rendre plus complexes.</p> <p></p> <ul> <li>Cliquer l'onglet du menu de gauche Protocole, cela permet de     d\u00e9finir le type de protocole\u00a0: applicatif, IP ou Ethernet, laisser     D\u00e9tection automatique du protocole (par d\u00e9faut)</li> </ul> <p></p> <ul> <li>Cliquer sur l'onglet du menu de gauche Options,\u00a0cela permet de     tracer le trafic qui correspond \u00e0 la r\u00e8gle de traduction dans le     journal de connexions, choisir tracer.</li> </ul> <p></p> <p>Information</p> <p>NB\u00a0: Le NAT ne laisse jamais de traces dans le journal de connexions. Pour tracer une r\u00e8gle de NAT, il faut choisir l'option \u00ab\u00a0tracer\u00a0\u00bb, sinon, aucune journalisation de NAT ne sera effectu\u00e9e.</p> <p></p> <ul> <li>Cliquer sur OK pour sauvegarder les     modifications de la r\u00e8gle de NAT dynamique que vous venez de cr\u00e9er.</li> <li> <p>Dans la colonne \u00c9tat, s\u00e9lectionner avec la fl\u00e8che D\u00e9finir     l'\u00e9tat on  La r\u00e8gle passe.</p> </li> <li> <p>Cliquer sur Appliquer puis Oui, Activer la politique     puis confirmer.</p> </li> </ul> <p></p> <p>Pour g\u00e9rer les statistiques d'utilisation</p> <p>Dans la liste des r\u00e8gles la barre devient verte quand les r\u00e8gles s'appliquent et une info-bulle indique le nombre de fois o\u00f9 la r\u00e8gle a \u00e9t\u00e9 appliqu\u00e9e\u00a0:</p> <p></p> <p>Dans le bandeau d'affichage des r\u00e8gles, d\u00e9pliez le menu cliquez sur R\u00e9initialiser les statistiques des r\u00e8gles pour remettre les compteurs \u00e0 z\u00e9ro.</p> <p></p>"},{"location":"documentation/Stormshield/fiche04_configurationReseau_SNS/#creation-de-sous-interfaces-pour-la-gestion-des-trames-etiquetees-8021q-et-des-vlan","title":"Cr\u00e9ation de sous-interfaces pour la gestion des trames \u00e9tiquet\u00e9es (802.1q) et des VLAN","text":"<p>Vigilence</p> <p>Lorsque le pare-feu doit \u00e9galement g\u00e9rer le routage inter-vlan, il est n\u00e9cessaire de cr\u00e9er \u00e0 partir d'une interface physique des sous-interfaces \u00e0 m\u00eame d'interpr\u00e9ter des trames Ethernet \u00e9tiquet\u00e9es 802.1q en fonction des VLAN cr\u00e9\u00e9s.</p> <p>Si l'interface IN est celle utilis\u00e9e pour se connecter \u00e0 la page web d'administration du pare-feu mais \u00e9galement pour la cr\u00e9ation de sous-interfaces, il est indispensable d'avoir un acc\u00e8s \u00e0 cette m\u00eame application par une autre interface telle que DMZ. Sans cela, il ne sera plus possible de se connecter au pare-feu pour l'administrer.</p> <p>Vigilence</p> <p>La d\u00e9sactivation de l'interface parent peut se faire dans un second temps une fois que les interfaces virtuelles sont configur\u00e9es.</p> <p>Pour cr\u00e9er une sous-interface, il est n\u00e9cessaire de se rendre dans le menu Configuration / R\u00e9seau / Interfaces.</p> <p></p> <p>Contrairement \u00e0 la cr\u00e9ation de sous-interfaces sur des routeurs Cisco qui consiste \u00e0 activer l'interface r\u00e9seau physique sans lui attribuer de configuration IP, Stormshield recommande de d\u00e9sactiver  l'interface parente qui servira \u00e0 la cr\u00e9ation des sous-interfaces associ\u00e9es \u00e0 chaque VLAN\u00a0:</p> <ul> <li>double-cliquer sur l'interface physique concern\u00e9e par le routage     inter-vlan (in la plupart du temps) puis dans l'onglet     Configuration G\u00e9n\u00e9rale\u00a0pour la d\u00e9sactiver, passer     l'Etat\u00a0\u00e0\u00a0Off.</li> </ul> <p></p> <ul> <li>S\u00e9lectionner ensuite l'interface physique que vous venez de     d\u00e9sactiver puis cliquer sur Ajouter / VLAN / Pour in (ou toute     autre interface concern\u00e9e).</li> </ul> <p></p> <ul> <li>D\u00e9finir un nom pour la sous-interface en respectant une convention     de nommage coh\u00e9rente puis un commentaire permettant d'expliciter     l'utilit\u00e9 de celle-ci.</li> <li>Le cas \u00e9ch\u00e9ant, choisir l'interface parente correspondante et     d\u00e9finir un identifiant correspondant au VID du VLAN concern\u00e9 (10,     100, 200...).</li> <li>Cette sous-interface est interne puisque les VLAN sont tr\u00e8s souvent     impl\u00e9ment\u00e9s sur le r\u00e9seau local de l'entreprise.</li> </ul>"},{"location":"documentation/Stormshield/fiche05_configurationObjetsReseaux_SNS/","title":"Fiche 05 -- Configuration des Objets R\u00e9seau","text":"<p>Les objets r\u00e9seau sont notamment n\u00e9cessaires \u00e0 la mise en place de r\u00e8gles de filtrage et de NAT.</p>"},{"location":"documentation/Stormshield/fiche05_configurationObjetsReseaux_SNS/#presentation-des-objets","title":"Pr\u00e9sentation des Objets","text":"<p>Les menus de configuration des pare-feu Stormshield Network utilisent des objets qui repr\u00e9sentent des valeurs (adresse IP, adresse r\u00e9seau, URL, \u00e9v\u00e9nement temporel, etc.). L'utilisation d'objets au lieu de valeurs pr\u00e9sente deux avantages majeurs\u00a0:</p> <ol> <li> <p>Cela permet \u00e0 l'administrateur de manipuler des noms, plus parlants     que des valeurs.</p> </li> <li> <p>Dans le cas o\u00f9 une valeur change, il suffira de modifier la valeur     au niveau de l'objet et non dans tous les menus o\u00f9 l'objet est     utilis\u00e9.</p> </li> </ol> <p>La cr\u00e9ation et la configuration des objets s'effectuent :</p> <ul> <li>Dans le menu\u00a0: CONFIGURATION / OBJETS</li> <li>Dans le menu raccourci\u00a0:     </li> <li>Depuis n'importe quel autre menu via le bouton     </li> </ul> <p>Les objets sont class\u00e9s en 3 cat\u00e9gories\u00a0:</p> <ol> <li>Objets R\u00e9seau\u00a0: regroupe tous les objets en relation avec les     valeurs r\u00e9seaux (adresse IP, num\u00e9ro de port, num\u00e9ro de protocole,     etc.) et les objets temps (par exemple, l'objet Machine     FWOUT_Siege qui repr\u00e9sente la passerelle des agences).</li> <li>Objets Web\u00a0: groupes d'URL (ou groupes de cat\u00e9gories) et groupes     de noms de certificats.</li> <li>Certificats et PKI\u00a0: permet la cr\u00e9ation et la gestion des     autorit\u00e9s de certification et de tous les certificats (de type     serveur, utilisateur, ou smartcard) qui en d\u00e9coulent.</li> </ol> <p>On peut distinguer deux types d'objets particuliers en plus des objets qui peuvent \u00eatre cr\u00e9\u00e9s par l'administrateur\u00a0:</p> <ul> <li>Objets implicites\u00a0: ils sont cr\u00e9\u00e9s automatiquement par le     pare-feu et d\u00e9pendent de la configuration r\u00e9seau. Ces objets sont en     lecture seule et ne peuvent \u00eatre ni modifi\u00e9s ni supprim\u00e9s par     l'administrateur. Par exemple, l'objet \u00ab\u00a0Firewall_out\u00a0\u00bb, cr\u00e9\u00e9     automatiquement lorsqu'une adresse IP est associ\u00e9e \u00e0 l'interface     \u00ab\u00a0OUT\u00a0\u00bb ou l'objet \u00ab\u00a0Network_internals \u00bb qui regroupe     tous les r\u00e9seaux accessibles via les interfaces internes.</li> <li>Objets pr\u00e9-configur\u00e9s\u00a0: ils sont pr\u00e9sents par d\u00e9faut dans la     liste des objets. Ils repr\u00e9sentent des valeurs de param\u00e8tres r\u00e9seaux     standardis\u00e9es (ports, protocoles, r\u00e9seaux) et des valeurs     n\u00e9cessaires pour le fonctionnement du pare-feu (adresse IP des     serveurs Stormshield pour les mises \u00e0 jour). On trouvera par exemple     le protocole ICMP et l'objet \u00ab\u00a0Internet\u00a0\u00bb\u00a0qui regroupe     l'ensemble des machines ne faisant pas partie des r\u00e9seaux internes.</li> </ul> <p>Attention</p> <p>Il est conseill\u00e9 d'utiliser les objets implicites et pr\u00e9-configur\u00e9s et d'\u00e9viter de cr\u00e9er d'autres objets portant les m\u00eames valeurs.</p> <p>Les recommandations sont les suivantes\u00a0:</p> <ul> <li>utiliser les objets implicites ou pr\u00e9-configur\u00e9s\u00a0;</li> <li>suivre une convention de nommage des objets bien d\u00e9finie et     l'appliquer strictement \u00e9vite la cr\u00e9ation de doublons et facilite la     lecture des objets\u00a0;</li> <li>utiliser un groupe d'objet d'administration contenant l'ensemble     des IP et des r\u00e9seaux d'administration permet de r\u00e9utiliser ce     groupe dans toutes les r\u00e8gles de filtrage li\u00e9es \u00e0 l'administration     et donc de maintenir leur coh\u00e9rence tout en facilitant leur     modification\u00a0;</li> <li>limiter l'usage des objets dynamiques (type FQDN et Dynamic Host)\u00a0:     ils g\u00e9n\u00e8rent des requ\u00eates DNS r\u00e9guli\u00e8res. Cela sollicite le r\u00e9seau     et le pare-feu, utilisez cette fonctionnalit\u00e9 lorsqu'elle est     n\u00e9cessaire\u00a0;</li> <li>limiter le nombre d'objets inutilis\u00e9s\u00a0: ils chargent l'affichage et     sont bien souvent oubli\u00e9s et recr\u00e9\u00e9s\u00a0;</li> <li>\u00e9viter les doublons, ils doivent \u00eatre traqu\u00e9s et supprim\u00e9s car     c'est une source d'erreur courante lors de la modification de r\u00e8gles     de filtrage. On se retrouve dans un cas o\u00f9 la modification d'un     objet n'impacte pas toutes les r\u00e8gles qui auraient d\u00fb l'\u00eatre, cr\u00e9ant     ainsi des trous dans la s\u00e9curit\u00e9.</li> </ul> <p>La syntaxe des noms des objets (insensible \u00e0 la casse) doit respecter quelques restrictions d\u00e9finies dans le tableau ci-dessous\u00a0:</p> <p></p>"},{"location":"documentation/Stormshield/fiche05_configurationObjetsReseaux_SNS/#creation-des-objets-reseaux","title":"Cr\u00e9ation des objets \u00ab\u00a0R\u00e9seaux\u00a0\u00bb","text":"<p>Le menu Configuration / Objets / Objets r\u00e9seau ou le menu Objets r\u00e9seau permettent de visualiser les objets, de les modifier ou d'en ajouter.</p> <p> </p> <ul> <li>Ouvrir Configuration / Objets\u00a0/ Objets r\u00e9seau et cliquer     sur le bouton Ajouter pour ajouter les objets souhait\u00e9s.</li> </ul> <p></p> <p>Les types d'objets suivants peuvent \u00eatre cr\u00e9\u00e9s :</p> <ul> <li>Machine\u00a0: une adresse IP,</li> <li>Nom DNS (FQDN)\u00a0: toutes les adresses IP associ\u00e9es \u00e0 un nom FQDN par     r\u00e9solution DNS,</li> <li>R\u00e9seau\u00a0: une adresse r\u00e9seau,</li> <li>Plage d'adresses IP\u00a0: une plage d'adresses,</li> <li>Routeur\u00a0: permet de renseigner une ou plusieurs passerelles pour un     routage par r\u00e9partition de charge avec ou sans passerelle de     secours.</li> <li>Groupe\u00a0: un groupe d'objets portant une ou plusieurs adresses IP :     machines, plages d'adresses IP, r\u00e9seaux ou d'autres groupes,</li> <li>Protocole IP\u00a0: l'ID du protocole au niveau IP,</li> <li>Port - Plage de ports\u00a0: un port ou une plage de ports. Il/Elle peut     \u00eatre limit\u00e9(e) \u00e0 un protocole de transport particulier (TCP ou UDP),</li> <li>Groupe de ports\u00a0: un groupe d'objets portant des ports ou des plages     de ports, ainsi que d'autres groupes de ports,</li> <li>Groupe de r\u00e9gions\u00a0: un groupe de pays ou de continents. Ce type     d'objet peut \u00eatre utilis\u00e9 dans la g\u00e9olocalisation des adresses IP,</li> <li>Objet temps\u00a0: un \u00e9v\u00e9nement temporel (ponctuel, jour de l'ann\u00e9e,     jour(s) de la semaine ou plage(s) horaire(s)).</li> </ul> <p>Attention</p> <p>ATTENTION, il faut utiliser un typage d'objets ad\u00e9quat (objet r\u00e9seau pour les r\u00e9seaux, objet machine pour les pare-feu, etc.).</p> <ul> <li>Cliquer sur + CR\u00c9ER pour ajouter l'objet.</li> </ul>"},{"location":"documentation/Stormshield/fiche05_configurationObjetsReseaux_SNS/#importexport-des-objets","title":"Import/Export des Objets","text":"<p>Il est possible d'exporter la base d'objets du pare-feu SNS dans un fichier CSV en cliquant sur le bouton \u00ab\u00a0Exporter\u00a0\u00bb. Le fichier CSV g\u00e9n\u00e9r\u00e9 contient les objets machines, plages d'adresses IP, r\u00e9seaux, FQDN, ports -- plages de ports, protocoles, groupes et groupes de ports.</p> <p>Les objets sont organis\u00e9s par cat\u00e9gorie et s\u00e9par\u00e9s par des lignes contenant les noms des param\u00e8tres\u00a0: #type, #name, #IP, etc. (les param\u00e8tres diff\u00e8rent en fonction des cat\u00e9gories d'objets). Les attributs d'un objet, quant \u00e0 eux, sont s\u00e9par\u00e9s par des virgules.</p> <p>Il est possible d'importer des objets depuis un fichier CSV poss\u00e9dant le m\u00eame format que le fichier export\u00e9.</p> <p>Un rapport statistique affiche le nombre d'objets import\u00e9s par type. En cas d'erreur d'import, la base d'objets n'est pas modifi\u00e9e.</p> <p>Attention</p> <p>Les objets du fichier import\u00e9 \u00e9crasent ceux du firewall s'ils portent le m\u00eame nom. Les autres objets ne sont pas affect\u00e9s.</p> <ul> <li>Cliquer sur Exporter, pour exporter la base d'objets     pr\u00e9c\u00e9demment cr\u00e9\u00e9s dans un fichier CSV.</li> </ul> <p></p> <ul> <li> <p>Et cliquer sur Importer,</p> </li> <li> <p>Cliquer sur Importer, pour importer le fichier CSV apr\u00e8s une     \u00e9ventuelle modification, puis choisissez le fichier \u00ab\u00a0csv\u00a0\u00bb et     cliquer sur Transf\u00e9rer pour commencer l'import puis Fermer.     Une barre d'avancement permet de visualiser le d\u00e9roulement de     l'import. Et une fois fini, un rapport statistique affiche le nombre     d'objets import\u00e9s par type.</p> </li> </ul> <p></p> <p>Information</p> <p>En cas de probl\u00e8me \u00e0 l'importation, encodez le fichier en UTF-8 avec des retours \u00e0 la ligne type Unix (LF).</p>"},{"location":"documentation/Stormshield/fiche06_configurationNat_SNS/","title":"Fiche 06 -- Configuration du NAT/PAT","text":"<p>Dans les pare-feu SNS, les r\u00e8gles de filtrage et NAT (traduction d'adresses) sont regroup\u00e9es sous une m\u00eame politique. Il est possible de d\u00e9finir 10 politiques diff\u00e9rentes mais une seule politique est active \u00e0 la fois, identifi\u00e9e par l'ic\u00f4ne \u00a0:</p>"},{"location":"documentation/Stormshield/fiche06_configurationNat_SNS/#mise-en-uvre-du-nat-dynamique","title":"Mise en \u0153uvre du NAT dynamique","text":"<p>NAT dynamique</p> <p>La r\u00e8gle de NAT dynamique NAPT permet aux machines du r\u00e9seau interne (Network_internals) d'acc\u00e9der au r\u00e9seau externe (Network_Out) et \u00e0 Internet</p> <p>La r\u00e8gle de NAT dynamique est cr\u00e9\u00e9e avec le bouton Nouvelle r\u00e8gle / r\u00e8gle de partage d'adresse source (masquerading) qui ajoute automatiquement la plage de ports pr\u00e9d\u00e9finie\u00a0ephemeral_fw\u00a0[20000-59999] au niveau du port source dans le trafic apr\u00e8s traduction. Par d\u00e9faut, les ports sont choisis s\u00e9quentiellement dans cette plage, cependant une option est disponible pour permettre un choix al\u00e9atoire du num\u00e9ro de port pour chaque nouvelle connexion et le rendre ainsi moins pr\u00e9dictible.</p> <ul> <li>Dans votre politique (10), s\u00e9lectionner l'onglet NAT puis     Nouvelle r\u00e8gle / r\u00e8gle de partage d'adresse source     (masquerading) </li> </ul> <p></p> <p>Une nouvelle r\u00e8gle non activ\u00e9e appara\u00eet avec des valeurs par d\u00e9faut any, any. Dans la section Trafic apr\u00e8s translation, le port source sera traduit par un num\u00e9ro de port choisi dans la plage ephemeral_fw.</p> <p>La configuration du Trafic original (avant translation) permet de renseigner les valeurs des param\u00e8tres avant traduction (par d\u00e9faut any, any)\u00a0:</p> <ul> <li>Source permet de d\u00e9finir l'adresse IP d'un h\u00f4te ou du r\u00e9seau     source\u00a0;</li> <li>Destination permet de d\u00e9finir l'adresse IP d'un h\u00f4te ou du     r\u00e9seau destination.</li> </ul> <p>La configuration du Trafic apr\u00e8s translation permet de renseigner les nouvelles valeurs des param\u00e8tres apr\u00e8s traduction (par d\u00e9faut any, any)\u00a0:</p> <ul> <li>Source d\u00e9finit l'adresse IP ou le r\u00e9seau source et le port     source vus de l'ext\u00e9rieur.</li> <li>Destination d\u00e9finit l'adresse IP ou le r\u00e9seau destination et     Port destination translat\u00e9e le port de destination.</li> </ul> <p>Pour configurer un NAT/PAT pour permettre la sortie sur Internet</p> <ul> <li>Double-cliquer sur une zone vide de la r\u00e8gle pour ouvrir la fen\u00eatre     de configuration d\u00e9taill\u00e9e \u00ab\u00a0Edition de la r\u00e8gle N\u00b01\u00a0\u00bb.</li> <li>Cliquer l'onglet du menu de gauche G\u00e9n\u00e9ral, dans la     zone Commentaire, saisir un commentaire, par exemple     \u00ab\u00a0Configuration de la r\u00e8gle de NAT/PAT pour la sortie internet\u00a0\u00bb.</li> <li>Cliquer sur l'onglet du menu de gauche Source Originale.</li> <li>Double-cliquer sur Any et avec la fl\u00e8che choisir     Network_internals (qui renvoie \u00e0 tous les r\u00e9seaux internes     prot\u00e9g\u00e9s), dans l'onglet Configuration avanc\u00e9e, laissez Any pour     le port de destination.</li> </ul> <p></p> <ul> <li>Cliquer sur l'onglet du menu de gauche Destination originale.</li> <li>Double-cliquer sur Any et avec la fl\u00e8che choisir Internet,     laissez Any pour le port de destination.</li> </ul> <p></p> <p>Attention</p> <p>Attention : si dans la zone destination originale, vous laissez Any, plut\u00f4t qu'Internet qui d\u00e9signe tous les r\u00e9seaux sauf ceux internes au pare-feu SNS, le pare-feu SNS bloquera les flux d'administration (en ssh et en https). En effet, les flux d'administration subiront \u00e9galement une traduction NAT vers l'interface OUT qui l'interpr\u00e9tera comme une tentative d'intrusion et les bloquera.</p> <p>Solution</p> <p>Vous pouvez rendre cette r\u00e8gle plus restrictive en choisissant explicitement l'interface de sortie.</p> <ul> <li>Cliquer sur l'onglet Configuration avanc\u00e9e et s\u00e9lectionnez     out dans Interface de sortie.</li> </ul> <p></p> <ul> <li>Cliquer sur l'onglet Source translat\u00e9e et     s\u00e9lectionner Firewall_Out dans Machine source translat\u00e9e.</li> <li>Dans Port source translat\u00e9, laisser ephemeral_fw et cocher     choisir al\u00e9atoirement le port source translat\u00e9.</li> </ul> <p>Information importante</p> <p>Cette option choisit al\u00e9atoirement le port source translat\u00e9, ce qui permet d'\u00e9viter les attaques utilisant la pr\u00e9dictibilit\u00e9 des ports utilis\u00e9s. Ainsi si le premier port est 10000, le suivant ne sera pas 10001. Cette pr\u00e9caution n'emp\u00eache pas les attaques, elle permet de les rendre plus complexes.</p> <p></p> <ul> <li>Cliquer l'onglet du menu de gauche Protocole, cela permet de     d\u00e9finir le type de protocole\u00a0: applicatif, IP ou Ethernet, laisser     D\u00e9tection automatique du protocole (par d\u00e9faut)</li> </ul> <p></p> <ul> <li>Cliquer sur l'onglet du menu de gauche Options,\u00a0cela permet de     tracer le trafic qui correspond \u00e0 la r\u00e8gle de traduction dans le     journal de connexions, choisir tracer.</li> </ul> <p></p> <p>Nota Bene</p> <p>NB\u00a0: Le NAT ne laisse jamais de traces dans le journal de connexions. Pour tracer une r\u00e8gle de NAT, il faut choisir l'option \u00ab\u00a0tracer\u00a0\u00bb, sinon, aucune journalisation de NAT ne sera effectu\u00e9e.</p> <ul> <li></li> <li>Cliquer sur OK pour sauvegarder les     modifications de la r\u00e8gle de NAT dynamique que vous venez de cr\u00e9er.</li> <li> <p>Dans la colonne \u00c9tat, s\u00e9lectionner avec la fl\u00e8che D\u00e9finir     l'\u00e9tat on </p> </li> <li> <p>Cliquer sur Appliquer puis Oui, Activer la politique     puis confirmer.</p> </li> </ul> <p>Dans la liste des r\u00e8gles la barre devient verte quand les r\u00e8gles s'appliquent et une info-bulle indique le nombre de fois o\u00f9 la r\u00e8gle a \u00e9t\u00e9 appliqu\u00e9e\u00a0:</p> <p></p> <ul> <li>Dans le bandeau d'affichage des r\u00e8gles, d\u00e9plier le menu      et cliquer sur R\u00e9initialiser les statistiques     des r\u00e8gles pour remettre les compteurs \u00e0 z\u00e9ro.</li> </ul> <p></p>"},{"location":"documentation/Stormshield/fiche06_configurationNat_SNS/#mise-en-uvre-du-nat-statique-par-port-redirection-de-port","title":"Mise en \u0153uvre du NAT statique par port (redirection de port)","text":"<p>Pour faire une redirection NAT \u00ab\u00a0classique\u00a0\u00bb, il faut s\u00e9lectionner l'onglet NAT puis Nouvelle r\u00e8gle / r\u00e8gle simple.</p> <p>Exemple avec une r\u00e8gle de NAT afin qu'unserveur WEB (objet srv_web_priv, protocole http) soit joignable gr\u00e2ce \u00e0 une redirection de port via l'adresse IP publique OUT d'un pare-feu: \u00ab\u00a0192.36.253.70\u00a0\u00bb.</p> <ul> <li> <p>Source originale = Internet, Interface d'entr\u00e9e = out</p> </li> <li> <p>Destination originale = Firewall_Out, Port dest= http</p> </li> <li> <p>Source translat\u00e9e = Any (ou pas de source)</p> </li> <li> <p>Destination translat\u00e9e = srv_web_priv, Port destination translat\u00e9 = none</p> </li> </ul> <p></p> <ul> <li>Cliquer Appliquer puis Oui, Activer la politique puis     confirmer.</li> </ul> <p>Le d\u00e9tail ci-dessous\u00a0:</p> <p></p> <ul> <li>Dans l'onglet Destination de la r\u00e8gle de filtrage, choisissez     l'onglet Configuration avanc\u00e9e, puis dans NAT sur la     destination, s\u00e9lectionner l'objet correspondant \u00e0 votre serveur     web priv\u00e9\u00a0:</li> </ul> <p></p> <ul> <li>Puis dans l'onglet Port/Protocole, choisir http dans la zone Port destination translat\u00e9.</li> </ul> <p></p> <p>Tra\u00e7age des r\u00e8gles de NAT</p> <p>Activer le tra\u00e7age des r\u00e8gles de NAT permet d'avoir les informations visibles dans les Journaux d'audit (logs).</p> <ul> <li>Double-cliquer sur la r\u00e8gle que vous voulez tracer et choisissez     l'onglet Options, et dans niveau de trace tracer puis **OK.     **</li> </ul> <p> Vous pouvez tester l'acc\u00e8s \u00e0 l'ensemble de vos ressources et v\u00e9rifier le tra\u00e7age des r\u00e8gles demand\u00e9es dans les logs du pare-feu (journal standard et journal Filtrage).</p> <ul> <li>Cliquer sur l'onglet Monitoring puis LOGS - Journaux d'audit /     Vues / Trafic r\u00e9seau\u00a0: vous devriez voir appara\u00eetre les traces\u00a0:</li> </ul> <p></p> <p>Information importante</p> <p>Il est \u00e9galement possible de r\u00e9aliser une redirection de ports directement lors de la cr\u00e9ation d'une r\u00e8gle de filtrage (voir fiche 6). L'int\u00e9r\u00eat d'int\u00e9grer le filtrage et la redirection dans une r\u00e8gle unique est d'optimiser les performances puisque le pare-feu r\u00e9alise un seul traitement au lieu de deux. Voici un exemple ci-dessous \u00e9quivalent \u00e0 la r\u00e8gle pr\u00e9c\u00e9dente\u00a0:</p> <p></p>"},{"location":"documentation/Stormshield/fiche07_filtrage_protocolaire_SNS/","title":"Fiche 07-- Filtrage protocolaire","text":"<p>La mise en place d'une politique de filtrage, permet \u00e0 l'administrateur de d\u00e9finir les r\u00e8gles qui permettront d'autoriser ou de bloquer les flux au travers du pare-feu SNS. Selon les flux, certaines inspections de s\u00e9curit\u00e9 (analyse antivirale, analyse antispam, filtrage URL, etc.) peuvent \u00eatre activ\u00e9es (nous d\u00e9taillerons ces analyses dans la fiche 7 \u00ab\u00a0Filtrage applicatif\u00a0\u00bb). Les r\u00e8gles de filtrage d\u00e9finies doivent respecter la politique de s\u00e9curit\u00e9 de l'entreprise.</p>"},{"location":"documentation/Stormshield/fiche07_filtrage_protocolaire_SNS/#presentation-des-fonctionnalites","title":"Pr\u00e9sentation des fonctionnalit\u00e9s","text":"<p>Pour d\u00e9finir un flux, une r\u00e8gle de filtrage se base sur de nombreux crit\u00e8res ; ce qui offre un haut niveau de granularit\u00e9. Parmi ces crit\u00e8res, il est notamment possible de pr\u00e9ciser\u00a0:</p> <ul> <li>l'adresse IP source et/ou destination\u00a0;</li> <li>la r\u00e9putation et la g\u00e9olocalisation de l'adresse IP source et/ou     destination\u00a0;</li> <li>l'interface d'entr\u00e9e et/ou sortie\u00a0;</li> <li>l'adresse r\u00e9seau source et/ou destination\u00a0;</li> <li>le FQDN source et/ou destination\u00a0;</li> <li>la valeur du champ DSCP\u00a0;</li> <li>le service TCP/UDP (n\u00b0 de port de destination)\u00a0;</li> <li>le protocole IP (dans le cas d'ICMP, le type de message ICMP peut     \u00eatre pr\u00e9cis\u00e9)\u00a0;</li> <li>l'utilisateur ou le groupe d'utilisateurs devant \u00eatre authentifi\u00e9.</li> </ul> <p>Le nombre de r\u00e8gles de filtrage actives dans une politique est limit\u00e9. Cette limite d\u00e9pend exclusivement du mod\u00e8le de pare-feu SNS.</p> <p>Le premier paquet appartenant \u00e0 chaque nouveau flux re\u00e7u par le pare-feu est confront\u00e9 aux r\u00e8gles de filtrage de la premi\u00e8re \u00e0 la derni\u00e8re ligne. Il est donc recommand\u00e9 d'ordonner au mieux les r\u00e8gles de la plus restrictive \u00e0 la plus g\u00e9n\u00e9raliste.</p> <p>Par d\u00e9faut, tout trafic qui n'est pas autoris\u00e9 explicitement par une r\u00e8gle de filtrage est bloqu\u00e9 (r\u00e8gle n\u00b0 3 de la politique de s\u00e9curit\u00e9 \u00ab\u00a0Block all\u00a0\u00bb).</p> <p>Dans les recommandations pour la d\u00e9finition d'une politique de filtrage r\u00e9seau d'un pare-feu publi\u00e9es par l'ANSSI le 30 mars 2013, il est pr\u00e9cis\u00e9 que la r\u00e8gle finale qui consiste \u00e0 bloquer et journaliser tout ce qui n'est pas autoris\u00e9 par les r\u00e8gles pr\u00e9c\u00e9dentes doit appara\u00eetre explicitement \u00e0 la fin de la politique de filtrage appliqu\u00e9e. L'ajout de cette r\u00e8gle explicite garantit l'application du mod\u00e8le de s\u00e9curit\u00e9 positif (tout ce qui n'a pas \u00e9t\u00e9 autoris\u00e9 pr\u00e9c\u00e9demment est interdit) et permet de s'assurer que la trace des flux non l\u00e9gitimes est conserv\u00e9e.</p> <p></p> <p>Les pare-feu SNS utilisent la technologie SPI (Stateful\u00a0Packet Inspection) qui leur permet de garder en m\u00e9moire l'\u00e9tat des connexions TCP (et SCTP) et des pseudo-connexions UDP et ICMP afin d'en assurer le suivi et de d\u00e9tecter d'\u00e9ventuelles anomalies ou attaques. La cons\u00e9quence directe de ce suivi \u00ab\u00a0Stateful\u00a0\u00bb est l'autorisation d'un flux par une r\u00e8gle de filtrage uniquement dans le sens de l'initiation de la connexion\u00a0: les r\u00e9ponses faisant partie de la m\u00eame connexion sont automatiquement autoris\u00e9es. Ainsi, nous n'avons nul besoin d'une r\u00e8gle de filtrage suppl\u00e9mentaire pour autoriser les paquets r\u00e9ponse d'une connexion \u00e9tablie au travers du pare-feu.</p> <p>La figure page suivante pr\u00e9sente l'ordre d'application des r\u00e8gles de filtrage et de NAT.</p> <p>Information importante</p> <p>il est important de noter que les paquets sont filtr\u00e9s avant que la phase de traduction (NAPT).</p> <p></p> <p>Le premier paquet re\u00e7u est confront\u00e9 aux r\u00e8gles de filtrage des diff\u00e9rents niveaux suivant l'ordre pr\u00e9sent\u00e9 dans la figure ci-apr\u00e8s. D\u00e8s que les \u00e9l\u00e9ments du paquet correspondent \u00e0 une r\u00e8gle dans un niveau, l'action de la r\u00e8gle (bloquer ou autoriser) est appliqu\u00e9e et le paquet n'est plus confront\u00e9 aux r\u00e8gles suivantes. Si aucune r\u00e8gle de filtrage ne correspond, le paquet est bloqu\u00e9 par d\u00e9faut.</p> <p>Dans le cas o\u00f9 le paquet est autoris\u00e9, il est confront\u00e9 aux r\u00e8gles de NAT des diff\u00e9rents niveaux toujours suivant l'ordre pr\u00e9sent\u00e9 ci-apr\u00e8s.</p> <ul> <li>Le filtrage implicite regroupe les r\u00e8gles de filtrage     pr\u00e9-configur\u00e9es ou ajout\u00e9es dynamiquement par le pare-feu pour     autoriser ou bloquer certains flux apr\u00e8s l'activation d'un service.     Par exemple, une r\u00e8gle implicite autorise les connexions \u00e0     destination des interfaces internes du pare-feu SNS sur le port     HTTPS (443/TCP) afin d'assurer un acc\u00e8s continu \u00e0 l'interface     d'administration Web. Autre exemple, d\u00e8s l'activation du service     SSH, un ensemble de r\u00e8gles implicites sera ajout\u00e9 pour autoriser ces     connexions depuis toutes les machines des r\u00e9seaux internes.</li> <li>Le filtrage global regroupe les r\u00e8gles de filtrage inject\u00e9es au     pare-feu depuis l'outil d'administration \u00ab\u00a0Stormshield Management     Server\u00a0\u00bb (SMC) ou apr\u00e8s affichage des politiques globales.</li> <li>Le filtrage local repr\u00e9sente les r\u00e8gles de filtrage ajout\u00e9es par     l'administrateur depuis l'interface d'administration du pare-feu     SNS.</li> </ul> <p>Les r\u00e8gles implicites sont accessibles depuis le menu CONFIGURATION / POLITIQUE DE S\u00c9CURIT\u00c9 / R\u00e8gles implicites. Chaque r\u00e8gle peut \u00eatre activ\u00e9e/d\u00e9sactiv\u00e9e.</p> <p>Information importante</p> <p>Ouvrir le menu Configuration / Politique de s\u00e9curit\u00e9 / R\u00e8gles     implicites.</p> <p>Information importante</p> <p>La modification de l'\u00e9tat de ces r\u00e8gles a un impact direct sur le fonctionnement des services du pare-feu. Pour que le service concern\u00e9 fonctionne toujours, il faut s'assurer au pr\u00e9alable que le flux est autoris\u00e9 par les r\u00e8gles de priorit\u00e9 moindre telles que globales ou locales.</p>"},{"location":"documentation/Stormshield/fiche07_filtrage_protocolaire_SNS/#analyse-des-politiques-predefinies-de-filtrage","title":"Analyse des politiques pr\u00e9d\u00e9finies de filtrage","text":"<p>Vous allez dans un premier temps d\u00e9couvrir \u00e0 travers les r\u00e8gles d\u00e9j\u00e0 d\u00e9finies dans les deux premi\u00e8res politiques pr\u00e9d\u00e9finies de filtrage, le fonctionnement des r\u00e8gles de filtrage sur un pare-feu Stormshield.</p> <ul> <li>Ouvrir le menu Configuration / Politique de s\u00e9curit\u00e9 /     Filtrage et NAT / Filtrage</li> <li>Dans la liste d\u00e9roulante des politiques de s\u00e9curit\u00e9, choisir(1)     Block all.</li> </ul> <p></p> <p>Cette politique bloque presque tous les flux (r\u00e8gle N\u00b03) sauf ceux d\u00e9finis par les r\u00e8gles 1 et 2.</p> <ul> <li> <p>La r\u00e8gle num\u00e9ro 1 autorise l'acc\u00e8s en https et sur le port pr\u00e9d\u00e9fini 1300 pare-feu_srv \u00e0 toutes les interfaces du pare-feu, elle permet donc l'administration \u00e0 distance depuis n'importe quel r\u00e9seau.</p> </li> <li> <p>La r\u00e8gle num\u00e9ro 2 autorise les requ\u00eates ICMP Echo vers toutes les interfaces du pare-feu, afin de pouvoir v\u00e9rifier la pr\u00e9sence du pare-feu \u00e0 l'aide des commandes ICMP. Attention\u00a0: un ping vers la passerelle par d\u00e9faut \u00e9choue, car il n'est pas explicitement autoris\u00e9.</p> </li> <li> <p>Dans la liste d\u00e9roulante des politiques de s\u00e9curit\u00e9, choisir (2)     High.</p> </li> </ul> <p></p> <p>Cette politique est un peu moins restrictive que la pr\u00e9c\u00e9dente, elle autorise plus de chose \u00e0 partir des r\u00e9seaux internes.</p> <ul> <li> <p>La r\u00e8gle num\u00e9ro 1 autorise l'acc\u00e8s \u00e0 des services web en http, https, dns \u21d2 elle permet l'acc\u00e8s \u00e0 des sites web.</p> </li> <li> <p>La r\u00e8gle num\u00e9ro 2 autorise l'acc\u00e8s \u00e0 des services ftp.</p> </li> <li> <p>La r\u00e8gle num\u00e9ro 3 autorise l'acc\u00e8s \u00e0 des services de messagerie en</p> </li> <li> <p>imap, smtp, pop3 elle permet l'envoi et la r\u00e9ception de messages.</p> </li> <li> <p>La r\u00e8gle num\u00e9ro 4 autorise les requ\u00eates ICMP Echo vers n'importe quelle destination des r\u00e9seaux internes, afin de pouvoir v\u00e9rifier la pr\u00e9sence du pare-feu et des services en DMZ \u00e0 l'aide des commandes ICMP. Attention\u00a0: un ping vers la passerelle par d\u00e9faut \u00e9choue car il n'est pas explicitement autoris\u00e9.</p> </li> </ul> <p>Information importante</p> <p>Vous remarquerez que pour toutes ces r\u00e8gles la colonne \u00ab\u00a0Inspection de s\u00e9curit\u00e9\u00a0\u00bb stipule IPS(Intrusion Prevention System) qui est le niveau le plus \u00e9lev\u00e9 de filtrage avec inspection du contenu et le cas \u00e9ch\u00e9ant blocage si l'on suspecte un comportement anormal ou une tentative d'intrusion.</p>"},{"location":"documentation/Stormshield/fiche07_filtrage_protocolaire_SNS/#creation-dune-regle-de-filtrage","title":"Cr\u00e9ation d'une r\u00e8gle de filtrage","text":""},{"location":"documentation/Stormshield/fiche07_filtrage_protocolaire_SNS/#principes-generaux","title":"Principes g\u00e9n\u00e9raux","text":"<p>Les r\u00e8gles de filtrage s'int\u00e8grent dans une politique de filtrage. Il est possible de modifier une politique existante puis de l'appliquer. Vous pouvez utiliser une politique qui contient d\u00e9j\u00e0 des r\u00e8gles ou non comme la politique n\u00b05.</p> <p>Information</p> <p>\u00c0 noter qu'il est possible de copier/coller des politiques de s\u00e9curit\u00e9 et des r\u00e8gles que l'on modifie \u00e9ventuellement ensuite.</p> <p>Pour renommer la politique\u00a0:</p> <p></p> <ul> <li>Cliquer sur Editer puis Renommer</li> <li> <p>Modifier le nom et cliquer sur METTRE \u00c0 JOUR</p> </li> <li> <p>Ouvrir le menu Configuration / Politique de s\u00e9curit\u00e9 /     Filtrage et NAT / Filtrage</p> </li> </ul> <p></p> <p>L'onglet FILTRAGE est compos\u00e9 d'un en-t\u00eate pour la gestion des r\u00e8gles de filtrage\u00a0:</p> <ul> <li>R\u00e8gle simple\u00a0: ajoute une r\u00e8gle de filtrage standard. Par     d\u00e9faut, une nouvelle r\u00e8gle est d\u00e9sactiv\u00e9e et tous ses crit\u00e8res sont     param\u00e9tr\u00e9s \u00e0\u00a0Any.</li> <li>S\u00e9parateur -- regroupement de r\u00e8gles\u00a0: ajoute un s\u00e9parateur qui     regroupe toutes les r\u00e8gles se trouvant au-dessous (ou jusqu'au     prochain s\u00e9parateur). Cela permet de faciliter l'affichage d'une     politique contenant un nombre de r\u00e8gles important. Le s\u00e9parateur     peut \u00eatre personnalis\u00e9 par une couleur et un commentaire.</li> <li>R\u00e8gle d'authentification\u00a0: d\u00e9marre un assistant qui facilite     l'ajout d'une r\u00e8gle dont le r\u00f4le est de rediriger les connexions des     utilisateurs non-authentifi\u00e9s vers le portail captif.</li> <li>R\u00e8gle d'inspection SSL\u00a0: d\u00e9marre un assistant qui facilite     l'ajout de r\u00e8gles pour l'activation du proxy SSL.</li> <li>R\u00e8gle de proxy HTTP explicite\u00a0: d\u00e9marre un assistant qui     facilite l'ajout de r\u00e8gles pour l'activation du proxy HTTP     explicite.</li> </ul> <p>Sur la barre de menu, vous disposez notamment des boutons\u00a0:</p> <ul> <li>Supprimer\u00a0: supprime une r\u00e8gle.</li> <li>Monter\u00a0/ Descendre\u00a0: monter ou descendre la/les r\u00e8gle(s)     s\u00e9lectionn\u00e9e(s) d'une position dans la liste.</li> <li>Chercher dans les logs\u00a0: chercher les traces g\u00e9n\u00e9r\u00e9es par     l'application de cette r\u00e8gle dans les journaux d'audit (la recherche     s'effectue sur le nom de la r\u00e8gle \u21d2 Il vaut mieux lui donner un     nom explicite).</li> <li>Chercher dans la supervision\u00a0: chercher le nom de cette r\u00e8gle     dans la supervision des connexions.</li> <li>R\u00e9initialiser les statistiques des r\u00e8gles\u00a0: r\u00e9initialiser les     compteurs d'utilisation de toutes les r\u00e8gles de filtrage et NAT de     la politique active.</li> </ul>"},{"location":"documentation/Stormshield/fiche07_filtrage_protocolaire_SNS/#exemple-de-creation-dune-regle-simple-classique","title":"Exemple de cr\u00e9ation d'une r\u00e8gle simple classique","text":"<p>Le r\u00e9seau interne doit pouvoir \u00e9mettre un ping vers n'importe quelle destination.</p> <ul> <li>Cliquer Nouvelle r\u00e8gle / r\u00e8gle simple</li> <li>Action : Passer</li> <li>Source : L'adresse IP ou le r\u00e9seau source, ici     Network_internals</li> <li>Protocole dest : Port destination, ici ICMP.</li> </ul> <p></p> <ul> <li>Type de protocole\u00a0: Protocole IP</li> <li>Protocole IP\u00a0: icmp</li> <li>Message ICMP\u00a0: choisir au milieu de la liste     requ\u00eate Echo (Ping, type 8, code 0)</li> </ul> <p>La nouvelle r\u00e8gle se pr\u00e9sente ainsi\u00a0:</p> <p></p> <ul> <li>Double-cliquer sur le bouton off pour passer la r\u00e8gle \u00e0 l'\u00e9tat     on, puis cliquez Appliquer puis Oui, activer la     politique.</li> </ul>"},{"location":"documentation/Stormshield/fiche07_filtrage_protocolaire_SNS/#exemple-dune-regle-integrant-egalement-le-natp","title":"Exemple d'une r\u00e8gle int\u00e9grant \u00e9galement le NATP","text":"<p>Dans une r\u00e8gle de filtrage, une directive de NAT sur la destination (DNAT) peut \u00eatre appliqu\u00e9e, sauf si elle contient un objet FQDN, ou des \u00e9l\u00e9ments de g\u00e9olocalisation et /ou de r\u00e9putation.</p> <p>La figure ci-dessous illustre une translation sur la destination d'un trafic SMTP entrant. La r\u00e8gle de filtrage autorise ce trafic en provenance d'un r\u00e9seau externe et \u00e0 destination de l'adresse IP publique du serveur STMP sur le port SMTP/25.</p> <p>L'adresse et le port destination sont translat\u00e9s respectivement par l'adresse IP priv\u00e9e du serveur SMTP et le port SMTP/25 directement dans la r\u00e8gle de filtrage o\u00f9 la publication ARP est \u00e9galement activ\u00e9e. Gr\u00e2ce \u00e0 cette configuration, il n'est pas n\u00e9cessaire d'ajouter une r\u00e8gle de translation pour rediriger ce trafic. </p> <p>Il existe plusieurs avantages \u00e0 cr\u00e9er une directive de NAT sur destination au sein d'une r\u00e8gle de filtrage\u00a0:</p> <ul> <li>indication rapide du flux autoris\u00e9 avec redirection vers la machine     interne\u00a0;</li> <li>gestion et supervision des r\u00e8gles entrantes dans un seul menu\u00a0;</li> <li>optimisation du temps de traitement des r\u00e8gles puisque les r\u00e8gles     pr\u00e9sentes dans l'onglet NAT ne sont pas parcourues\u00a0;</li> <li>activation de protections applicatives (filtrage SMTP, antispam,     etc.) \u00e0 des connexions entrantes translat\u00e9es.</li> </ul>"},{"location":"documentation/Stormshield/fiche07_filtrage_protocolaire_SNS/#quelques-fonctionnalites-supplementaires","title":"Quelques fonctionnalit\u00e9s suppl\u00e9mentaires","text":"<p>Ce qui suit est loin d'\u00eatre exhaustif:</p> <p>L'onglet G\u00c9OLOCALISATION / R\u00c9PUTATION du menu Source ou Destination permet d'ajouter un certain nombre de r\u00e8gles\u00a0:</p> <ul> <li>G\u00e9olocalisation : permet de renseigner un continent ou un pays \u00e0     l'origine du trafic. La liste ne contient pas d'adresses IP, le     Firewall d\u00e9termine le pays auquel appartient une IP, plut\u00f4t que de     charger toutes les IP (les blocs d'adressage sont tr\u00e8s fragment\u00e9s     sur Internet).</li> <li>R\u00e9putation des adresses IP publiques : une IP publique peut     avoir une r\u00e9putation \u00e0 la limite de deux cat\u00e9gories. Le groupe \u00ab Bad     \u00bb regroupe les cat\u00e9gories : anonymizer, botnet, malware, phishing,     scanner, spam et tor.    </li> <li>R\u00e9putation des machines : Il est possible     d'activer le filtrage selon le score de r\u00e9putation des machines du     r\u00e9seau interne. Il faut au pr\u00e9alable activer la gestion de     r\u00e9putation des machines et d\u00e9finir les machines concern\u00e9es par le     calcul d\\'un score de r\u00e9putation.</li> </ul> <p>Dans le menu Source, les param\u00e8tres G\u00e9olocalisation et R\u00e9putation des adresses IP publiques sont utilis\u00e9s g\u00e9n\u00e9ralement pour qualifier le flux entrant (provenant d'Internet), alors que le param\u00e8tre R\u00e9putation des machines est utilis\u00e9 pour qualifier le flux sortant.</p> <p>Information importante</p> <p>NOTE : Le score de r\u00e9putation des machines internes, configurable dans ce menu, permet de pr\u00e9ciser le score au-dessus duquel ou en-dessous duquel la r\u00e8gle de filtrage s\\'appliquera aux machines supervis\u00e9es</p> <p>Information importante</p> <p>Le group \u00ab\u00a0bad\u00a0\u00bb int\u00e8gre toutes les cat\u00e9gories pr\u00e9c\u00e9dentes (de \u00ab\u00a0anonymizer\u00a0\u00bb \u00e0 \u00ab\u00a0tor exit node\u00a0\u00bb).</p>"},{"location":"documentation/Stormshield/fiche08_filtrage_applicatifSNS/","title":"Fiche 08 -- Filtrage applicatif","text":"<p>La mise en place d'une politique de filtrage, permet \u00e0 l'administrateur de d\u00e9finir les r\u00e8gles qui permettront d'autoriser ou de bloquer des flux au travers du pare-feu SNS. Selon les flux, certaines inspections de s\u00e9curit\u00e9 (analyse antivirale, analyse antispam, filtrage URL, etc.) peuvent \u00eatre activ\u00e9es sur les pare-feu SNS afin de\u00a0:</p> <ul> <li>contr\u00f4ler les acc\u00e8s \u00e0 certains sites web d'Internet (filtrage d'URL     et filtrage SSL)\u00a0;</li> <li>cr\u00e9er une politique anti-relais et antispam (filtrage SMTP)\u00a0;</li> <li>effectuer une analyse antivirale sur les flux DATA (HTTP, SMTP, FTP,     POP3, etc.)\u00a0;</li> <li>bloquer les maliciels \u00e0 l'aide d'une analyse comportementale sur des     machines de d\u00e9tonation (sandboxing Breachfighter).</li> </ul>"},{"location":"documentation/Stormshield/fiche08_filtrage_applicatifSNS/#configuration-du-service-proxy-web-http","title":"Configuration du service proxy Web HTTP","text":"<p>La fonction de filtrage des URL permet de contr\u00f4ler l'acc\u00e8s aux sites web d'Internet pour l'ensemble des utilisateurs. Pour contr\u00f4ler ces acc\u00e8s, la politique de filtrage URL va se baser sur une liste d'URL class\u00e9es en cat\u00e9gories ou de mots cl\u00e9s personnalis\u00e9s.</p>"},{"location":"documentation/Stormshield/fiche08_filtrage_applicatifSNS/#les-bases-durl-disponibles","title":"Les bases d'URL disponibles","text":"<p>Deux fournisseurs de base URL sont disponibles sur les pare-feu SNS\u00a0:</p> <ol> <li>Base URL embarqu\u00e9e compos\u00e9e de 16 cat\u00e9gories t\u00e9l\u00e9charg\u00e9es sur les     serveurs de mise \u00e0 jour,</li> <li>Base Extended Web Control (EWC) constitu\u00e9e de 65 cat\u00e9gories, toutes     h\u00e9berg\u00e9es dans le Cloud. Cette base est disponible en option     payante, elle est n\u00e9anmoins incluse dans les VM du partenariat     Stormshield Academy.</li> </ol> <ul> <li>Ouvrir Configuration / Objets / Objets Web onglet Base     d'URL. La base par d\u00e9faut est la Base URL embarqu\u00e9e.</li> </ul> <p></p> <p>Les cat\u00e9gories pr\u00e9d\u00e9finies pour la Base URL embarqu\u00e9e sont disponibles. Le contenu des cat\u00e9gories ne peut pas \u00eatre consult\u00e9. Cependant, l'appartenance d'une URL \u00e0 un groupe peut \u00eatre v\u00e9rifi\u00e9e par le biais des champs de classification. Ces champs sont disponibles depuis le menu Objets Web ou au sein d'une politique de filtrage URL.</p> <p>Par exemple, pour v\u00e9rifier l'appartenance de Stormshield \u00e0 une des cat\u00e9gories de la base\u00a0:</p> <ul> <li>Ouvrir Configuration / Objets / Objets Web onglet     URL.</li> <li>Dans la zone V\u00e9rifier l'utilisation saisir stormshield.eu et     cliquer Classifier.</li> </ul> <p></p> <p>Le r\u00e9sultat s'affiche dans la zone de commentaires, l'URL stormshield.eu fait partie de la cat\u00e9gorie IT\u00a0:</p> <p></p> <ul> <li>Au besoin cliquer le symbole au bas de l'\u00e9cran      pour d\u00e9plier la zone de commentaires.</li> </ul> <p></p>"},{"location":"documentation/Stormshield/fiche08_filtrage_applicatifSNS/#politique-de-filtrage-durl-pre-definie","title":"Politique de filtrage d'URL pr\u00e9-d\u00e9finie","text":"<p>Une seule politique de filtrage est pr\u00e9d\u00e9finie par d\u00e9faut (quelle que soit la politique choisie, ce sont les deux m\u00eame r\u00e8gles qui apparaissent).</p> <ul> <li>Ouvrir le menu Configuration / Politique de s\u00e9curit\u00e9 /     Filtrage URL</li> <li> <p>Dans la liste d\u00e9roulante des politiques de s\u00e9curit\u00e9, choisissez     (0)     URLFilter_00.     </p> <ul> <li> <p>La r\u00e8gle num\u00e9ro 1 (non activ\u00e9e) autorise les URL qui font partie du groupe authentication_bypass qui peut \u00eatre consult\u00e9 dans le menu Objets Web, il s'agit des sites qui permettent les mises \u00e0 jour Microsoft.</p> </li> <li> <p>La r\u00e8gle num\u00e9ro 2 laisse explicitement passer tous les flux.</p> </li> </ul> </li> </ul> <p>Les r\u00e8gles de filtrage d'URL sont compos\u00e9es d'une colonne Action et d'une colonne Cat\u00e9gorie d'URL.</p> <ul> <li>La colonne Action permet de Bloquer ou de Passer ou de rediriger vers l'une des 4 pages de blocage personnalisables.</li> </ul> <p> </p> <ul> <li>Cat\u00e9gorie d'URL : La colonne contient la liste des cat\u00e9gories pr\u00e9d\u00e9finies de la base URL embarqu\u00e9e et les cat\u00e9gories personnalis\u00e9es que vous avez cr\u00e9\u00e9es. </li> </ul> <p> </p> <p>Il convient ensuite de choisir les cat\u00e9gories de sites \u00e0 autoriser, bloquer ou \u00e0 rediriger vers l'une des 4 pages de blocage personnalisables. Le contr\u00f4le de coh\u00e9rence en temps r\u00e9el affiche les erreurs d\u00e9tect\u00e9es dans votre politique.</p>"},{"location":"documentation/Stormshield/fiche08_filtrage_applicatifSNS/#creation-dune-base-url-personnalisee","title":"Cr\u00e9ation d'une base URL personnalis\u00e9e","text":"<p>Si les cat\u00e9gories de sites web pr\u00e9d\u00e9finies par votre base d'URL ne sont pas exactement adapt\u00e9es \u00e0 vos besoins, il est n\u00e9cessaire de cr\u00e9er ses propres cat\u00e9gories pour y mettre les URL que l'on souhaite bloquer ou autoriser.</p> <p>Information importante</p> <p>Il est recommand\u00e9 de pr\u00e9voir au moins une cat\u00e9gorie de type \u00ab\u00a0white list\u00a0\u00bb et une cat\u00e9gorie de type \u00ab\u00a0black list\u00a0\u00bb.</p> <ul> <li>Dans l'onglet URL, cliquer sur Ajouter une cat\u00e9gorie     personnalis\u00e9e puis donnez-lui un nom (par exemple black_list).</li> <li>Dans la zone Cat\u00e9gorie d'URL, cliquer sur Ajouter une URL et     saisir par exemple *.badssl.com/*.</li> </ul> <p>Information iminteressante</p> <p>Le site badssl.com permet d'effectuer de nombreux tests de configuration des navigateurs Internet. En particulier l'URL http.badssl.com permet de tester l'affichage d'une page web en HTTP.</p>"},{"location":"documentation/Stormshield/fiche08_filtrage_applicatifSNS/#creation-dune-regle-de-blocage","title":"Cr\u00e9ation d'une r\u00e8gle de blocage","text":"<p>Information</p> <p>Ce qui suit est valable pour n'importe quelle cat\u00e9gorie mais le mode op\u00e9ratoire porte sur la cat\u00e9gorie personnalis\u00e9e \u00ab\u00a0black_list\u00a0\u00bb.</p> <ul> <li> <p>Dans la liste d\u00e9roulante des politiques de s\u00e9curit\u00e9, choisir une des     r\u00e8gles de politique de filtrage d'URL (par exemple, (0)     URLFilter_00) et cliquer sur \u00c9diter.</p> </li> <li> <p>Renommer cette politique (par exemple \u00a0\u00ab\u00a0Proxy_Cub \u00bb) et mettre \u00e0     jour.</p> </li> <li> <p>Se positionner sur la premi\u00e8re r\u00e8gle (d\u00e9sactiv\u00e9e) et cliquer +     Ajouter pour ajouter une nouvelle r\u00e8gle de filtrage d'URL.</p> </li> </ul> <p></p> <ul> <li>Au niveau de la deuxi\u00e8me r\u00e8gle, dans Action, laisser     BlockPage_00 et dans la colonne Cat\u00e9gorie d'URL, choisir     black_list, puis cliquer sur Appliquer puis sur     Sauvegarder.</li> </ul> <p>Information</p> <p>Les pages de blocage par d\u00e9faut, ici BlockPage_00 peuvent \u00eatre \u00e9dit\u00e9es depuis le menu Configuration \u21d2 Notifications \u21d2 Messages de blocage \u21d2 Onglet Page de blocage HTTP. Les modifications peuvent s'effectuer gr\u00e2ce \u00e0 l'\u00e9diteur HTML, cela permet de personnaliser la page.</p>"},{"location":"documentation/Stormshield/fiche08_filtrage_applicatifSNS/#affectation-dune-politique-de-filtrage-url","title":"Affectation d'une politique de filtrage URL","text":"<ul> <li>Ouvrir Configuration / Politique de s\u00e9curit\u00e9 / Filtrage et NAT,     et choisir la politique de s\u00e9curit\u00e9 actuellement appliqu\u00e9e.</li> <li>Dans l'onglet Filtrage, ouvrir la ou les r\u00e8gles qui autorisent     l'acc\u00e8s \u00e0 Internet avec le protocole http. Dans l'onglet     Inspection de s\u00e9curit\u00e9, dans la zone Inspection choisir,     dans la liste Filtrage URL, la politique de filtrage URL \u00e0     appliquer.</li> </ul> <p>Vous devez obtenir la r\u00e8gle suivante\u00a0:</p> <p>A v\u00e9rifier</p> <p></p> <p>Na pas faire attention \u00e0 l'avertissement. En cas d'acc\u00e8s \u00e0 un site en HTTPS, il faudra effectivement d'abord d\u00e9chiffrer le flux pour pouvoir d\u00e9cider du blocage ou non, ce qui n\u00e9cessite l'utilisation d'un proxy SSL (voir partie suivante).</p> <p></p> <p>Pour tester</p> <ul> <li>Ouvrir la page web http.badssl.com depuis votre navigateur, elle     ne doit pas s'afficher correctement. Vous devez voir le message de     blocage ci-contre\u00a0:</li> </ul>"},{"location":"documentation/Stormshield/fiche08_filtrage_applicatifSNS/#configuration-du-service-proxy-web-https","title":"Configuration du service proxy Web HTTPS","text":"<p>De nombreux services r\u00e9seau tels que le web, la messagerie, la messagerie instantan\u00e9e, utilisent le protocole SSL/TLS pour authentifier les correspondants et chiffrer leurs communications.</p> <p>Les pare-feu SNS sont capables de filtrer et d\u00e9chiffrer les connexions HTTPS, ce qui permet\u00a0:</p> <ul> <li>de bloquer des sites web HTTPS ou des cat\u00e9gories de sites web HTTPS     inappropri\u00e9s\u00a0;</li> <li>d'analyser les flux HTTPS pour les fonctions de protection     applicative (e.g., anti-virus,\u00a0sandboxing, filtrage URL, Google     SafeSearch, etc.).</li> </ul> <p>Deux m\u00e9thodes sont envisageables pour filtrer les connexions HTTPS\u00a0: avec ou sans d\u00e9chiffrement des flux SSL. Ces deux m\u00e9thodes peuvent \u00eatre combin\u00e9es en fonction de diff\u00e9rents crit\u00e8res, tels que l'authentification, le r\u00e9seau IP source ou certaines URL de destination.</p>"},{"location":"documentation/Stormshield/fiche08_filtrage_applicatifSNS/#principe-du-filtrage-sans-dechiffrement-des-flux-ssl","title":"Principe du filtrage SANS d\u00e9chiffrement des flux SSL","text":"<p>Cette m\u00e9thode permet de bloquer les sites web HTTPS ind\u00e9sirables en v\u00e9rifiant seulement leur certificat sans d\u00e9chiffrer le flux. Ainsi, lorsqu'un client initie une connexion vers un site en HTTPS, il envoie en clair au serveur le nom de domaine du site demand\u00e9.</p> <p>Ce m\u00e9canisme appel\u00e9 Server Name Indication (SNI) permet au serveur de s\u00e9lectionner le bon certificat \u00e0 pr\u00e9senter au client. Stormshield Network Security s'appuie sur ce syst\u00e8me pour contr\u00f4ler l'acc\u00e8s \u00e0 ces sites web sans d\u00e9chiffrer le flux.</p> <p>Avec ce type de filtrage, les pare-feu SNS sont compatibles avec les extensions SNI (Server Name Indication), permettant de d\u00e9crire explicitement le nom de l'h\u00f4te avec lequel une session TLS est en n\u00e9gociation. Un message de certificat invalide appara\u00eetra en cas de blocage puis une page de blocage non personnalisable.</p> <p></p> <p>Si vous choisissez Advanced et Proceed, vous aurez acc\u00e8s \u00e0 la page de blocage du pare-feu SNS\u00a0:</p> <p></p> <p>En revanche, cette m\u00e9thode ne permet pas d'analyser les connexions HTTPS avec les protections applicatives tels que l'anti-virus, le sandboxing, Google SafeSearch.</p> <p>Information</p> <p>Une combinaison des deux m\u00e9thodes (voir ci-apr\u00e8s) est plus judicieux.</p>"},{"location":"documentation/Stormshield/fiche08_filtrage_applicatifSNS/#principe-du-filtrage-avec-dechiffrement-des-flux-ssl","title":"Principe du filtrage AVEC d\u00e9chiffrement des flux SSL","text":"<p>Le proxy SSL est positionn\u00e9 en \u00ab\u00a0homme du milieu\u00a0\u00bb (Man in the middle) sur le trafic SSL entre le client et le serveur web. Il se charge des n\u00e9gociations SSL et s\u00e9curise ainsi les connexions proxy SSL/serveur, et proxy SSL/client. Entre les deux, il autorise ou bloque les connexions selon la politique de filtrage, et si besoin, il d\u00e9chiffre les flux SSL.</p> <p>Attention</p> <p>Le d\u00e9chiffrement des donn\u00e9es personnelles \u00e9tant encadr\u00e9 par la loi dans la majorit\u00e9 des pays, le filtrage SSL doit prendre en compte cette l\u00e9gislation. Vous devez exclure les sites qui ne doivent pas \u00eatre d\u00e9chiffr\u00e9s en leur appliquant l'action Passer sans d\u00e9chiffrer (e.g., en France les sites bancaires). Pour la France, les aspects juridiques li\u00e9s au d\u00e9chiffrement SSL sont d\u00e9taill\u00e9s en annexe du document Recommandations de s\u00e9curit\u00e9 concernant l'analyse des flux HTTPS de l'ANSSI.</p> <p>Attention</p> <p>Il est n\u00e9cessaire de  comprendre les \u00e9tapes du filtrage SSL.avec d\u00e9chiffrement et les \u00e9l\u00e9ments de configuration pr\u00e9-d\u00e9finis.</p> <ul> <li> <p>Ouvrir le menu Configuration / Politique de s\u00e9curit\u00e9 /     Filtrage SSL</p> </li> <li> <p>Dans la liste d\u00e9roulante des politiques de s\u00e9curit\u00e9, choisir par     exemple (0) SSLFilter_00.</p> </li> </ul> <p></p> <ul> <li>\u00c9diter un des 10 profils et le renommer (par exemple, renommer (0)     SSLFilter_00 en proxy_SSL)</li> </ul> <p>Pour chacune des 10 politiques de filtrage par d\u00e9faut, deux r\u00e8gles sont pr\u00e9sentes. La r\u00e8gle num\u00e9ro 1 sp\u00e9cifie de Passer sans d\u00e9chiffrer les URL-CN qui font partie de la cat\u00e9gorie proxyssl_bypass. En effet, ces serveurs d\u00e9tectent que le proxy SSL g\u00e9n\u00e8re un certificat usurp\u00e9 et sont susceptibles de refuser les connexions (c'est le cas par exemple de mozilla.org).</p> <p>La r\u00e8gle num\u00e9ro 2 sp\u00e9cifie de d\u00e9chiffrer tous les autres.</p> <p></p> <p>La cat\u00e9gorie par d\u00e9faut proxyssl_bypass contient donc une liste de noms de certificats que Stormshield recommande de laisser passer sans d\u00e9chiffrer.</p> <p>Il est possible d'ajouter ou de supprimer un nom de certificat (CN) de cette cat\u00e9gorie.</p> <ul> <li>Pour cr\u00e9er, si besoin, une nouvelle cat\u00e9gorie\u00a0: menu CONFIGURATION     \u21d2 OBJETS \u21d2 Objets Web, dans l'onglet NOM DE CERTIFICAT (CN).</li> <li>Pour cr\u00e9er, si besoin, un groupe de cat\u00e9gorie\u00a0:menu CONFIGURATION     \u21d2 OBJETS \u21d2 Objets Web, dans l'onglet GROUPE DE CAT\u00c9GORIES, choisir     un objet de type groupe de cat\u00e9gories Certificats. Un groupe de     cat\u00e9gories peut \u00eatre compos\u00e9 de cat\u00e9gories pr\u00e9sentes dans la base     (EWC ou embarqu\u00e9e), mais aussi de cat\u00e9gories personnalis\u00e9es.</li> </ul> <p>Une r\u00e8gle d\u00e9finit l'action donc \u00e0 appliquer pour une cat\u00e9gorie d'URL-CN. Apr\u00e8s la r\u00e9ception du certificat serveur et la confirmation que le SNI demand\u00e9 correspond au CN (common name) du certificat ou \u00e0 un des noms alternatifs, le SNI est confront\u00e9 aux r\u00e8gles de filtrage SSL. Dans le cas o\u00f9 une r\u00e8gle correspond, l'action de la r\u00e8gle est appliqu\u00e9e\u00a0:</p> <ul> <li> <p>D\u00e9chiffrer : le proxy SSL \u00e9tablit une session TLS avec le     &gt; serveur et une autre avec le client en lui pr\u00e9sentant le     &gt; certificat usurp\u00e9.</p> </li> <li> <p>Bloquer sans d\u00e9chiffrer : le proxy SSL ferme les connexions     &gt; TCP avec le serveur et le client apr\u00e8s l'\u00e9tablissement des     &gt; sessions TLS. Le client recevra quand m\u00eame le certificat usurp\u00e9.</p> </li> <li> <p>Passer sans d\u00e9chiffrer : le proxy SSL ferme la connexion TCP     &gt; apr\u00e8s l'\u00e9tablissement de la session TLS et ouvre une deuxi\u00e8me     &gt; connexion TCP pour renvoyer les commandes TLS du client.</p> </li> </ul> <p>Attention</p> <p>Pour les actions Bloquer sans d\u00e9chiffrer et Passer sans d\u00e9chiffrer, le trio [IP, port, SNI] est ajout\u00e9 au cache du proxy SSL pour appliquer l'action d\u00e8s la r\u00e9ception du SNI lors d'une prochaine connexion au m\u00eame serveur.</p> <p>Attention</p> <p>Pour limiter l'impact du proxy SSL sur les performances du pare-feu, le filtrage SSL peut \u00eatre utilis\u00e9 pour passer sans d\u00e9chiffrer plusieurs sites qui ne repr\u00e9sentent pas une menace sur la s\u00e9curit\u00e9 de l'entreprise, par exemple les sites de mises jours des syst\u00e8mes et des logiciels.</p> <p>Apr\u00e8s avoir (si besoin) modifi\u00e9 un profil, il convient d'activer le proxy SSL.</p>"},{"location":"documentation/Stormshield/fiche08_filtrage_applicatifSNS/#activation-du-proxy-ssl","title":"Activation du proxy SSL","text":""},{"location":"documentation/Stormshield/fiche08_filtrage_applicatifSNS/#methode-1-utilisation-de-lassistant","title":"M\u00e9thode 1\u00a0: utilisation de l'assistant","text":"<ul> <li>Se rendre dans le menu CONFIGURATION \u21d2 POLITIQUE DE S\u00c9CURIT\u00c9 \u21d2     FILTRAGE ET NAT =&gt; onglet FILTRAGE pour y ajouter la r\u00e8gle     d'inspection SSL.</li> </ul> <p>L' assistant \u00ab\u00a0R\u00e8gle d'inspection SSL\u00a0\u00bb a pour but de cr\u00e9er des r\u00e8gles inspectant le trafic chiffr\u00e9 SSL. Il est conseill\u00e9 de passer par cet assistant pour la g\u00e9n\u00e9ration des deux r\u00e8gles indispensables au bon fonctionnement du proxy SSL.</p> <p>Attention</p> <p>Les deux r\u00e8gles sont cr\u00e9\u00e9es m\u00eame s'il y avait auparavant une r\u00e8gle pour le trafic HTTPS. Il ne faut alors garder que la premi\u00e8re et modifier l'une des deux r\u00e8gles concernant le trafic HTTPS et supprimer l'autre.</p> <ul> <li> <p>D\u00e9finir, dans la premi\u00e8re zone, la politique du trafic \u00e0 d\u00e9chiffrer     en indiquant\u00a0:</p> <ul> <li>les machines sources (\u00ab\u00a0Network_internals\u00a0\u00bb par d\u00e9faut)\u00a0;</li> <li>l'interface d'entr\u00e9e (\u00ab\u00a0any\u00a0\u00bb par d\u00e9faut)\u00a0;</li> <li>la destination (\u00ab\u00a0Internet \u00bb par d\u00e9faut) et le port de destination     (\u00ab ssl_srv \u00bb par d\u00e9faut) parmi la liste d\u00e9roulante d'objets\u00a0: il     contient les ports standards des services utilisant une session TLS     : HTTPS, IMAPS, LDAPS, SMTPS, etc.</li> </ul> </li> <li> <p>D\u00e9finir, dans la deuxi\u00e8me zone\u00a0:</p> <ul> <li> <p>le profil d'inspection\u00a0: il est possible de choisir un profil      d\u00e9fini au pr\u00e9alable</p> </li> <li> <p>Politique de filtrage SSL : il est possible de chosir une      politique de filtrage pr\u00e9alablement d\u00e9finie (ou une de celle par      d\u00e9faut). Dans le cas o\u00f9 aucune politique de filtrage n'est      configur\u00e9e, l'action D\u00e9chiffrer sera appliqu\u00e9e par d\u00e9faut pour      tous les serveurs.</p> </li> </ul> </li> <li> <p>Vous pouvez \u00e9galement activer l'Antivirus ou l'Antispam et     s\u00e9lectionner des politiques de filtrage URL, SMTP, FTP ou SSL     (v\u00e9rification du champ CN du certificat pr\u00e9sent\u00e9).</p> </li> </ul> <p>Afin d'Inspecter le trafic d\u00e9chiffr\u00e9 via la seconde zone de la fen\u00eatre de l'assistant, vous pourrez d\u00e9finir la configuration du Profil d'Inspection, en choisissant l'une de celles que vous avez d\u00e9finies au pr\u00e9alable ou laisser en mode \u00ab Auto \u00bb. Ce mode automatique appliquera l'inspection relative \u00e0 l'origine du trafic.</p> <p>L'assistant cr\u00e9e deux r\u00e8gles de filtrage :</p> <p></p> <p>1. La premi\u00e8re r\u00e8gle est utilis\u00e9e pour intercepter les flux provenant du r\u00e9seau interne \u00e0 destination d'internet sur le groupe de port ssl_srv. Ces flux sont translat\u00e9s \u00e0 destination du proxy SSL qui \u00e9coute sur 127.0.0.1:8084. Cette r\u00e8gle applique l'action d\u00e9chiffrer et le filtrage SSL.</p> <p>2. La deuxi\u00e8me r\u00e8gle autorise les flux provenant du r\u00e9seau interne et sortant du proxy SSL (Via SSL proxy) \u00e0 destination d'Internet. Les protections applicatives (Filtrage URL, Antivirus, antispam, etc.) doivent \u00eatre activ\u00e9es sur cette r\u00e8gle.</p>"},{"location":"documentation/Stormshield/fiche08_filtrage_applicatifSNS/#methode-2-creation-des-deux-regles","title":"M\u00e9thode 2\u00a0: cr\u00e9ation des deux r\u00e8gles","text":"<ul> <li>Cliquer Nouvelle r\u00e8gle / r\u00e8gle simple</li> </ul> <p>La suite est classique jusqu'\u00e0 inspection\u00a0:</p> <p></p> <p>On obtient la r\u00e8gle\u00a0:</p> <p></p> <ul> <li>Cliquer Nouvelle r\u00e8gle / r\u00e8gle simple (ou modifier une r\u00e8gle     existante)</li> </ul> <p></p> <p></p> <p>Installation du certificat racine dans les navigateurs</p> <p>Une fois le proxy SSL activ\u00e9, le client qui tente de se connecter \u00e0 un site HTTPS d\u00e9chiffr\u00e9, voit une alerte s'afficher dans le navigateur pour l'informer que le certificat re\u00e7u n'est pas sign\u00e9 par une autorit\u00e9 connue. Cette alerte s'explique par le fait que le proxy SSL envoie un certificat usurp\u00e9 sign\u00e9 par une autorit\u00e9 (CA) non publique.</p> <p></p> <p></p> <p>A lire attentivement</p> <p>Pour \u00e9viter l'affichage de cette alerte, il faut installer le certificat de l'autorit\u00e9 de certification racine (CA) utilis\u00e9e par le proxy SSL dans le navigateur (pour Firefox) ou dans le magasin de certificats du syst\u00e8me d'exploitation (pour Internet Explorer, Edge et Chrome) et la d\u00e9clarer comme une autorit\u00e9 racine de confiance.</p> <p>Plusieurs m\u00e9thodes pour r\u00e9cup\u00e9rer le certificat de le CA utilis\u00e9e par le proxy SSL, dont\u00a0:</p> <ul> <li>R\u00e9cup\u00e9rer le certificat de la CA directement depuis le     navigateur quand le message d'alerte s'affiche (ou en cliquant sur     Erreur de certificat, puis Voir le certificat, mettez la CA racine     en surbrillance, et cliquez sur Exporter vers un fichier.</li> <li>Ou r\u00e9cup\u00e9rer le certificat de la CA via l'interface web du firewall,     dans le menu CONFIGURATION \u21d2 OBJETS \u21d2 CERTIFICATS ET PKI</li> </ul> <p></p> <p>Puis</p> <ul> <li>Sur Firefox, suivre la proc\u00e9dure ci-dessous :</li> </ul> <p>1. Taper about:preferences#privacy dans la barre de recherche, puis cliquez sur le bouton Afficher les certificats en bas de page,</p> <p>2. Aller dans l'onglet Autorit\u00e9s et cliquez sur le bouton Importer,</p> <p>3. Choisir le fichier de la CA racine,</p> <p>4. Dans la fen\u00eatre T\u00e9l\u00e9chargement de certificats, cocher la case Confirmer cette AC pour identifier des sites web, puis cliquez sur le bouton OK.</p> <p>5. V\u00e9rifier que l'import est effectif (le classement dans Firefox est effectu\u00e9 par le nom d'organisation d\u00e9crit dans le certificat).</p> <p>Sur Windows, le certificat est ajout\u00e9 au magasin de certificats du syst\u00e8me d'exploitation, utilis\u00e9 par les navigateurs Edge et Chrome (et Internet Explorer).</p> <ul> <li>Suivre la proc\u00e9dure ci-dessous :</li> </ul> <p>1. Cliquer droit sur le certificat \u00e0 installer et choisissez l'option Installer le certificat,</p> <p>2. Dans l'assista\udbc0\udd76t, choisir le magasin pour l'Utilisateur actuel,</p> <p>3. S\u00e9lectionner le magasin de certificats Autorit\u00e9s de certification racines de confiance.</p> <p>Information utile</p> <p>Dans un domaine Active Directory, il est plus simple d'automatiser le d\u00e9ploiement du certificat de la CA par l'utilisation des strat\u00e9gies de groupe (GPO).</p> <ul> <li>Le magasin de certificats de Windows est accessible par le menu D\u00e9marrer, Ex\u00e9cuter, tapez certmgr.msc.</li> </ul>"},{"location":"documentation/Stormshield/fiche08_filtrage_applicatifSNS/#documents","title":"Documents","text":""},{"location":"documentation/Stormshield/fiche08_filtrage_applicatifSNS/#document-1-les-elements-de-configuration-par-defaut","title":"Document 1\u00a0: Les \u00e9l\u00e9ments de configuration par d\u00e9faut","text":""},{"location":"documentation/Stormshield/fiche08_filtrage_applicatifSNS/#configuration-du-proxy-ssl","title":"Configuration du proxy SSL","text":"<p>La configuration du proxy SSL s'effectue dans le menu CONFIGURATION \u21d2 PROTECTION APPLICATIVE \u21d2 Protocoles \u21d2 SSL \u21d2 Profil ssl_01 \u21d2 onglet PROXY</p> <p></p> <p>L'encadr\u00e9 Inspection de contenu permet de d\u00e9finir l'action (d\u00e9l\u00e9guer \u00e0 l'utilisateur, bloquer ou continuer l'analyse) qui doit \u00eatre appliqu\u00e9e par le proxy dans le cas o\u00f9 le certificat pr\u00e9sent\u00e9 par le serveur distant est\u00a0:</p> <p></p> <ul> <li>un certificat auto-sign\u00e9\u00a0;</li> <li>un certificat non valide\u00a0;</li> <li>un certificat sign\u00e9 par une autorit\u00e9 inconnue\u00a0;</li> <li>un certificat avec un type inconnu ou non conforme\u00a0;</li> <li>un certificat avec un nom CN incorrect\u00a0;</li> <li>un certificat dont le CN et les noms alternatifs ne correspondent     pas au FQDN du serveur (SNI).</li> </ul> <p>L'option Autoriser les adresses IP dans les noms de domaine SSL permet d'acc\u00e9der \u00e0 un site en utilisant son adresse IP \u00e0 la place de son nom FQDN.</p> <p>L'encadr\u00e9 Support contient deux options pour d\u00e9finir l'action \u00e0 appliquer (Bloquer ou Passer sans d\u00e9chiffrer) dans le cas o\u00f9 le d\u00e9chiffrement \u00e9choue et dans le cas o\u00f9 le certificat ne peut \u00eatre classifi\u00e9 dans les cat\u00e9gories de la base URL (base embarqu\u00e9e ou Extended Web Control).</p> <p>Information utile</p> <p>Dans le cas o\u00f9 l'acc\u00e8s \u00e0 un site est bloqu\u00e9 par le proxy SSL \u00e0 cause d'un des contr\u00f4les ci-dessus, l'utilisateur voit sur son navigateur un message indiquant la raison du blocage.</p> <p>Cette configuration par d\u00e9faut peut convenir dans la majorit\u00e9 des cas.</p>"},{"location":"documentation/Stormshield/fiche08_filtrage_applicatifSNS/#gestion-des-certificats-des-autorites-publiques","title":"Gestion des certificats des autorit\u00e9s publiques","text":"<p>Lorsque le proxy SSL re\u00e7oit le certificat du serveur distant, il v\u00e9rifie s'il est sign\u00e9 par une autorit\u00e9 de confiance publique ou priv\u00e9e. Les autorit\u00e9s de confiance publiques sont pr\u00e9configur\u00e9es et elles sont mises \u00e0 jour automatiquement par le module Active Update.</p> <p>Elles sont accessibles depuis le menu CONFIGURATION \u21d2 PROTECTION APPLICATIVE \u21d2 Protocoles \u21d2 SSL \u21d2 Acc\u00e9der \u00e0 la configuration globale \u21d2 AUTORIT\u00c9S DE CERTIFICATION PUBLIQUES. L'interface permet d'activer/d\u00e9sactiver une autorit\u00e9 en cas de besoin.</p> <p></p>"},{"location":"documentation/Stormshield/fiche08_filtrage_applicatifSNS/#configuration-de-lautorite-signataire-des-certificats-usurpes","title":"Configuration de l'autorit\u00e9 signataire des certificats usurp\u00e9s","text":"<p>Par d\u00e9faut, le proxy SSL signe les certificats usurp\u00e9s avec l'autorit\u00e9 SSL proxy default authority d\u00e9j\u00e0 pr\u00e9sente sur le firewall. La modification de cette autorit\u00e9 s'effectuedans le menu CONFIGURATION \u21d2 PROTECTION APPLICATIVE \u21d2 Protocoles \u21d2 SSL \u21d2 Acc\u00e9der \u00e0 la configuration globale \u21d2 onglet PROXY.</p> <p>Il suffit de s\u00e9lectionner la nouvelle autorit\u00e9 dans C.A (signe les certificats) et son mot de passe dans Mot de passe de l\\'autorit\u00e9.</p> <p>Information importante</p> <p> Si vous modifiez le CA par d\u00e9faut, veillez \u00e0 sauvegarder son mot de passe dans le cas d'une r\u00e9utilisation future. Le mot de passe peut \u00eatre affich\u00e9 en clair en cliquant sur l'ic\u00f4ne repr\u00e9sentant une cl\u00e9.</p> <p>Il est \u00e9galement possible d'ajouter une autorit\u00e9 priv\u00e9e (non publique) de confiance via le menu CONFIGURATION \u21d2 PROTECTION APPLICATIVE \u21d2 Protocoles \u21d2 SSL \u21d2 Acc\u00e9der \u00e0 la configuration globale \u21d2 AUTORIT\u00c9S DE CERTIFICATION PERSONNALIS\u00c9ES. Dans ce cas, vous faites confiance \u00e0 tous les certificats sign\u00e9s par cette autorit\u00e9.</p> <p>Ajouter un certificat serveur se r\u00e9alise via le menu CONFIGURATION \u21d2 PROTECTION APPLICATIVE \u21d2 Protocoles \u21d2 SSL \u21d2 Acc\u00e9der \u00e0 la configuration globale \u21d2 CERTIFICATS DE CONFIANCE.</p>"},{"location":"documentation/Stormshield/fiche08_filtrage_applicatifSNS/#document-2-les-etapes-du-filtrage-ssl-avec-dechiffrement","title":"Document 2\u00a0: Les \u00e9tapes du filtrage SSL AVEC d\u00e9chiffrement","text":"<p>Pour pouvoir analyser les donn\u00e9es chiffr\u00e9es par un tunnel TLS, les firewalls SNS utilisent le proxy SSL qui est positionn\u00e9 comme \u00ab homme du milieu (man in the middle) \u00bb entre le client et le serveur durant l'ouverture de la session TLS. La figure ci-dessus illustre les diff\u00e9rentes \u00e9tapes de l'ouverture d'une session TLS pour une connexion HTTPS au travers du proxy SSL.</p>"},{"location":"documentation/Stormshield/fiche08_filtrage_applicatifSNS/#interception-de-la-connexion-par-le-proxy-ssl","title":"Interception de la connexion par le proxy SSL :","text":"<p>La connexion du client sur le port TCP/443 est translat\u00e9e vers le proxy SSL qui \u00e9coute sur 127.0.0.2:8084. Le proxy SSL commence par parcourir un cache contenant une liste de serveurs identifi\u00e9s par le trio [IP, port, SNI] d\u00e9j\u00e0 visit\u00e9s. Ces serveurs peuvent avoir deux \u00e9tats\u00a0:</p> <ul> <li> <p>Bloquer\u00a0: cet \u00e9tat est d\u00fb au fait que le serveur est bloqu\u00e9     par la politique de filtrage SSL avec l'action bloquer sans     d\u00e9chiffrer ou bien le serveur a pr\u00e9sent\u00e9 un certificat qui n'a pas     pu \u00eatre valid\u00e9 par le pare-feu. Dans ce cas, le proxy SSL continue     l'ouverture de la session TLS avec le client pour lui envoyer un     message de blocage. Aucune connexion ne sera initi\u00e9e avec le     serveur.</p> </li> <li> <p>Passer sans d\u00e9chiffrer\u00a0: cet \u00e9tat est engendr\u00e9 par l'action     passer sans d\u00e9chiffrer appliqu\u00e9e \u00e0 ce serveur par le filtrage SSL.     Dans ce cas, le proxy SSL initie une connexion TCP avec le serveur     pour renvoyer les commandes TLS du client.</p> </li> <li> <p>Ouverture d'une nouvelle session TLS par le proxy SSL \u00e0     destination du serveur\u00a0:</p> </li> </ul> <p>Dans le cas o\u00f9 aucune entr\u00e9e n'est trouv\u00e9e dans le cache pour ce site, \u00e0 la r\u00e9ception du message client Hello qui contient le nom du serveur SNI, le proxy SSL entame une nouvelle connexion TCP et une nouvelle session TLS \u00e0 destination du serveur.</p> <ol> <li>V\u00e9rification du certificat serveur\u00a0:</li> </ol> <p>\u00c0 cette \u00e9tape, le proxy analyse le certificat envoy\u00e9 par le serveur. Il mettra fin \u00e0 la connexion dans les cas suivants\u00a0:</p> <ul> <li> <p>Le serveur ne fournit pas d'informations SSL,</p> </li> <li> <p>Le certificat est auto-sign\u00e9 (ce choix est param\u00e9trable),</p> </li> <li> <p>Le certificat du serveur n'est pas sign\u00e9 par une autorit\u00e9 de     certification de confiance et il n'est pas explicitement d\u00e9clar\u00e9     en exception (ce choix est param\u00e9trable),</p> </li> <li> <p>Le certificat du serveur a expir\u00e9 (ce choix est param\u00e9trable),</p> </li> <li> <p>Le certificat du serveur est r\u00e9voqu\u00e9 (seulement pour une CA \u00ab     custom \u00bb pour laquelle la CRL est accessible),</p> </li> <li> <p>Le serveur demande une authentification,</p> </li> <li> <p>Le SNI ne correspondant pas au CN du certificat ni \u00e0 aucun des     noms alternatifs</p> </li> </ul> <p>Lorsque le certificat serveur n'est pas conforme, l'acc\u00e8s au site est bloqu\u00e9.</p>"},{"location":"documentation/Stormshield/fiche08_filtrage_applicatifSNS/#application-du-filtrage-ssl","title":"Application du filtrage SSL :","text":"<p>Apr\u00e8s la validation du certificat, le SNI est confront\u00e9 aux r\u00e8gles de filtrage SSL pour d\u00e9terminer l'action \u00e0 appliquer au serveur\u00a0:</p> <p>D\u00e9chiffrer, Bloquer sans d\u00e9chiffrer ou Passer sans d\u00e9chiffrer. Si c'est cette derni\u00e8re qui est appliqu\u00e9e, le proxy SSL ferme la connexion TCP avec le serveur une fois la session TLS \u00e9tablie. Puis il ouvre une nouvelle connexion TCP dans laquelle, il renverra les commandes TLS du client.</p> <ul> <li>\u00c9tablissement de la session TLS [Firewall -- Serveur]\u00a0:</li> </ul> <p>Dans le cas o\u00f9 l'action D\u00e9chiffrer est appliqu\u00e9e, le proxy SSL finalise l'ouverture de la session TLS avec le serveur. \u00c0 ce stade toutes les communications entre le pare-feu et le serveur sont chiffr\u00e9es par la cl\u00e9 K1.</p> <ul> <li>G\u00e9n\u00e9ration d'un certificat usurp\u00e9 (Fake Certificate) :</li> </ul> <p>Si l'action \u00e0 appliquer est D\u00e9chiffrer ou Bloquer sans d\u00e9chiffrer, le proxy g\u00e9n\u00e8re dynamiquement un certificat qui pr\u00e9sente le CN du certificat du serveur distant ainsi que ses noms alternatifs. Les principales diff\u00e9rences dans ce certificat sont les informations de l'\u00e9metteur et la signature effectu\u00e9e par l'autorit\u00e9 d\u00e9di\u00e9e au proxy SSL.</p> <ul> <li>\u00c9tablissement de la session TLS [Firewall -- Client] :</li> </ul> <p>Le proxy SSL finalise l'\u00e9tablissement de la session TLS initi\u00e9e par le client en lui pr\u00e9sentant le certificat usurp\u00e9. Le client effectue une v\u00e9rification du certificat. Dans le cas o\u00f9 le certificat de l'autorit\u00e9 signataire n'a pas \u00e9t\u00e9 pr\u00e9alablement install\u00e9, dans le navigateur (pour Firefox) ou dans le syst\u00e8me (pour Internet Explorer, Edge et Chrome), et d\u00e9clar\u00e9 comme une autorit\u00e9 de confiance, un message d'erreur s'affiche pour signaler au client que l'autorit\u00e9 signataire n'est pas connue. Toutes les communications entre le client et le firewall sont chiffr\u00e9es avec la cl\u00e9 K2.</p> <p>Apr\u00e8s l'\u00e9tape 7, le trafic est s\u00e9curis\u00e9 par la session TLS 1 entre le client et le firewall et par la session TLS 2 entre le firewall et le serveur. Ceci permet au firewall d'appliquer les protections applicatives sur le trafic qui transite en clair entre les deux sessions TLS.</p>"},{"location":"documentation/Stormshield/fiche09_IDS_IPS/","title":"Fiche 09 -- Pr\u00e9vention d'intrusion IDS/IPS","text":""},{"location":"documentation/Stormshield/fiche09_IDS_IPS/#definition-rapide-des-systemes-ids-et-ips","title":"D\u00e9finition rapide des syst\u00e8mes IDS et IPS","text":""},{"location":"documentation/Stormshield/fiche09_IDS_IPS/#ids-intrusion-detection-system","title":"IDS (Intrusion Detection System)","text":"<p>Un IDS est un syst\u00e8me de d\u00e9tection d'intrusion qui surveille le r\u00e9seau ou les syst\u00e8mes pour d\u00e9tecter des activit\u00e9s malveillantes ou non autoris\u00e9es. Il analyse le trafic r\u00e9seau ou les logs des syst\u00e8mes et alerte les administrateurs lorsqu'une menace potentielle est identifi\u00e9e. L'IDS est passif et ne bloque pas les attaques, mais fournit des informations pr\u00e9cieuses pour la r\u00e9ponse aux incidents.</p>"},{"location":"documentation/Stormshield/fiche09_IDS_IPS/#ips-intrusion-prevention-system","title":"IPS (Intrusion Prevention System)","text":"<p>Un IPS est un syst\u00e8me de pr\u00e9vention des intrusions qui surveille \u00e9galement le r\u00e9seau pour d\u00e9tecter des activit\u00e9s malveillantes, mais en plus, il prend des mesures proactives pour emp\u00eacher ces menaces. Lorsqu'une activit\u00e9 suspecte est d\u00e9tect\u00e9e, l'IPS peut bloquer le trafic ou interrompre la connexion afin de pr\u00e9venir des dommages potentiels. L'IPS est consid\u00e9r\u00e9 comme actif, car il prot\u00e8ge activement le r\u00e9seau contre les intrusions.</p>"},{"location":"documentation/Stormshield/fiche09_IDS_IPS/#presentation-generale","title":"Pr\u00e9sentation g\u00e9n\u00e9rale","text":"<p>Les \u00e9quipements Stormshield Network\u00a0Security sont \u00e9quip\u00e9s nativement d'un module de pr\u00e9vention d'intrusion nomm\u00e9 ASQ (Active Security Qualification). Chaque paquet re\u00e7u par le pare-feu SNS sera soumis \u00e0 un ensemble d'analyses \u00e0 commencer par la v\u00e9rification du protocole IP. Le r\u00f4le principal de l'ASQ est de s'assurer de la conformit\u00e9 du paquet par rapport aux protocoles utilis\u00e9s de la couche IP jusqu'\u00e0 la couche applicative (gr\u00e2ce aux plugins) et aux signatures contextuelles (ou Patterns). C'est \u00e9galement l'ASQ qui est en charge de filtrer les flux et d'appliquer une op\u00e9ration de NAT si n\u00e9cessaire.</p> <p>Int\u00e9gr\u00e9 \u00e0 la pile r\u00e9seau du syst\u00e8me d'exploitation FreeBSD, le moteur de pr\u00e9vention d'intrusion ASQ dispose d'un acc\u00e8s privil\u00e9gi\u00e9 aux ressources mat\u00e9rielles (CPU, m\u00e9moire et carte r\u00e9seau).</p> <p>Ce syst\u00e8me de pr\u00e9vention d'intrusion assure le filtrage des flux ainsi que leur analyse : d\u00e8s les couches de transport et jusqu'aux couches applicatives, il applique des contr\u00f4les g\u00e9n\u00e9riques de conformit\u00e9, ainsi que des contr\u00f4les cibl\u00e9s et comportementaux. Les op\u00e9rations de NAT ainsi que certaines op\u00e9rations de routage sp\u00e9cifique sont \u00e9galement prises en charge par ce moteur.</p> <p>Ces analyses sont appliqu\u00e9es directement sur les connexions cherchant \u00e0 traverser la pile r\u00e9seau du syst\u00e8me.</p> <p></p> <p>Le syst\u00e8me de pr\u00e9vention d'intrusion ou IPS (Intrusion Prevention System) d\u00e9tecte et bloque les tentatives d'attaques des applicatifs gr\u00e2ce \u00e0 des analyses contextuelles et comportementales compl\u00e9t\u00e9es par une identification par signatures. Cette association pr\u00e9sente deux b\u00e9n\u00e9fices majeurs\u00a0:</p> <ul> <li>il permet de r\u00e9aliser un traitement pr\u00e9ventif sur toutes les couches     de communication (du r\u00e9seau \u00e0 l'application) fournissant ainsi une     r\u00e9elle protection 0-day\u00a0;</li> <li>l'usage des contextes applicatifs limite le nombre de signatures \u00e0     examiner et r\u00e9duit ainsi les risques de faux positifs tout en     optimisant les temps de traitements pour procurer des performances     optimales.</li> </ul> <p>Les signatures utilis\u00e9es par le moteur de pr\u00e9vention d'intrusion SNS sont construites pour d\u00e9tecter des attaques identifiables mais \u00e9galement leurs variantes potentielles. \u00c0 titre d'exemple, la signature contextuelle sur une injection SQL par une commande SELECT (http:url:decoded:95) permet de contrer plus de 1 540 variantes d'attaques. En plus de maintenir un espace de stockage contenu, cette technique permet d'optimiser les temps de traitement et propose une protection contre de futures attaques bas\u00e9es sur les m\u00eames principes.</p> <p>La mise \u00e0 jour des bases de signatures du moteur de pr\u00e9vention Stormshield Network Security est assur\u00e9e ind\u00e9pendamment de la mise \u00e0 jour du firmware pour garantir une actualisation p\u00e9riodique et automatique afin de rester constamment prot\u00e9g\u00e9 contre les nouvelles attaques.</p> <p>Cette fonctionnalit\u00e9 de mise \u00e0 jour automatique se nomme \u00ab\u00a0Active Update\u00a0\u00bb ; elle permet \u00e9galement d'ajouter de nouveaux contextes pour int\u00e9grer de nouvelles cat\u00e9gories de signatures contextuelles.</p>"},{"location":"documentation/Stormshield/fiche09_IDS_IPS/#les-differents-types-danalyses","title":"Les diff\u00e9rents types d'analyses","text":"<p>Au-del\u00e0 du simple classement [niveau r\u00e9seau][niveau applicatif], un pare-feu SNS prot\u00e8ge le r\u00e9seau selon trois familles d'analyses\u00a0:</p> <ul> <li>l'analyse protocolaire\u00a0: elle assure la conformit\u00e9 des flux     r\u00e9seau vis-\u00e0-vis des standards de communication (IP, TCP, UDP, etc.)     ainsi que la conformit\u00e9 aux protocoles applicatifs (HTTP, FTP, etc.)     gr\u00e2ce aux contr\u00f4les appliqu\u00e9s par les contextes applicatifs,</li> <li>l'analyse statistique\u00a0: bas\u00e9e sur des \u00e9tudes statistiques du     trafic transitant par le pare-feu, cette analyse d\u00e9tecte des     comportements assimilables \u00e0 du scan de ports, \u00e0 du SYN flooding, ou     encore \u00e0 des tentatives de DoS (Denial of Service) par maintien de     multiples connexions annon\u00e7ant des petites fen\u00eatres (SockStress),</li> <li>l'analyse par signatures contextuelles\u00a0: elle vient compl\u00e9ter     les contr\u00f4les de conformit\u00e9 sur le trafic. Cette analyse permet de     se prot\u00e9ger de tentatives d'attaques visant sp\u00e9cifiquement un     protocole et une impl\u00e9mentation cliente ou serveur, mais sans     toutefois recourir \u00e0 une inconformit\u00e9 au standard de communication.     Elle s'appuie sur des bases de signatures construites par     Stormshield, maintenues\u00a0quotidiennement et mises \u00e0 disposition sur     les serveurs Active Update.</li> </ul>"},{"location":"documentation/Stormshield/fiche09_IDS_IPS/#les-niveaux-dinspection-de-securite","title":"Les niveaux d'inspection de s\u00e9curit\u00e9","text":"<p>Chaque paquet re\u00e7u par le pare-feu SNS est soumis \u00e0 la politique de filtrage.</p> <p>Info</p> <p>Par d\u00e9faut, l'analyse IPS (Intrusion Prevention System\u00a0: syst\u00e8me de pr\u00e9vention d'intrusion) est appliqu\u00e9e, ce qui signifie que le pare-feu SNS est capable de d\u00e9tecter une anomalie et de bloquer le paquet correspondant.</p> <p>D'autres niveaux d'inspections peuvent \u00eatre utilis\u00e9s, \u00e0 des fins de tests ou par n\u00e9cessit\u00e9\u00a0: par exemple si on contacte un serveur ne respectant pas la RFC des protocoles qu'il g\u00e8re.</p> <p>Ces niveaux sont \u00e0 s\u00e9lectionner dans la colonne Inspection de s\u00e9curit\u00e9 de la r\u00e8gle de filtrage concern\u00e9e.</p> <p></p> <ul> <li> <p>IPS : D\u00e9tecter et bloquer (choix par d\u00e9faut).</p> </li> <li> <p>L'ASQ va soumettre le paquet \u00e0 l'ensemble des couches qu'il est capable d'analyser et le bloquer en cas d'anomalie.</p> </li> <li> <p>IDS : D\u00e9tecter. L'ASQ effectue une analyse similaire \u00e0 l'IPS sauf que le paquet est toujours autoris\u00e9. C'est un profil permettant de faire un      audit rapide pour une r\u00e8gle de filtrage donn\u00e9e.</p> </li> <li> <p>Pare-feu : ne pas inspecter. L'ASQ ne va effectuer que tr\u00e8s peu d'analyses sur le paquet re\u00e7u. Il se comporte comme un simple routeur filtrant.</p> </li> </ul> <p>L'ASQ est compos\u00e9 de 10 configurations (\u00e9galement nomm\u00e9es profils IPS). Chacune de ces configuration peut \u00eatre \u00e9dit\u00e9e en fonction des besoins de l'administrateur.</p>"},{"location":"documentation/Stormshield/fiche09_IDS_IPS/#configuration-des-profils-dinspection","title":"Configuration des profils d'inspection","text":"<p>La configuration par d\u00e9faut, comme indiqu\u00e9 dans le menu Configuration \u21d2 Protection applicative \u21d2 Profils d'inspection, applique les profils IPS_00 et IPS_01 respectivement aux connexions entrantes (paquet dont l'adresse IP source ne fait pas partie d'un r\u00e9seau prot\u00e9g\u00e9) et aux connexions sortantes (paquet dont l'adresse IP source fait partie d'un r\u00e9seau prot\u00e9g\u00e9).</p> <p>Si des flux sains d\u00e9clenchent des alarmes, il sera s\u00fbrement n\u00e9cessaire de modifier les param\u00e8tres de l'ASQ pour ne pas bloquer la production. Dans ce cas, les modifications doivent \u00eatre faites au plus sp\u00e9cifique. De pr\u00e9f\u00e9rence dans un profil d\u00e9di\u00e9 qui sera appliqu\u00e9 sur les r\u00e8gles identifiant pr\u00e9cis\u00e9ment le trafic concern\u00e9.</p> <p>Il est alors possible, dans la table de filtrage, de forcer l'utilisation d'un profil ASQ sp\u00e9cifique depuis la colonne Inspection de s\u00e9curit\u00e9.</p> <p>Par d\u00e9faut, l'IPS est actif sur toutes les r\u00e8gles de filtrage en mode de d\u00e9tection automatique du protocole. Afin de mieux inspecter les flux, il est recommand\u00e9 de qualifier manuellement le type de protocole si le port utilis\u00e9 n'est pas standard. L'IPS risquerait de ne pas d\u00e9tecter correctement l'application.</p> <ul> <li>Les profils sont configurables et administrables depuis les menus     Protocoles et Applications et protections sous Configuration     \u21d2 Protection applicative.</li> </ul> <p></p> <p>Par d\u00e9faut, la liste des \u00e9v\u00e8nements est affich\u00e9e en vue par profil d'inspection. Pour tous les \u00e9v\u00e8nements, une action et un niveau d'alerte sont pr\u00e9-param\u00e9tr\u00e9s\u00a0:</p> <ul> <li> <p>Action</p> <ul> <li>Autoriser : le moteur de pr\u00e9vention d'intrusion laisse     passer le paquet correspondant \u00e0 l'alarme\u00a0;</li> <li>Interdire : le moteur de pr\u00e9vention d'intrusion bloque le     paquet correspondant \u00e0 l'alarme.</li> </ul> </li> <li> <p>Niveau</p> <ul> <li>Majeur : le moteur de pr\u00e9vention d'intrusion \u00e9mettra une     alarme majeure sur d\u00e9tection de l'\u00e9venement\u00a0;</li> <li>Mineur : le moteur de pr\u00e9vention d'intrusion \u00e9mettra une     alarme mineure sur d\u00e9tection de l'\u00e9venement\u00a0;</li> <li>Ignore : le moteur de pr\u00e9vention d'intrusion n'\u00e9mettra     aucune alarme sur d\u00e9tection de l'\u00e9venement. L'action d\u00e9finie     sera donc appliqu\u00e9e silencieusement.</li> </ul> </li> </ul> <p>Tri sur les trois cat\u00e9gories d'alarme</p> <p>Des boutons vous permettent d'effectuer un tri sur les alarmes du profil d'inspection. Les 3 cat\u00e9gories dans lesquelles ces alarmes sont r\u00e9parties sont Applications, Protections et Malwares. La s\u00e9lection s'effectue par les 3 boutons du m\u00eame nom\u00a0:</p> <ul> <li>Applications\u00a0: ce type d'alarme est lev\u00e9 par l'utilisation     d'applications courantes. Cette s\u00e9lection permet l'\u00e9laboration d'une     politique de s\u00e9curit\u00e9 applicative.</li> <li>Protections\u00a0: ces alarmes sont lev\u00e9es suite \u00e0 l'analyse effectu\u00e9e     par le moteur IPS : elles r\u00e9sultent du blocage d'attaques connues ou     d'utilisations anormales des protocoles conform\u00e9ment aux RFC.</li> <li>Malwares\u00a0: ces alarmes sont bas\u00e9es sur les signatures connues de     logiciels malveillants, reconnus par des types d'activit\u00e9 suspects.     Il est conseill\u00e9 d'examiner les machines \u00e0 l'origine de cette     cat\u00e9gorie d'alarmes.</li> </ul> <p>Filtrage sur mot cl\u00e9 dans la zone \u00ab\u00a0rechercher\u00a0\u00bb</p> <p>Il peut \u00eatre int\u00e9ressant de filtrer sur un mot cl\u00e9 (\u00e0 noter qu'au passage de la souris un texte explicatif concernant l\u00a0'\u00e9v\u00e8nement appara\u00eet)\u00a0:</p> <p></p> <p>Un bouton d'aide permet aussi d'avoir une explication (en fran\u00e7ais)\u00a0:</p> <p></p> <p></p> <p>Pr\u00e9s\u00e9lection</p> <p>Cette liste contient les alarmes g\u00e9n\u00e9r\u00e9es par un trafic relatif \u00e0 des familles d'applications. Vous pouvez effectuer un tri et n'afficher que les alarmes faisant partie d'un certain nombre de cat\u00e9gories (BYOD, Stockage en ligne, E-mail, Jeu, Communication, Multim\u00e9dia, Peer to peer, Acc\u00e8s \u00e0 distance, R\u00e9seaux sociaux, Web).</p> <p>Info</p> <p>Pour afficher les colonnes Signatures, Mod\u00e8le et Profil applicatif, cliquez sur la fl\u00e8che apparaissant au survol de l'intitul\u00e9 d'une colonne et cochez les cases correspondantes propos\u00e9es dans le menu Colonnes.</p>"},{"location":"documentation/Stormshield/fiche09_IDS_IPS/#mise-a-jour-des-signatures-contextuelles","title":"Mise \u00e0 jour des signatures contextuelles","text":"<p>Les signatures contextuelles sont nombreuses et peuvent \u00eatre mises \u00e0 jour quotidiennement. Les nouvelles signatures t\u00e9l\u00e9charg\u00e9es (signal\u00e9es par un drapeau bleu \u00ab\u00a0Nouveau\u00a0\u00bb) sont appliqu\u00e9es automatiquement (sans l'approbation de l'administrateur) aux flux analys\u00e9s avec l'action et le niveau d'alerte d\u00e9finis par d\u00e9faut.</p> <ul> <li>Se rendre dans le menu Protection applicative, Profils d'inspection,     zone nouvelles alarme. L'option Appliquer le mod\u00e8le par d\u00e9faut aux     nouvelles alarmes est coch\u00e9e \u21d2 celles-ci se mettront \u00e0 jour     automatiquement et seront livr\u00e9es avec la signature Stormshield     Network.</li> </ul> <p></p> <ul> <li>Si vous souhaitez les appliquer vous-m\u00eames, d\u00e9cocher la case et     d\u00e9finir les param\u00e8tres des champs suivants.</li> </ul> <p>Par ailleurs, suite \u00e0 l'examen des actions et niveaux d'alerte propos\u00e9s, l'administrateur peut approuver ces \u00e9v\u00e8nements pour en faire dispara\u00eetre le marqueur \u00ab\u00a0Nouveau\u00a0\u00bb. C'est alors l'action d\u00e9finie sur la ligne de l'alarme qui s'applique.</p> <p>Info</p> <p>Il est possible d'approuver une s\u00e9lection de signatures en une seule fois en utilisant le bouton \u00ab\u00a0approuver les nouvelles alarmes\u00a0\u00bb.</p>"},{"location":"documentation/Stormshield/fiche09_IDS_IPS/#appliquer-un-modele","title":"Appliquer un mod\u00e8le","text":"<p>Plusieurs mod\u00e8les permettent de configurer le profil des alarmes en param\u00e9trant leur action (Autoriser ou Interdire) et leur niveau (Ignorer, Mineur ou Majeur).</p> <p>Les mod\u00e8les BASSE, MOYENNE et HAUTE se diff\u00e9rencient essentiellement par l'action des alarmes de type Protections, comme les alarmes relatives aux r\u00e9seaux \\\"peer-to-peer\\\" ou aux messageries instantan\u00e9es.</p> <p>Le mod\u00e8le INTERNET d\u00e9sactive les alarmes pouvant g\u00eaner l'utilisation classique d'Internet, souvent due \u00e0 de mauvaises pratiques trop r\u00e9pandues pour \u00eatre interdites. Un exemple est l'alarme lev\u00e9e en cas d\\'URL contenant des caract\u00e8res non ASCII.</p> <p>Par d\u00e9faut, le profil (1) IPS_01 est bas\u00e9 sur le mod\u00e8le INTERNET (la plupart des alarmes sont configur\u00e9es avec l'action Autoriser, quand elles ne pr\u00e9sentent pas de danger pour le r\u00e9seau interne), \u00e9tant destin\u00e9 au trafic dont l\\'adresse IP source fait partie d\\'un r\u00e9seau prot\u00e9g\u00e9. Les autres profils (dont le trafic entrant) sont configur\u00e9s sur le mod\u00e8le MOYENNE qui assure un niveau de s\u00e9curit\u00e9 standard compromis entre s\u00e9curit\u00e9 et blocage excessif ; il est appliqu\u00e9 par d\u00e9faut au trafic entrant..</p> <p>Les deux autres mod\u00e8les sont\u00a0:</p> <ul> <li>Basse\u00a0: les alarmes les moins critiques sont configur\u00e9es avec     l'action Autoriser.</li> <li>Haute\u00a0: la majorit\u00e9 des alarmes sont configur\u00e9es avec l'action     Bloquer</li> </ul> <p>Chaque \u00e9v\u00e8nement d\u00e9tectable par la pr\u00e9vention d'intrusion est associ\u00e9 \u00e0 une alarme configurable.</p> <p> </p>"},{"location":"documentation/Stormshield/fiche09_IDS_IPS/#les-alarmes-globales","title":"Les alarmes globales","text":"<p>Il existe quelques \u00e9v\u00e8nements pour lesquels le param\u00e9trage est global \u00e0 tous les profils. Ce sont principalement des \u00e9v\u00e8nements d\u00e9tect\u00e9s avant l'\u00e9valuation des r\u00e8gles de filtrage. Or la s\u00e9lection d'un profil protocolaire ou applicatif s'effectue pendant le processus d'\u00e9valuation des r\u00e8gles de filtrage auxquelles sont associ\u00e9es les profils d'inspections. C'est, par exemple, le cas pour l'\u00e9v\u00e8nement \u00ab\u00a0Usurpation d'adresse IP\u00a0\u00bb dont la v\u00e9rification intervient bien avant l'examen du stateful et du filtrage.</p>"},{"location":"documentation/Stormshield/fiche09_IDS_IPS/#les-alarmes-non-configurables","title":"Les alarmes non configurables","text":"<p>La configuration des actions de certaines alarmes n'est pas possible. Il s'agit pour la plupart d'\u00e9v\u00e8nements particuliers qui sont li\u00e9s \u00e0 une information \u00e0 post\u00e9riori de d\u00e9tection d 'un \u00e9v\u00e8nement (scan de port), d'une information sur les m\u00e9canismes enclench\u00e9s pour la poursuite des analyses (d\u00e9synchronisation du trafic TCP) ou encore d'un \u00e9v\u00e8nement trop en marge des standards de communication pour permettre la poursuite des analyses (Attaque Xmas tree). Les alarmes non configurables sont des alarmes globales.</p> <p>**Ci-dessous, l'\u00e9v\u00e8nement pour un scan de port\u00a0: **</p> <p></p>"},{"location":"documentation/Stormshield/fiche09_IDS_IPS/#documents","title":"Documents","text":""},{"location":"documentation/Stormshield/fiche09_IDS_IPS/#document-1-les-analyses-de-securite","title":"Document 1\u00a0: Les analyses de s\u00e9curit\u00e9","text":"<p>Ce qui suit n'est qu'un r\u00e9sum\u00e9. Pour plus de d\u00e9tails, il est n\u00e9cessaire de se r\u00e9f\u00e9rer \u00e0 la documentation officielle du produit</p>"},{"location":"documentation/Stormshield/fiche09_IDS_IPS/#11-analyse-protocolaire-ip","title":"1.1 Analyse protocolaire IP","text":"<p>Le moteur de pr\u00e9vention d'intrusion Stormshield Network d\u00e9marre ses contr\u00f4les \u00e0 la couche r\u00e9seau IP :</p> <ul> <li> <p>Les analyses de conformit\u00e9 du protocole IP\u00a0: v\u00e9rifications du     num\u00e9ro de version du protocole IP et la conformit\u00e9 des options     positionn\u00e9es, v\u00e9rification de la taille annonc\u00e9es dans l'en-t\u00eate     IPv4 et de la taille effective de la charge, comparaison de la somme     de contr\u00f4le (checksum) annonc\u00e9e et la valeur de cette somme qui est     recalcul\u00e9e</p> </li> <li> <p>Contr\u00f4le de l\u00e9gitimit\u00e9 des sources (anti usurpation)\u00a0: Le     m\u00e9canisme de protection contre l'usurpation d'adresse     (anti-spoofing) permet de d\u00e9tecter une incoh\u00e9rence entre l'adresse     IP source du paquet re\u00e7u et l'interface r\u00e9seau sur laquelle il se     pr\u00e9sente.</p> </li> <li> <p>Mise en quarantaine de machines ou de connexions\u00a0: les entr\u00e9es     de la quarantaine (liste noire) permettent de bannir toute     communication, de mani\u00e8re bidirectionnelle, entre deux entit\u00e9s IP     (h\u00f4te avec h\u00f4te, h\u00f4te avec r\u00e9seau, r\u00e9seau avec r\u00e9seau et m\u00eame h\u00f4te     ou r\u00e9seau avec \u00ab\u00a0Any\u00a0\u00bb). On distingue les listes suivantes\u00a0:</p> <ul> <li>liste noire statique\u00a0: il est possible, en CLI, de cr\u00e9er des     entr\u00e9es statiques dans la liste de quarantaine pour bannir toute     communication traversante entre des entit\u00e9s IP \u00e0 d\u00e9finir par les     objets leur correspondant.</li> <li>Lliste blanche\u00a0: une liste blanche (WhiteList ou ByPass     ASQ), \u00e0 d\u00e9finir en CLI, permet de contourner les contr\u00f4les ASQ     pour toute communication entre les couples d'objets d\u00e9clar\u00e9s.</li> <li>liste noire dynamique\u00a0: le moteur de pr\u00e9vention d'intrusion     Stormshield Network Security permet de placer des machines en     quarantaine afin que leurs trafics soient bloqu\u00e9s.</li> </ul> <p>Depuis le menu de configuration des alarmes dans le module \u00ab Protection applicative \u00bb, il est possible d'ajouter une r\u00e9action suppl\u00e9mentaire sur r\u00e9alisation d'un \u00e9v\u00e8nement. Ainsi, toute machine d\u00e9clenchant cet \u00e9v\u00e8nement est imm\u00e9diatement plac\u00e9e en quarantaine pour la dur\u00e9e choisie.</p> </li> <li> <p>La fragmentation IP</p> </li> <li> <p>Les attaques par fragmentation IP</p> </li> </ul>"},{"location":"documentation/Stormshield/fiche09_IDS_IPS/#12-analyse-protocolaire-sur-la-couche-transport","title":"1.2 Analyse protocolaire sur la couche transport","text":""},{"location":"documentation/Stormshield/fiche09_IDS_IPS/#firewall-stateful","title":"Firewall stateful","text":"<p>La conservation de l'\u00e9tat des sessions permet de contr\u00f4ler leur conformit\u00e9 aux standards de communication au fil de leurs \u00e9volutions et pendant toute leur dur\u00e9e de vie. On parle de suivi \u00ab stateful \u00bb ou \u00ab plein \u00e9tat \u00bb. Les m\u00e9canismes et contr\u00f4les de suivi stateful permettent, non seulement, de g\u00e9rer automatiquement les paquets r\u00e9ponses \u00e0 destination de l'initiateur de la connexion, mais ils pr\u00e9viennent \u00e9galement les tentatives d'attaques par injection de paquets, en v\u00e9rifiant que le contenu de chaque paquet est coh\u00e9rent avec l'\u00e9tat de la session en cours.</p>"},{"location":"documentation/Stormshield/fiche09_IDS_IPS/#etat-des-connexions","title":"\u00c9tat des connexions","text":"<p>Le moteur de pr\u00e9vention d'intrusion Stormshield Network applique des contr\u00f4les particuliers aux diff\u00e9rentes \u00e9tapes d'\u00e9tablissement, de transport de donn\u00e9es et de cl\u00f4ture des connexions TCP.</p> <p>Les contr\u00f4les sur ICMP consistent, quant \u00e0 eux, principalement \u00e0 l'identification de session TCP/UDP en rapport avec les messages ICMP retourn\u00e9s. Les r\u00e9ponses ICMP (echo reply) sont \u00e9galement corr\u00e9l\u00e9es aux requ\u00eates (echo request) en attente conserv\u00e9es dans la table de stateful.</p> <p>Quoique bien plus basique, le protocole UDP est \u00e9galement trait\u00e9 par plusieurs \u00e9tats (open ou data) pour rendre compte d'un trafic unidirectionnel ou bidirectionnel, dans le cas d'un dialogue.</p> <p>Le checksum UDP (facultatif) est v\u00e9rifi\u00e9 lorsqu'il est positionn\u00e9.</p>"},{"location":"documentation/Stormshield/fiche09_IDS_IPS/#regles-de-filtrage","title":"R\u00e8gles de filtrage","text":"<p>Toute nouvelle connexion est \u00e9valu\u00e9e par le moteur de filtrage Stormshield Network.</p> <p>D\u00e8s qu'une r\u00e8gle passante de filtrage correspond \u00e0 la tentative de connexion, cette derni\u00e8re est autoris\u00e9e et le moteur de pr\u00e9vention d'intrusion cr\u00e9e un \u00e9tat permettant de d\u00e9marrer le suivi de la connexion. Toute connexion qui n'est pas explicitement autoris\u00e9e par une r\u00e8gle de filtrage sera bloqu\u00e9e implicitement sans qu''il ne soit besoin de terminer la politique de filtrage par une r\u00e8gle de blocage et, par d\u00e9faut, sans remont\u00e9e de log.</p>"},{"location":"documentation/Stormshield/fiche09_IDS_IPS/#profils-applicatifs","title":"Profils applicatifs","text":"<p>Chaque r\u00e8gle de filtrage est associ\u00e9e \u00e0 un profil d'inspection. Il est possible de choisir le profil d'inspection \u00e0 utiliser pour chaque r\u00e8gle tel que d\u00e9crit ci-dessous :</p> <ul> <li> <p>Lorsqu'aucun profil n'est s\u00e9lectionn\u00e9, ce sont les profils     d'inspection par d\u00e9faut qui sont utilis\u00e9s.</p> </li> <li> <ul> <li>Le profil ENTRANT par d\u00e9faut (00) s'appliquera aux connexions         provenant d'une adresse IP source non prot\u00e9g\u00e9e (ou non interne),</li> <li>Le profil SORTANT par d\u00e9faut (01) s'appliquera aux connexions     provenant d'une adresse IP source incluse dans les r\u00e9seaux     prot\u00e9g\u00e9s (r\u00e9seaux internes).</li> </ul> </li> <li> <p>S\u00e9lection d'un profil d'inspection particulier qui sera utilis\u00e9 pour     cette r\u00e8gle (il existe 8 profils d'inspection pouvant \u00eatre utilis\u00e9s     \u00e0 la place des profils par d\u00e9fautet dont les param\u00e8tres sont     personnalisables).</p> </li> <li> <p>S\u00e9lection du mode IDS pour lequel le trafic correspondant \u00e0 cette     r\u00e8gle sera inspect\u00e9 sans blocage mais \u00e9mettra des alarmes en cas de     trafic malveillant.</p> </li> <li>S\u00e9lection du mode Firewall pour s'appliquer aucun contr\u00f4le de     conformit\u00e9 et ne mettre en \u0153uvre qu'une gestion basique du suivi     d'\u00e9tat (gestion primaire d'ouverture et de fermeture de connexion.</li> </ul>"},{"location":"documentation/Stormshield/fiche09_IDS_IPS/#13-analyse-applicative-les-plugins-applicatifs","title":"1.3 Analyse applicative (les plugins applicatifs)","text":""},{"location":"documentation/Stormshield/fiche09_IDS_IPS/#la-caracterisation-des-flux-et-levasion-de-donnees","title":"La caract\u00e9risation des flux et l'\u00e9vasion de donn\u00e9es","text":"<p>D\u00e8s lors que l'\u00e9tablissement d'un flux a \u00e9t\u00e9 autoris\u00e9 par une r\u00e8gle de filtrage, son suivi par les m\u00e9canismes de stateful ne suffit pas \u00e0 garantir une s\u00e9curit\u00e9 compl\u00e8te et ne permet pas \u00e0 l'administrateur de se prononcer strictement sur les protocoles applicatifs permis.</p> <p>Il appara\u00eet clairement que le crit\u00e8re HTTP d\u00e9sign\u00e9 par un l'administrateur est traduit par TCP/80.</p> <p>Donc, mis \u00e0 part le protocole de transport et le num\u00e9ro de port, rien ne forcerait ici les flux applicatifs traversant cette r\u00e8gle \u00e0 se conformer au protocole HTTP.</p> <p>Il serait donc possible de faire passer dans ces connexions des flux tout \u00e0 fait diff\u00e9rents de HTTP ; ceci constituerait de l'\u00e9vasion de donn\u00e9es.</p> <p>Pour interdire ce ph\u00e9nom\u00e8ne, l'identification et l'analyse de la couche sup\u00e9rieure s'av\u00e8rent donc n\u00e9cessaires.</p> <p>Ces analyses compl\u00e9mentaires sont confi\u00e9es aux plugins que le moteur de pr\u00e9vention d'intrusion attache aux connexions afin de d\u00e9finir le contexte applicatif associ\u00e9.</p> <p>L'attachement des plugins d'inspection peut \u00eatre assur\u00e9 de diff\u00e9rentes mani\u00e8res :</p> <ul> <li> <p>Explicite:</p> <ul> <li>par implication d'un port par d\u00e9faut (exemple\u00a0: plugin d'analyse     associ\u00e9 au port 80)\u00a0;</li> <li>par s\u00e9lection du protocole applicatif (exemple\u00a0:     l'administrateur pr\u00e9cise le protocole http dans sa r\u00e8gle de     filtrage donc le plugin associ\u00e9 \u00e0 ce protocole sera activ\u00e9 m\u00eame     si le port choisi est autre que le port par d\u00e9faut\u00a0: 80).</li> </ul> </li> <li> <p>Implicite (d\u00e9tection automatique) : La d\u00e9tection du protocole     applicatif est rendue possible par une comparaison du contenu des     premiers paquets de donn\u00e9es \u00e9chang\u00e9s entre les correspondants avec     les syntaxes caract\u00e9ristiques des protocoles applicatifs connus par     les plugins.</p> </li> </ul> <p>D\u00e8s lors qu'un plugin applicatif est associ\u00e9 \u00e0 un flux, il va r\u00e9aliser une \u00e9tude approfondie principalement des donn\u00e9es protocolaires applicatives (aspect s\u00e9quentiel des dialogues, param\u00e8tres positionn\u00e9s dans les en-t\u00eates, phases d'authentification, commandes et codes de retour, formatage des contenus protocolaires, ...).</p>"},{"location":"documentation/Stormshield/fiche09_IDS_IPS/#14-analyse-des-signatures-contextuelles","title":"1.4 Analyse des signatures contextuelles","text":""},{"location":"documentation/Stormshield/fiche09_IDS_IPS/#detection-par-signature","title":"D\u00e9tection par signature","text":"<p>Le but premier des signatures contextuelles est de caract\u00e9riser des attaques ou des comportements d'attaques ne s'appuyant pas sur des inconformit\u00e9s protocolaires, mais sur des failles sp\u00e9cifiques d'impl\u00e9mentations logicielles. En restant conformes aux standards de communication, ces attaques ne semblent pas suspectes lors des analyses par les plugins. Il s'av\u00e8re donc n\u00e9cessaire de compl\u00e9ter les analyses protocolaires par une identification d'attaques ou de comportements d'attaques connues. En suppl\u00e9ment, puisque les contenus des champs analys\u00e9s peuvent r\u00e9v\u00e9ler les versions de logiciels utilis\u00e9s pour les communications, les signatures contextuelles offrent \u00e9galement la possibilit\u00e9 d'autoriser ou d'interdire l'utilisation de certains logiciels ou services ainsi identifi\u00e9s.</p> <p>Une signature contextuelle est constitu\u00e9e d'une ou plusieurs cha\u00eenes de caract\u00e8res dont des parties peuvent \u00eatre g\u00e9n\u00e9riques et qualifier un type d'attaque dans un contexte applicatif, et d'autres parties plus sp\u00e9cifiques qui visent \u00e0 identifier les \u00e9ventuelles diff\u00e9rentes variantes du type d'attaque qualifi\u00e9.</p> <p>La base des signatures contextuelles est aliment\u00e9e r\u00e9guli\u00e8rement et publi\u00e9e sur les serveurs d'Active Update pr\u00e9-renseign\u00e9s dans la configuration usine.</p>"},{"location":"documentation/Stormshield/fiche09_IDS_IPS/#document-2-analyse-des-logs","title":"Document 2\u00a0: Analyse des logs","text":"<p>Pour consulter les logs\u00a0:</p>"},{"location":"documentation/Stormshield/fiche09_IDS_IPS/#21-inspection-ips-intrusion-prevention-system-journalisation-et-alarmes","title":"2.1 - Inspection IPS (Intrusion Prevention System) : journalisation et alarmes","text":"<p>Le mode IPS est appliqu\u00e9 par d\u00e9faut.</p> <p>Il procure le niveau d'analyse le plus \u00e9lev\u00e9, ainsi que le meilleur niveau de d\u00e9tail des informations de logs pour les connexions, d\u00e8s lors qu'un suivi applicatif leur aura \u00e9t\u00e9 appliqu\u00e9.</p> <p>Outre les informations de base pour une connexion (source, destination et ports), les op\u00e9rations et les arguments pass\u00e9s dans l'applicatif sont \u00e9galement journalis\u00e9s, ainsi que les codes de retour lorsque le protocole en fait usage.</p> <p>Le nom et le num\u00e9ro de la r\u00e8gle de filtrage qui a autoris\u00e9 cette connexion, ainsi que le profil d'inspection appliqu\u00e9 sont \u00e9galement consign\u00e9s.</p> <p>Un \u00e9v\u00e8nement suspect subira un blocage et provoquera la lev\u00e9e d'une alarme qui, elle aussi, permettra d'identifier la r\u00e8gle de filtrage et le profil d'inspection qui \u00e9taient attach\u00e9s \u00e0 la connexion sur laquelle l'\u00e9v\u00e8nement s'est produit.</p>"},{"location":"documentation/Stormshield/fiche09_IDS_IPS/#22-inspection-ids-intrusion-detection-system-journalisation","title":"2.2 - Inspection IDS (Intrusion Detection System) : journalisation","text":"<p>Le mode d'inspection IDS est \u00e0 d\u00e9finir explicitement dans la r\u00e8gle de filtrage.</p> <p>Il procure le m\u00eame niveau initial d'analyse que le mode IPS, avec une tol\u00e9rance \u00e9quivalente au param\u00e9trage d'une action \u00ab autoriser \u00bb sur l'ensemble des \u00e9v\u00e8nements de type alarme.</p> <p>Ce mode est donc capable de d\u00e9grader les analyses pour laisser passer des \u00e9v\u00e8nements majeurs qui se produiraient sur la connexion. Il pourra ainsi d\u00e9tacher un plugin de suivi applicatif sur r\u00e9alisation d'un \u00e9v\u00e8nement sensible, mais \u00e9galement abandonner les contr\u00f4les sur les couches inf\u00e9rieures, lorsqu'une anomalie majeure se produit (un mauvais s\u00e9quen\u00e7age TCP par exemple).</p>"},{"location":"documentation/Stormshield/fiche09_IDS_IPS/#23-inspection-firewall","title":"2.3 - Inspection Firewall","text":"<p>Le mode d'inspection Firewall est \u00e0 d\u00e9finir explicitement dans la r\u00e8gle de filtrage.</p> <p>Apr\u00e8s acceptation du premier paquet de connexion par la r\u00e8gle de filtrage, il ne procure qu'un suivi basique :</p> <ul> <li>Cr\u00e9ation d'un \u00e9tat sur r\u00e9ception d'un premier paquet valide,</li> <li>Suivi de la volum\u00e9trie des donn\u00e9es \u00e9chang\u00e9es dans la connexion,</li> <li>D\u00e9tection de la cl\u00f4ture de connexion,</li> <li>Aucune lev\u00e9e d'alarme en cas d'\u00e9v\u00e8nement anormal.</li> </ul>"},{"location":"documentation/Stormshield/fiche10_utilisateurs_authentification_SNS/","title":"Fiche 10 -- Utilisateurs, authentification et portail captif","text":"<p>La fonction d'authentification du pare-feu permet \u00e0 l'utilisateur de s'identifier via un login et un mot de passe ou de mani\u00e8re totalement transparente (SSO / certificat). Pour cela, elle peut utiliser une base de donn\u00e9es LDAP (Lightweight Directory Access Protocol) et, \u00e9ventuellement, un certificat num\u00e9rique x509.</p> <p>Une fois l'authentification r\u00e9ussie, le login de l'utilisateur est associ\u00e9 \u00e0 la machine \u00e0 partir de laquelle celui-ci s'est identifi\u00e9 (cela est stock\u00e9 dans la table utilisateur de l\\'ASQ) et \u00e0 tous les paquets IP qui en proviennent, et ce pour la dur\u00e9e sp\u00e9cifi\u00e9e par l'utilisateur ou l'administrateur selon la m\u00e9thode utilis\u00e9e.</p> <p>L'objectif est d'accorder aux utilisateurs des droits d'acc\u00e8s sp\u00e9cifiques aux r\u00e9seaux et aux services (portail captif, VPN SSL,VPN IPsec, administration du firewall, etc.).</p> <p>Les \u00e9tapes de configuration sont les suivantes\u00a0:</p> <p></p> <p>1. Les annuaires stockent des informations de mani\u00e8re hi\u00e9rarchis\u00e9e dans une arborescence. La norme LDAP permet l'organisation des donn\u00e9es dans l'annuaire et fournit un protocole d'interrogation de l'annuaire (RFC 4510), la configuration sur un pare-feu consiste \u00e0 \u00e9tablir un lien vers un ou plusieurs annuaires.</p> <p>2. Les utilisateurs sont stock\u00e9s dans un annuaire et d\u00e9crits par des attributs (nom, pr\u00e9nom, identifiant, mot de passe, adresse e-mail, certificat, etc.) utilis\u00e9s par le pare-feu pour l'authentification.</p> <p>3. Les m\u00e9thodes d'authentification utilis\u00e9es permettent au pare-feu de configurer la fa\u00e7on de v\u00e9rifier l'identit\u00e9 des utilisateurs.</p> <p>4. La politique d'authentification permet d'accorder aux utilisateurs des droits d'acc\u00e8s aux r\u00e9seaux et services g\u00e9r\u00e9s par le pare-feu.</p> <p>5. Le portail captif peut avoir plusieurs usages\u00a0: authentifier des utilisateurs pour acc\u00e9der au r\u00e9seau, enr\u00f4ler de nouveaux utilisateurs, demander la cr\u00e9ation d'un certificat, t\u00e9l\u00e9charger le client VPN SSL et sa configuration, faire une demande de parrainage pour acc\u00e9der au r\u00e9seau, etc.</p> <p>6. La politique de s\u00e9curit\u00e9 contient les r\u00e8gles de filtrage n\u00e9cessaires pour que les utilisateurs inconnus soient redirig\u00e9s vers la solution d'authentification retenue (par exemple, via le portail captif).</p> <p>Info</p> <p>En fonction de la m\u00e9thode d'authentification retenue, certaines \u00e9tapes de configuration seront facultatives.</p>"},{"location":"documentation/Stormshield/fiche10_utilisateurs_authentification_SNS/#liaison-a-un-annuaire","title":"Liaison \u00e0 un annuaire","text":"<p>Les pare-feu supportent quatre types d'annuaire qui peuvent \u00eatre class\u00e9s en deux cat\u00e9gories.</p> <p>Ils peuvent supporter cinq annuaires simultan\u00e9ment : un LDAP interne et  quatre LDAP/AD externes, ou cinq LDAP/AD externes. Ce qui signifie qu'ils peuvent supporter en m\u00eame temps cinq domaines diff\u00e9rents.</p> <p>Un client LDAP int\u00e9gr\u00e9 au pare-feu permet de se connecter \u00e0 n'importe quel type d'annuaire (interne ou externe) en utilisant le protocole LDAP (ou LDAPS pour s\u00e9curiser les connexions avec les annuaires externes).</p> <p>Dans le cas d'un LDAP interne, l'annuaire et les utilisateurs sont automatiquement sauvegard\u00e9s/restaur\u00e9s avec la configuration du pare-feu.</p> <p>Ajout et configuration d'un annuaire</p> <ul> <li>Se rendre au menu CONFIGURATION \u21d2 UTILISATEURS \u21d2 Configuration des     annuaires</li> </ul> <p></p> <ul> <li>Choisir le type d'annuaire ou Ajouter un annuaire (si un annuaire a     d\u00e9j\u00e0 \u00e9t\u00e9 configur\u00e9)</li> </ul> <p>\u21d2 Un assistant de cr\u00e9ation se lance</p>"},{"location":"documentation/Stormshield/fiche10_utilisateurs_authentification_SNS/#la-configuration-des-annuaires-externes","title":"La configuration des annuaires externes","text":"<p>Type d'annuaire: (Microsoft Active Directory,LDAP et LDAP de type PosixAccount) est sensiblement identique</p> <p></p> <ul> <li> <p>Renseigner les param\u00e8tres du serveur \u00e0 contacter\u00a0:</p> <ul> <li>Nom du domaine\u00a0: le nom DNS du domaine,</li> <li>Serveur\u00a0: l'objet machine qui porte l\\'adresse IP du serveur qui h\u00e9berge l'annuaire,</li> <li>Port\u00a0: le port d'\u00e9coute de votre serveur LDAP</li> <li>Domaine racine (Base DN)</li> </ul> </li> </ul> <p>Identifiant (user DN) et le mot de passe\u00a0:un compte administrateur permettant au pare-feu de se connecter sur votre serveur LDAP et d'effectuer des lectures/\u00e9critures sur certains champs. Il est pr\u00e9f\u00e9rable de cr\u00e9er un compte sp\u00e9cifique pour le pare-feu et de lui attribuer les droits uniquement sur les champs qui lui sont n\u00e9cessaires.</p> <p>Hach\u00e9 du mot de passe\u00a0: permet de s\u00e9lectionner l'algorithme de hachage qui doit \u00eatre utilis\u00e9 pour enregistrer les mots de passes des utilisateurs, ce qui \u00e9vitera de l'enregistrer en clair.</p> <p>Par la suite, l'assistant propose d'activer le profil d'authentification 0 (internal) sur une interface, dans le cas o\u00f9 le profil n'a pas d\u00e9j\u00e0 \u00e9t\u00e9 activ\u00e9. Si c'est le cas, cette \u00e9tape ne s'affiche pas.</p> <p>Attention</p> <p>L'activation du profil n'est pas obligatoire et pourra \u00eatre r\u00e9alis\u00e9e (ou modifi\u00e9e) ult\u00e9rieurement (menu CONFIGURATION \u21d2 UTILISATEURS \u21d2 Authentification \u21d2 onglet PORTAIL CAPTIF ou onglet PROFILS DU PORTAIL CAPTIF pour modifier les param\u00e9trages).</p> <p></p> <ul> <li>Renseigner ensuite Les param\u00e8tres de l'annuaire externe (voir la     documentation en ligne pour le d\u00e9tail\u00a0:     https://documentation.stormshield.eu/SNS/v4/fr/Content/User_Configuration_Manual_SNS_v4/Directory_configuration/DIRECTORY_CONFIGURATION_LDAP.htm.)</li> </ul>"},{"location":"documentation/Stormshield/fiche10_utilisateurs_authentification_SNS/#configuration-dun-annuaire-interne","title":"Configuration d'un annuaire interne","text":"<p>{width=\"11.658cm\" height=\"4.962cm\"}</p> <ul> <li>Organisation\u00a0: le nom de l'organisation.</li> </ul> <p>Domaine\u00a0: le TLD (Top Level Domain) du domaine (fr, eu, org, com, etc.).</p> <ul> <li> <p>Mot de passe\u00a0: un mot de passe permettant de se connecter \u00e0 l'annuaire LDAP depuis un navigateur LDAP.</p> </li> <li> <p>Hach\u00e9 du mot de passe\u00a0: permet de s\u00e9lectionner l'algorithme de hachage qui doit \u00eatre utilis\u00e9 pour enregistrer les mots de passe des utilisateurs, ce qui \u00e9vitera de l'enregistrer en clair.</p> </li> </ul> <p>Par la suite, l'assistant propose d'activer le profil d'authentification 0 (internal) sur une interface, dans le cas o\u00f9 le profil n'a pas d\u00e9j\u00e0 \u00e9t\u00e9 activ\u00e9. Si c'est le cas, cette option sera d\u00e9sactiv\u00e9e (gris\u00e9e) et un message indique que l'association entre profil d'authentification et interface est d\u00e9j\u00e0 r\u00e9alis\u00e9e.</p> <p>Attention</p> <p>L'activation du profil n'est pas obligatoire et pourra \u00eatre r\u00e9alis\u00e9e (ou modifi\u00e9e) ult\u00e9rieurement (menu CONFIGURATION \u21d2 UTILISATEURS \u21d2 Authentification \u21d2 onglet PORTAIL CAPTIF ou onglet PROFILS DU PORTAIL CAPTIF pour modifier les param\u00e9trages).</p> <p>Dans les options choisies ci-dessous (qui peuvent \u00eatre modifi\u00e9es par la suite), le profil est cr\u00e9\u00e9. Les utilisateurs se connectant via l'interface \u00ab\u00a0in_vlan35_cli\u00a0\u00bb auront acc\u00e8s \u00e0 l'interface du portail captif via l'URL\u00a0: https://(@IP_firewall | FQDN_firewall)/auth</p> <ul> <li>Activer l\\'enr\u00f4lement des utilisateurs via le profil 0 (interne) du portail Web\u00a0: active le service d'enr\u00f4lement sur le profil 0     (interne) permettant aux utilisateurs de remplir un formulaire de     cr\u00e9ation de compte qui sera soumis \u00e0 l'approbation de     l'administrateur.</li> <li>Autoriser l'acc\u00e8s \u00e0 la base LDAP\u00a0: donne la possibilit\u00e9     d'acc\u00e9der \u00e0 l'annuaire LDAP depuis une adresse IP publique via un     navigateur LDAP. Si cet acc\u00e8s n'est pas n\u00e9cessaire, il est     vivement conseill\u00e9 de ne pas activer cette option.</li> </ul> <p></p> <p></p> <ul> <li>Saisir un mot de passe\u00a0: permet de se connecter \u00e0 l'annuaire, il     est possible de le modifier.</li> <li>Activer l'utilisation de l'annuaire utilisateur\u00a0: cette option     permet de d\u00e9marrer le service LDAP.</li> <li>Cliquer sur \u00ab\u00a0Appliquer\u00a0\u00bb</li> </ul> <p>Les deux autres options permettent de\u00a0:</p> <ul> <li>Activer l'acc\u00e8s non chiffr\u00e9 (PLAIN)\u00a0: active l'acc\u00e8s non chiffr\u00e9     \u00e0 l'annuaire,</li> <li>Activer l'acc\u00e8s SSL\u00a0: active l'acc\u00e8s s\u00e9curis\u00e9 \u00e0 l'annuaire, il     faut alors renseigner le champ certificat SSL pr\u00e9sent\u00e9 par le     serveur,</li> </ul> <p>Lorsqu'au moins un annuaire a \u00e9t\u00e9 configur\u00e9, via \u00ab\u00a0Action\u00a0\u00bb il est possible de\u00a0:</p> <ul> <li>supprimer un annuaire,</li> <li>d\u00e9signer un annuaire par d\u00e9faut,</li> <li>v\u00e9rifier la connexion \u00e0 l'annuaire,</li> <li>v\u00e9rifier l'utilisation de l'annuaire,</li> </ul> <p>Le reste du menu liste tous les annuaires ajout\u00e9s, parmi lesquels l'annuaire par d\u00e9faut s'affiche en vert. En cliquant sur un annuaire, ses param\u00e8tres s'affichent \u00e0 droite de la page.</p>"},{"location":"documentation/Stormshield/fiche10_utilisateurs_authentification_SNS/#gestion-des-utilisateurs","title":"Gestion des utilisateurs","text":"<ul> <li>Se rendre au menu CONFIGURATION\u21d2 UTILISATEURS \u21d2 Utilisateurs\u00a0:</li> </ul> <p>Cr\u00e9ation d'un utilisateur</p> <p>Avec un LDAP interne (ou un LDAP externe accessible en lecture/\u00e9criture), il est possible d'ajouter ou de supprimer des utilisateurs et des groupes depuis le menu CONFIGURATION \u21d2 UTILISATEURS \u21d2 Utilisateurs.</p> <ul> <li>Cliquer sur \u00ab\u00a0Ajouter un utilisateur\u00a0\u00bb.</li> <li>Saisir les informations de l'utilisateur.</li> <li>Saisir le mot de passe lorsqu'il est demand\u00e9.</li> </ul> <p>\u21d2 L'utilisateur est cr\u00e9\u00e9\u00a0: pour distinguer les annuaires, un suffixe est ajout\u00e9 aux utilisateurs et aux groupes pour indiquer le nom de l'annuaire (et non pas le nom du domaine). Par exemple (user@cub.fr).</p> <p>Attention</p> <p>Lors de l'acc\u00e8s \u00e0 ce menu, la liste des utilisateurs et groupes est toujours vide, c'est un comportement normal. En effet, si vous \u00eates connect\u00e9 \u00e0 un annuaire contenant un grand nombre d'utilisateurs et de groupes, l'affichage sans filtre dans le champ Recherche peut avoir un impact sur les performances de l'interface graphique.Pour changer ce comportement par d\u00e9faut (non conseill\u00e9)\u00a0: Ouvrir le menu des pr\u00e9f\u00e9rences du pare-feu accessible en cliquant sur l'ic\u00f4ne repr\u00e9sentant des outils dans l'en-t\u00eate de l'interface Web, et cocher la case \u00ab\u00a0Afficher les utilisateurs d\u00e8s le d\u00e9marrage du module\u00a0\u00bb.</p> <p></p> <p>Sinon, pour voir les utilisateurs ou les groupes\u00a0:</p> <ul> <li>cliquer sur l'un des filtres (utilisateurs ou groupes)</li> </ul>"},{"location":"documentation/Stormshield/fiche10_utilisateurs_authentification_SNS/#le-portail-captif","title":"Le portail captif","text":"<p>Le portail captif, ou portail d'authentification, est une page web embarqu\u00e9e sur le pare-feu et accessible via une connexion s\u00e9curis\u00e9e (HTTPS) depuis ses adresses IP (il peut \u00eatre activ\u00e9 sur toutes les interfaces du pare-feu).</p> <p>Les utilisateurs peuvent se connecter sur le portail en utilisant leur identifiant/mot de passe d'annuaire. Dans le cas o\u00f9 plusieurs annuaires sont configur\u00e9s au niveau du pare-feu, les utilisateurs peuvent ajouter \u00e0 l'identifiant le nom du domaine auquel ils appartiennent, par exemple, user@cub.fr. Si le nom du domaine n'est pas pr\u00e9cis\u00e9, l'authentification s'effectuera avec la m\u00e9thode ou avec l'annuaire d\u00e9fini par d\u00e9faut au niveau du profil d'authentification.</p> <p>L'URL du portail est\u00a0: https://(@IP_firewall | FQDN_firewall)/auth</p>"},{"location":"documentation/Stormshield/fiche10_utilisateurs_authentification_SNS/#configuration-du-portail-captif","title":"Configuration du portail captif","text":"<p>Pour activer le portail sur une interface, il suffit d'ajouter une ligne dans cet encadr\u00e9, sur laquelle il faut s\u00e9lectionner une interface et un profil d'authentification. Un seul profil peut \u00eatre s\u00e9lectionn\u00e9 par interface.</p> <ul> <li>Se rendre au menu CONFIGURATION \u21d2 UTILISATEURS \u21d2 Authentification \u21d2     onglet PORTAIL CAPTIF</li> <li>Cliquer sur +Ajouter</li> <li>S\u00e9lectionner l'interface, choisir le profil, puis \u00ab\u00a0Appliquer\u00a0\u00bb</li> </ul> <p></p> <p>La seconde partie de la page permet d'ajouter une charte d'utilisation de l'acc\u00e8s r\u00e9seau qui doit \u00eatre accept\u00e9e par l'utilisateur une fois authentifi\u00e9 \u21d2 Condition d'utilisation de l'acc\u00e8s \u00e0 Internet. Elle peut \u00eatre t\u00e9l\u00e9charg\u00e9e en format PDF ou en format HTML. Le bouton R\u00e9initialiser la personnalisation des conditions d'utilisation de l'acc\u00e8s \u00e0 Internet permet de supprimer une charte pr\u00e9alablement t\u00e9l\u00e9charg\u00e9e.</p> <p></p> <p>La configuration avanc\u00e9e permet\u00a0:</p> <ul> <li>d'interrompre les connexions lorsque l'authentification expire,</li> <li>d'importer un fichier de configuration du proxy (.pac),</li> <li>de modifier le port du portail captif</li> <li>de modifier son apparence\u00a0: masquer le logo Stormshield sur le     portail, t\u00e9l\u00e9charger un nouveau logo et modifier la feuille de     style.</li> </ul> <p></p>"},{"location":"documentation/Stormshield/fiche10_utilisateurs_authentification_SNS/#configuration-dun-profil-dauthentification","title":"Configuration d'un profil d'authentification","text":"<ul> <li>Se rendre dans le menu CONFIGURATION \u21d2 UTILISATEURS \u21d2     Authentification \u21d2 onglet PROFILS DU PORTAIL CAPTIF.</li> </ul> <p>Il existe 10 profils diff\u00e9rents, les cinq premiers sont pr\u00e9configur\u00e9s :</p> <ul> <li>internal, external\u00a0: Ils poss\u00e8dent la m\u00eame configuration. Le premier     est destin\u00e9 \u00e0 \u00eatre attach\u00e9 aux interfaces internes et le deuxi\u00e8me     aux interfaces externes en utilisant n'importe quelle m\u00e9thode     d'authentification utilisant le portail captif\u00a0;</li> <li>Guest\u00a0: pr\u00e9configur\u00e9 pour la m\u00e9thode d'authentification invit\u00e9\u00a0;</li> <li>Voucher\u00a0: pr\u00e9configur\u00e9 pour la m\u00e9thode d'authentification des     comptes temporaires\u00a0;</li> <li>Sponsor\u00a0: pr\u00e9configur\u00e9 pour la m\u00e9thode d'authentification par     parrainage.</li> </ul> <p>Il faut configurer la m\u00e9thode ou l'annuaire par d\u00e9faut utilis\u00e9 par le profil s\u00e9lectionn\u00e9 dans l'\u00e9tape pr\u00e9c\u00e9dente. Par exemple\u00a0:</p> <p></p> <ul> <li>Activer chaque profil pour consulter la pr\u00e9-configuration (qu'il est possible de modifier).</li> </ul>"},{"location":"documentation/Stormshield/fiche10_utilisateurs_authentification_SNS/#deconnexion-des-utilisateurs","title":"D\u00e9connexion des utilisateurs","text":""},{"location":"documentation/Stormshield/fiche10_utilisateurs_authentification_SNS/#deconnexion-depuis-le-navigateur","title":"D\u00e9connexion depuis le navigateur","text":"<ul> <li> <p>Se rendre au menu CONFIGURATION \u21d2 UTILISATEURS \u21d2 Authentification     \u21d2 onglet PROFILS DU PORTAIL CAPTIF (configuration avanc\u00e9e).</p> </li> <li> <p>Cocher la case \u00ab\u00a0Activer la page de d\u00e9connexion\u00a0\u00bb</p> </li> </ul> <p>\u21d2 Un onglet de d\u00e9connexion s'ouvre dans le navigateur de l'utilisateur ayant r\u00e9ussi \u00e0 se connecter. Pour se d\u00e9connecter, l'utilisateur doit simplement cliquer sur le bouton D\u00e9connexion de cet onglet.</p>"},{"location":"documentation/Stormshield/fiche10_utilisateurs_authentification_SNS/#deconnexion-depuis-le-portail-captif","title":"D\u00e9connexion depuis le portail captif","text":"<p>Pour se d\u00e9connecter, l'utilisateur doit se connecter de nouveau au portail captif, cliquer sur Connexion dans le menu de gauche et ensuite sur le bouton D\u00e9connexion.</p> <p>D\u00e9connexion d'un utilisateur depuis l'interface graphique par l'administrateur</p> <ul> <li>Se rendre au menu Supervision puis Utilisateurs.</li> <li>Cliquer sur l'utilisateur avec le bouton droit, et ensuite sur     D\u00e9connecter l'utilisateur.</li> </ul>"},{"location":"documentation/Stormshield/fiche10_utilisateurs_authentification_SNS/#les-methodes-dauthentification","title":"Les m\u00e9thodes d'authentification","text":"<p>Les firewalls SNS impl\u00e9mentent plusieurs m\u00e9thodes d'authentification qui peuvent \u00eatre class\u00e9es en deux cat\u00e9gories\u00a0:</p> <ul> <li>les m\u00e9thodes explicites via le portail captif\u00a0: l'utilisateur est     redirig\u00e9 vers le portail captif pour saisir un identifiant/mot de     passe. Ces derniers sont r\u00e9cup\u00e9r\u00e9s par le pare-feu pour v\u00e9rifier     l'identit\u00e9 de l'utilisateur en fonction de la m\u00e9thode utilis\u00e9e\u00a0;</li> <li>les m\u00e9thodes implicites ou transparentes\u00a0: l'authentification est     transparente vis-\u00e0-vis de l'utilisateur qui n'a pas besoin de     renseigner son identit\u00e9 explicitement pour acc\u00e9der au r\u00e9seau.</li> </ul> <p></p> <p>Pour ajouter une m\u00e9thode d'authentification utilis\u00e9es par le pare-feu</p> <ul> <li>Se rendre au menu CONFIGURATION \u21d2 UTILISATEURS \u21d2 Authentification     \u21d2 onglet M\u00c9THODES DISPONIBLES.</li> </ul> <p>Chaque m\u00e9thode n\u00e9cessite de renseigner des param\u00e8tres sp\u00e9cifiques. Cependant, suite \u00e0 la configuration d'un annuaire LDAP, la m\u00e9thode d'authentification LDAP est renseign\u00e9e automatiquement.</p>"},{"location":"documentation/Stormshield/fiche10_utilisateurs_authentification_SNS/#la-politique-dauthentification","title":"La politique d'authentification","text":"<p>Puisque les pare-feu SNS supportent plusieurs annuaires et plusieurs m\u00e9thodes d'authentification simultan\u00e9ment, il peut \u00eatre n\u00e9cessaire de d\u00e9finir une politique d'authentification pour indiquer la ou les m\u00e9thodes \u00e0 appliquer en fonction de deux crit\u00e8res\u00a0: l'utilisateur ou le groupe d'utilisateurs, et l'adresse IP source ou l'interface d'entr\u00e9e.</p> <ul> <li>Se rendre au menu CONFIGURATION \u21d2 UTILISATEURS \u21d2 Authentification     \u21d2 onglet POLITIQUE D'AUTHENTIFICATION.</li> </ul> <p>La politique peut \u00eatre constitu\u00e9e de plusieurs r\u00e8gles appliqu\u00e9es en fonction de leur ordre. Plusieurs m\u00e9thodes d'authentification peuvent \u00eatre utilis\u00e9es par une seule r\u00e8gle. Dans ce cas, les m\u00e9thodes sont appliqu\u00e9es suivant l'ordre d'apparition dans la r\u00e8gle. Si une m\u00e9thode permet d'authentifier l'utilisateur, les m\u00e9thodes suivantes ne seront pas test\u00e9es. Par exemple\u00a0:</p> <p></p> <p>Dans la r\u00e8gle 3, tous les utilisateurs du domaine \u00ab\u00a0institute.com\u00a0\u00bb qui se connectent depuis le r\u00e9seau interne doivent, en premier lieu, s'authentifier via la m\u00e9thode Agent SSO. Si l'authentification \u00e9choue, alors on propose \u00e0 l'utilisateur de s\u00e9lectionner son certificat. Enfin, si cette seconde m\u00e9thode n'aboutit pas (pas de certificat pour cet utilisateur par exemple), il est convi\u00e9 \u00e0 renseigner un couple d'identifiant/mot de passe pour une authentification via la m\u00e9thode LDAP.</p> <p>Dans le cas o\u00f9 aucune r\u00e8gle ne correspond aux crit\u00e8res du trafic, la m\u00e9thode d'authentification par d\u00e9faut est appliqu\u00e9e.</p> <p>Lorsqu'elle est utilis\u00e9e dans une r\u00e8gle, la m\u00e9thode Agent SSO est automatiquement la plus prioritaire des m\u00e9thodes parce que cette derni\u00e8re authentifie l'utilisateur sur le pare-feu d\u00e8s son authentification sur le domaine Active Directory.</p> <p>Dans la politique d'authentification, vous pouvez donc cr\u00e9er une politique pour d\u00e9terminer les r\u00e9seaux et les utilisateurs qui utiliseront la m\u00e9thode LDAP, ou la d\u00e9finir comme la m\u00e9thode par d\u00e9faut.</p> <p>Pour cr\u00e9er une politique</p> <ul> <li>Cliquer sur Nouvelle r\u00e8gle \u21d2 R\u00e8gle Standard.</li> </ul> <p></p> <ul> <li>Renseigner les utilisateurs ou les groupes,</li> <li>Renseigner les r\u00e9seaux ou les interfaces sources. Dans le cas de la     cr\u00e9ation d'un premier annuaire, le rattachement du profil     d'authentification 0 (internal) \u00e0 une interface est propos\u00e9 lors de     la cr\u00e9ation de l'annuaire. Sinon le rattachement peut s'effectuer     dans le menu CONFIGURATION \u21d2 UTILISATEURS \u21d2 Authentification \u21d2     PORTAIL CAPTIF, en ajoutant une entr\u00e9e dans la liste CORRESPONDANCE     ENTRE PROFIL D'AUTHENTIFICATION ET INTERFACE. Dans l'entr\u00e9e, il faut     s\u00e9lectionner l'interface et le profil. La m\u00e9thode ou l'annuaire par     d\u00e9faut sont renseign\u00e9s automatiquement en fonction de ce qui est     configur\u00e9 sur le profil s\u00e9lectionn\u00e9.</li> <li>Choisir les m\u00e9thodes d'authentification \u00e0 utiliser (kerberos,     Radius, SSL, SPNEGO, Agent SSO, m\u00e9thode par d\u00e9faut et interdire).</li> </ul>"},{"location":"documentation/Stormshield/fiche10_utilisateurs_authentification_SNS/#regles-de-filtrage-pour-lauthentification","title":"R\u00e8gles de filtrage pour l'authentification","text":"Rappel du principe du portail captif <p>1. L'utilisateur ouvre un navigateur pour acc\u00e9der \u00e0 un site en HTTP ou HTTPS. 2. La requ\u00eate HTTP est intercept\u00e9e par le firewall qui renvoie l'utilisateur vers le portail d'authentification (https://@IP_firewall/auth). 3. L'utilisateur introduit son identifiant/mot de passe d'annuaire qui sont envoy\u00e9s au firewall via une connexion s\u00e9curis\u00e9e (HTTPS). 4. Le firewall authentifie l'utilisateur au niveau de l'annuaire (LDAP interne/externe ou AD). Dans le cas o\u00f9 l'utilisateur est authentifi\u00e9, le navigateur est renvoy\u00e9 vers le site web demand\u00e9 au d\u00e9part.</p> <p>Le premier point n\u00e9cessite une r\u00e8gle pour permettre \u00e0 un utilisateur non authentifi\u00e9 \u00e0 \u00eatre redirig\u00e9 vers le portail \u21d2 Le pare-feu doit rediriger les requ\u00eates HTTP et HTTPS des utilisateurs non authentifi\u00e9s vers le portail captif.</p> <p></p> <ul> <li>Cliquer sur Nouvelle r\u00e8gle puis r\u00e8gle d'authentification</li> </ul> <p>Un assistant permet de cr\u00e9er une r\u00e8gle par d\u00e9faut qu'il sera possible de modifier\u00a0:</p> <p></p> <p>Ci-dessous la r\u00e8gle modifi\u00e9e pour rediriger tous les flux HTTP et HTTPS provenant des r\u00e9seaux prot\u00e9g\u00e9s vers le portail captif\u00a0:</p> <p></p> <p></p> <p>Le champ Utilisateur permet de sp\u00e9cifier l'utilisateur (ou le groupe) devant \u00eatre authentifi\u00e9 pour que la r\u00e8gle s'applique dont\u00a0:</p> <ul> <li> <p>Any user@any : d\u00e9signe tout utilisateur authentifi\u00e9, quel que soit l\\'annuaire ou la m\u00e9thode d\\'authentification utilis\u00e9s,</p> </li> <li> <p>Any user@guest_users.local.domain : d\u00e9signe tout utilisateur authentifi\u00e9 par la m\u00e9thode invit\u00e9,</p> </li> <li> <p>Any user@voucher_users.local.domain : d\u00e9signe tout utilisateur authentifi\u00e9 par la m\u00e9thode comptes temporaires,</p> </li> <li> <p>Any user@sponsored_users.local.domain : d\u00e9signe tout utilisateur se pr\u00e9sentant via la m\u00e9thode parrainage,</p> </li> <li> <p>Any user@\\&lt;domaine&gt; : d\u00e9signe tout utilisateur authentifi\u00e9 par l'annuaire du domaine,</p> </li> <li> <p>Any user@none : d\u00e9signe tout utilisateur authentifi\u00e9 par une m\u00e9thode n'utilisant pas un annuaire, par exemple : parrainage, compte temporaire, etc.</p> </li> <li> <p>Utilisateurs inconnus : d\u00e9signe tout utilisateur non authentifi\u00e9. Cette valeur est principalement utilis\u00e9e dans une r\u00e8gle d'authentification car dans une telle r\u00e8gle, on ne conna\u00eet pas encore l'utilisateur.</p> </li> </ul> <p>La liste de tous les utilisateurs et groupes pr\u00e9sents dans les annuaires.</p> <p>Avant d'ajouter la r\u00e8gle pr\u00e9c\u00e9dente de redirection vers le portail captif, il faut s'assurer que:</p> <p>les connexions DNS sont autoris\u00e9es pour tous les utilisateurs (authentifi\u00e9s ou non), car sans r\u00e9solution DNS, il n'y aura pas de requ\u00eates HTTP ou HTTPS et par cons\u00e9quent, pas de redirection vers le portail captif. La r\u00e8gle d'activation du proxy SSL doit \u00e9galement \u00eatre plac\u00e9e avant pour pouvoir acc\u00e9der aux sites en HTTPS.</p> <p>Vous pouvez ensuite ajouter des r\u00e8gles sp\u00e9cifiques pour les utilisateurs ou les groupes authentifi\u00e9s (Source &gt; Utilisateur:).</p> <p></p> <p>La connexion via le portail captif avec Firefox\u00a0:</p> <p></p> <p></p> <p>Une fois connect\u00e9e, l'acc\u00e8s \u00e0 Internet est possible.</p>"},{"location":"documentation/Stormshield/fiche11_infrastructure_cles_publiques_SNS/","title":"Fiche 11 -- Infrastructures \u00e0 cl\u00e9s pubiques (PKI)","text":""},{"location":"documentation/Stormshield/fiche11_infrastructure_cles_publiques_SNS/#gestion-des-certificats","title":"Gestion des certificats","text":"<p>Les pare-feu Stormshield int\u00e8grent les fonctions permettant la gestion des certificats.</p>"},{"location":"documentation/Stormshield/fiche11_infrastructure_cles_publiques_SNS/#ecran-de-gestion","title":"\u00c9cran de gestion","text":"<ul> <li>Se rendre au menu CONFIGURATION / OBJETS / Certificats et PKI</li> </ul> <p>+Ajouter lance des assistants de configuration permettant d'ajouter des \u00e9l\u00e9ments dans les objets\u00a0:</p> <ul> <li>Autorit\u00e9 racine\u00a0: permet de cr\u00e9er une autorit\u00e9 de certification     racine g\u00e9r\u00e9e par le firewall. Cette autorit\u00e9 peut \u00eatre une     sous-autorit\u00e9 d'une PKI externe.</li> <li>Sous-autorit\u00e9\u00a0:permet de cr\u00e9er une autorit\u00e9 de certification     d\u00e9pendant d'une autre CA. L'autorit\u00e9 parente doit \u00eatre g\u00e9r\u00e9e par le     boitier.</li> <li>Identit\u00e9 utilisateur : permet de cr\u00e9er une identit\u00e9     utilisateur d\u00e9pendant d'une autorit\u00e9 de certification g\u00e9r\u00e9e par le     boitier.</li> <li>Identit\u00e9 serveur : permet de cr\u00e9er une identit\u00e9 serveur     d\u00e9pendant d'une autorit\u00e9 de certification g\u00e9r\u00e9e par le boitier.</li> <li>Smartcard\u00a0: permet de cr\u00e9er une identit\u00e9 Smartcard d\u00e9pendant     d'une autorit\u00e9 de certification g\u00e9r\u00e9e par le boitier.</li> <li>Importer un fichier\u00a0: le fichier import\u00e9 peut \u00eatre une identit\u00e9,     un certificat, une CRL.</li> </ul>"},{"location":"documentation/Stormshield/fiche11_infrastructure_cles_publiques_SNS/#ca-interne-et-externe","title":"CA interne et externe","text":""},{"location":"documentation/Stormshield/fiche11_infrastructure_cles_publiques_SNS/#ca-interne","title":"CA interne","text":"<p>Cette fonctionnalit\u00e9 de gestion d'une infrastructure \u00e0 cl\u00e9s publiques permet de r\u00e9pondre \u00e0 un grand nombre de cas d'usage :</p> <ul> <li> <p>Le pare-feu agit en tant qu'autorit\u00e9 de certification racine (root     CA)\u00a0: le bo\u00eetier SNS permet de d\u00e9finir les cha\u00eenes de confiance     n\u00e9cessaires \u00e0 une authentification par certificat. Des autorit\u00e9s par     d\u00e9faut sont disponibles pour signer les certificats utilis\u00e9s par le     proxy SSL ou livrer les certificats n\u00e9cessaires au fonctionnement du     VPN SSL. Son certificat d'autorit\u00e9 est auto-sign\u00e9.</p> <p>Les fonctions propos\u00e9es par le bo\u00eetier SNS permettent de r\u00e9pondre pleinement au r\u00f4le d'autorit\u00e9 de certification (cr\u00e9ation de certificat de diff\u00e9rentes natures, signature de CSR, r\u00e9vocation de certificat et gestion de CRL).</p> </li> <li> <p>Le pare-feu agit en tant que sous-autorit\u00e9 de certification\u00a0: il     est possible de d\u00e9finir un bo\u00eetier SNS comme \u00e9tant une sous-autorit\u00e9     de certification d'une CA parente (g\u00e9r\u00e9e obligatoirement sur le m\u00eame     bo\u00eetier). Le certificat de la sous-autorit\u00e9 est sign\u00e9 par l'autorit\u00e9     parente (pas n\u00e9cessairement une autorit\u00e9 racine), laquelle est une     autorit\u00e9 interne ou externe. Cela permet d'organiser plus finement     la r\u00e9partition et la distribution des identit\u00e9s, par usages ou par     entit\u00e9s d'une m\u00eame entreprise.</p> </li> </ul> <p></p>"},{"location":"documentation/Stormshield/fiche11_infrastructure_cles_publiques_SNS/#ca-externe","title":"CA externe","text":"<p>Dans le cadre d'usage d'une CA externe, les fonctionnalit\u00e9s propos\u00e9es permettent essentiellement d'importer des certificats et de d\u00e9finir les relations de confiance pour divers usages\u00a0:</p> <ul> <li>Import de certificats d'autorit\u00e9 de certification.</li> <li>Import de certificats d'\u00e9quipements.</li> <li>Import de certificats et de cl\u00e9s priv\u00e9s d'\u00e9quipements (fichiers     \u00ab\u00a0.p12\u00a0\u00bb prot\u00e9g\u00e9s ou pas par mot de passe).</li> </ul> <p>Le firewall agit en tant que PKI en permettant l'import de certificats, voire d'identit\u00e9s (prot\u00e9g\u00e9es par des fichiers de type PKCS#12), \u00e9mis par une CA externe</p> <p>Les certificats import\u00e9s sont accessibles aux modules requ\u00e9rant une authentification par certificats (interface d'administration, VPN SSL, VPN Ipsec, etc.)</p>"},{"location":"documentation/Stormshield/fiche11_infrastructure_cles_publiques_SNS/#creation-dune-autorite-de-certification","title":"Cr\u00e9ation d'une autorit\u00e9 de certification","text":"<ul> <li>Se rendre au menu CONFIGURATION / OBJETS / Certificats et PKI </li> <li>Cliquer sur Ajouter puis s\u00e9lectionner     Autorit\u00e9 racine.</li> <li>Renseigner un CN (obligatoire)\u00a0: il s\\'agit d\\'un nom permettant     d'identifier votre autorit\u00e9 racine, dans la limite de 64 caract\u00e8res.     Ce nom peut faire r\u00e9f\u00e9rence \u00e0 une organisation, un utilisateur, un     serveur, une machine, etc.</li> <li>Renseigner un Identifiant (facultatif)\u00a0: vous pouvez ici     indiquer un raccourci de votre CN, utile pour vos lignes de     commande.</li> <li> <p>renseigner les attributs de l\\'autorit\u00e9. Ces informations seront     pr\u00e9sentes dans le certificat de l\\'autorit\u00e9 ainsi que dans les     certificats qu\\'elle \u00e9mettra\u00a0:</p> <ul> <li>Organisation (O)\u00a0: nom de votre soci\u00e9t\u00e9.</li> <li>Unit\u00e9 d'organisation (OU)\u00a0: \\\"branche\\\" de votre soci\u00e9t\u00e9.</li> <li>Lieu (L) : ville dans laquelle est situ\u00e9e votre soci\u00e9t\u00e9</li> <li>\u00c9tat ou province (ST) : d\u00e9partement g\u00e9ographique de votre     soci\u00e9t\u00e9.</li> <li>Pays (C)\u00a0: pays dans laquelle est situ\u00e9e votre soci\u00e9t\u00e9</li> </ul> </li> <li> <p>Cliquer sur Suivant.</p> </li> <li>Saisir le mot de passe destin\u00e9 \u00e0 prot\u00e9ger l\\'autorit\u00e9 racine et     confirmez-le. Une jauge indique le degr\u00e9 de robustesse de votre mot     de passe. Il est recommand\u00e9 de combiner les lettres minuscules,     majuscules, les chiffres et les caract\u00e8res sp\u00e9ciaux.</li> <li>Renseigner votre E-mail (facultatif) afin de recevoir un message     vous confirmant la cr\u00e9ation de votre autorit\u00e9.</li> <li> <p>Modifier \u00e9ventuellement des \u00e9l\u00e9ments du certificat\u00a0:</p> </li> <li> <p>la valeur de la dur\u00e9e de validit\u00e9 (jours) conseill\u00e9e des certificats     est de 365 jours (propos\u00e9e par d\u00e9faut). Ce champ correspond au     nombre de jours durant lesquels votre certificat d\\'autorit\u00e9 et par     cons\u00e9quent votre PKI seront valides. Cette date influe sur tous les     aspects de votre PKI. En effet, une fois ce certificat expir\u00e9, tous     les certificats utilisateurs le seront \u00e9galement. Cette valeur qui     ne doit pas exc\u00e9der 3650 jours ne sera pas modifiable par la     suite.</p> </li> <li>Vous pouvez aussi modifier la Taille de cl\u00e9 (en bits) du certificat.     Bien que les cl\u00e9s de grande taille soient plus efficaces, il est     d\u00e9conseill\u00e9 d'utiliser celles-ci avec les \u00e9quipements d'entr\u00e9e de     gamme, pour des raisons de temps de g\u00e9n\u00e9ration.</li> </ul> <p></p> <ul> <li>Cliquez sur Suivant puis encore sur Suivant.</li> </ul> <p>Un r\u00e9sum\u00e9 des informations saisies vous est pr\u00e9sent\u00e9\u00a0:</p> <p></p> <ul> <li>Cliquer sur Terminer.</li> </ul> <p>R\u00e9sultat</p> <p></p> <p>L'autorit\u00e9 est automatiquement ajout\u00e9e \u00e0 l'arborescence des autorit\u00e9s, identit\u00e9s et certificats d\u00e9finis sur le firewall.</p> <p>Un clic sur l'autorit\u00e9 affiche ses informations d\u00e9taill\u00e9es dans la partie droite de l'\u00e9cran.</p> <ul> <li> <p>D\u00e9finir \u00e9ventuellement par d\u00e9faut l'autorit\u00e9 de certification</p> <p></p> </li> </ul>"},{"location":"documentation/Stormshield/fiche11_infrastructure_cles_publiques_SNS/#creation-dune-identite-serveur","title":"Cr\u00e9ation d'une identit\u00e9 serveur","text":"<p>Voir \u00ab\u00a0fiche 12 -- Le VPN\u00a0\u00bb</p> <p></p>"},{"location":"documentation/Stormshield/fiche11_infrastructure_cles_publiques_SNS/#difference-entre-les-certificats-pem-et-der","title":"Diff\u00e9rence entre les certificats PEM et DER","text":""},{"location":"documentation/Stormshield/fiche11_infrastructure_cles_publiques_SNS/#certificat-pem-privacy-enhanced-mail","title":"Certificat PEM (Privacy Enhanced Mail)","text":"<ul> <li>Encodage : Le format PEM utilise un encodage Base64.</li> <li>Structure : Le contenu est encadr\u00e9 par des balises :</li> </ul> <pre><code> -----BEGIN CERTIFICATE-----\n (contenu encod\u00e9 en Base64)\n -----END CERTIFICATE-----\n</code></pre> <ul> <li>Utilisation : Principalement utilis\u00e9 pour les certificats SSL/TLS sur les serveurs web, ainsi que pour stocker des cl\u00e9s priv\u00e9es et des certificats interm\u00e9diaires.</li> <li>Extension de fichier : Les fichiers PEM ont souvent l'une des extensions suivantes : .pem, .crt, .cer, ou .key.</li> <li>Lisibilit\u00e9 : Il est lisible en texte brut et peut \u00eatre ouvert avec n'importe quel \u00e9diteur de texte.</li> </ul>"},{"location":"documentation/Stormshield/fiche11_infrastructure_cles_publiques_SNS/#certificat-der-distinguished-encoding-rules","title":"Certificat DER (Distinguished Encoding Rules)","text":"<ul> <li>Encodage : Le format DER est binaire (non encod\u00e9 en Base64).</li> <li>Structure : Pas de balises, le fichier est stock\u00e9 dans un format binaire pur.</li> <li>Utilisation : Couramment utilis\u00e9 dans des environnements o\u00f9 l'encodage Base64 n'est pas n\u00e9cessaire, comme les applications Java.</li> <li>Extension de fichier : Les fichiers DER ont g\u00e9n\u00e9ralement l'extension .der ou .cer.</li> <li>Lisibilit\u00e9 : Non lisible en texte brut. Il ne peut pas \u00eatre ouvert directement avec un \u00e9diteur de texte classique.</li> </ul>"},{"location":"documentation/Stormshield/fiche11_infrastructure_cles_publiques_SNS/#creation-et-gestion-dune-identite-utilisateur","title":"Cr\u00e9ation et gestion d'une identit\u00e9 utilisateur","text":"<p>Premi\u00e8re m\u00e9thode \u00e0 partir d'un utilisateur cr\u00e9\u00e9 dans l'annuaire LDAP interne du firewall</p> <p>il est possible de g\u00e9n\u00e9rer une identit\u00e9 utilisateur directement depuis l'annuaire LDAP interne du firewall. Dans ce cas, le choix de l'autorit\u00e9 signataire se porte automatiquement sur la CA d\u00e9sign\u00e9e par d\u00e9faut.</p> <ul> <li>Se rendre au menu CONFIGURATION / UTILISATEURS / Utilisateurs</li> <li>S\u00e9lectionner l'utilisateur puis cliquer sur CERTIFICAT puis     Cr\u00e9er l'identit\u00e9</li> </ul> <p></p> <p></p> <ul> <li>Cliquer sur \u00ab\u00a0Cr\u00e9er l'identit\u00e9\u00a0\u00bb \u21d2 Le certificat de l'utilisateur     s'affiche</li> </ul> <p></p> <p>Il est \u00e9galement visible via le menu OBJETS / CERTIFICATS et PKI</p> <p></p> <p>Deuxi\u00e8me m\u00e9thode</p> <ul> <li>Se rendre au menu CONFIGURATION / OBJETS / Certificats et PKI</li> <li>Cliquer sur +Ajouter puis Identit\u00e9 Utilisateur.</li> <li>Renseigner\u00a0:<ol> <li>un CN (obligatoire)\u00a0: nom permettant d'identifier l\\'utilisateur     dans la limite de 64 caract\u00e8res.</li> <li>un Identifiant (facultatif)\u00a0: vous pouvez ici indiquer un raccourci     de votre CN, utile pour vos lignes de commande (exemple\u00a0: si le CN     est un couple Pr\u00e9nom+Nom, l\\'identifiant peut correspondre aux     initiales du CN).</li> <li>l'adresse e-mail (obligatoire) de l\\'utilisateur pour lequel vous     cr\u00e9ez une identit\u00e9.</li> </ol> </li> <li>Cliquer sur Suivant.</li> <li>S\u00e9lectionner l\\'Autorit\u00e9 parente destin\u00e9e \u00e0 signer le certificat de     l\\'identit\u00e9.</li> <li>Renseigner le Mot de passe de l\\'autorit\u00e9 parente.</li> </ul> <p>Info</p> <p>Les attributs de l\\'autorit\u00e9 sont automatiquement ajout\u00e9s. Ils seront pr\u00e9sents dans le certificat utilisateur.</p> <ul> <li>Cliquer sur Suivant.</li> </ul> <p>Info</p> <p>Lorsque le firewall dispose d'un TPM et que celui-ci a \u00e9t\u00e9 initialis\u00e9, cocher la case Prot\u00e9ger cette identit\u00e9 \u00e0 l'aide du TPM pour enregistrer cette identit\u00e9 sur le TPM.</p> TPM <p>Le TPM (Trusted Platform Module) est un composant mat\u00e9riel de s\u00e9curit\u00e9 qui permet de stocker et prot\u00e9ger les cl\u00e9s cryptographiques ainsi que d'autres donn\u00e9es sensibles de mani\u00e8re s\u00e9curis\u00e9e. Le TPM est con\u00e7u pour renforcer la s\u00e9curit\u00e9 des syst\u00e8mes en fournissant des fonctionnalit\u00e9s comme l'authentification s\u00e9curis\u00e9e et le chiffrement des donn\u00e9es. Il est obligatoire pour Windows 11 d\u00e9sormais en version 2.0 (Puce TPM)</p> <ul> <li>Modifier \u00e9ventuellement des \u00e9l\u00e9ments du certificat\u00a0: la valeur de la     dur\u00e9e de validit\u00e9 (jours) conseill\u00e9e des certificats est de 365     jours (propos\u00e9e par d\u00e9faut). Vous pouvez aussi modifier la Taille de     cl\u00e9 (en bits) du certificat. Bien que les cl\u00e9s de grande taille     soient plus efficaces, il est d\u00e9conseill\u00e9 d'utiliser celles-ci avec     les \u00e9quipements d'entr\u00e9e de gamme, pour des raisons de temps de     g\u00e9n\u00e9ration.</li> </ul> <p>Attention</p> <p>Si l\\'autorit\u00e9 utilis\u00e9e pour g\u00e9n\u00e9rer le certificat est l'autorit\u00e9 par d\u00e9faut du firewall ET si un utilisateur d\u00e9clar\u00e9 dans l'annuaire LDAP r\u00e9f\u00e9rence la m\u00eame adresse e-mail que celle pr\u00e9cis\u00e9e \u00e0 l'\u00e9tape 3, vous pouvez associer automatiquement cette identit\u00e9 \u00e0 l'utilisateur correspondant\u00a0:</p> <ul> <li>Cocher la case Publier cette identit\u00e9 dans l'annuaire LDAP,</li> <li>Saisissez deux fois un mot de passe destin\u00e9 \u00e0 prot\u00e9ger le conteneur     PKCS#12 de l'identit\u00e9.</li> <li>Cliquer sur Suivant \u21d2 Un r\u00e9sum\u00e9 des informations saisies vous est     pr\u00e9sent\u00e9.</li> <li>Cliquer sur Terminer.</li> </ul> <p>Info</p> <p>L'identit\u00e9 est automatiquement ajout\u00e9e \u00e0 l'arborescence des autorit\u00e9s, identit\u00e9s et certificats d\u00e9finis sur le firewall, sous son autorit\u00e9 parente.</p>"},{"location":"documentation/Stormshield/fiche11_infrastructure_cles_publiques_SNS/#gestion-des-identites-et-certificats","title":"Gestion des identit\u00e9s et certificats","text":"<p>Menu T\u00e9l\u00e9charger</p> <p>Certificat : le format d'export contient des donn\u00e9es en base64 (.pem) ou des donn\u00e9es binaires (.der). Le fichier export\u00e9 contient le certificat du porteur mais \u00e9galement les certificats des autorit\u00e9s pr\u00e9sentes dans la cha\u00eene de confiance de ce certificat.</p> <p>Identit\u00e9 : l'identit\u00e9, puisqu'elle contient une cl\u00e9 priv\u00e9e, est sensible et son export doit \u00eatre prot\u00e9g\u00e9 par un mot de passe, lequel permet de chiffrer la cl\u00e9 priv\u00e9e qu'il contient. L'identit\u00e9 est pour rappel constitu\u00e9e de la cl\u00e9 priv\u00e9e du porteur, de son certificat (qui contient sa cl\u00e9 publique), et des certificats de la cha\u00eene de confiance. Le fichier d'export est un container .pem ou un container PKCS#12 (ou .p12).</p>"},{"location":"documentation/Stormshield/fiche11_infrastructure_cles_publiques_SNS/#document-1-rappels-et-vocabulaire","title":"Document 1\u00a0: Rappels et vocabulaire","text":"Infrastructure \u00e0 cl\u00e9s publiques ou PKI (Public Key Infrastructure) <p>Infrastructure qui h\u00e9berge les informations publiques (annuaire, CRL) et qui permet d'acc\u00e9der aux certificats de l'organisation, d'effectuer un renouvellement de certificat, ou de le r\u00e9voquer.</p> <p>Un certificat peut contenir du texte (extensions .pem, .crt) ou des donn\u00e9es binaires directement (extensions .cer, .der).</p> <p>La validit\u00e9 du certificat est remise en cause\u00a0:</p> <ul> <li>\u00e0 l'expiration de ce dernier (limitation dans le temps)\u00a0;</li> <li>\u00e0 l'expiration de la CA\u00a0;</li> <li>en cas de perte ou de vol de la cl\u00e9 priv\u00e9e du propri\u00e9taire\u00a0;</li> <li>en cas de d\u00e9part du propri\u00e9taire de la soci\u00e9t\u00e9.</li> </ul> <p>Liste des certificats r\u00e9voqu\u00e9s</p> <p>La CRL est un fichier sign\u00e9 par la CA, qui liste les num\u00e9ros de s\u00e9rie des certificats r\u00e9voqu\u00e9s avant leur expiration. Cette liste doit \u00eatre accessible publiquement pour permettre aux utilisateurs de s'assurer que les identit\u00e9s qui leur sont pr\u00e9sent\u00e9es sont encore valides.</p> <p></p> <p>Stockage des identit\u00e9s num\u00e9riques par la CA</p> <p>Lorsque la CA g\u00e9n\u00e8re les bi-cl\u00e9s, il est simple de contr\u00f4ler la robustesse des cl\u00e9s et de les sauvegarder, mais cela n\u00e9cessite la mise en place d'une proc\u00e9dure s\u00e9curis\u00e9e pour d\u00e9livrer son identit\u00e9 \u00e0 un utilisateur final. Il existe pour cela un container prot\u00e9g\u00e9 standardis\u00e9 nomm\u00e9 PKCS#12 qui contient traditionnellement : [cl\u00e9 priv\u00e9e du porteur + certificat du porteur (contenant sa cl\u00e9 publique) + certificat de la CA signataire].</p>"},{"location":"documentation/Stormshield/fiche11_infrastructure_cles_publiques_SNS/#document-2-fonctionnalites-de-la-pki-de-stormshield","title":"Document 2\u00a0: Fonctionnalit\u00e9s de la PKI de Stormshield","text":""},{"location":"documentation/Stormshield/fiche11_infrastructure_cles_publiques_SNS/#authentification-dutilisateurs","title":"Authentification d'utilisateurs","text":"<p>1. L'utilisateur mobile, ou l'administrateur de l'interface web, souhaitant s'authentifier aupr\u00e8s du firewall pr\u00e9sente son certificat utilisateur, soit par son navigateur web, soit par son client VPN IPsec,</p> <p>2. Le firewall v\u00e9rifie la validit\u00e9 du certificat et contr\u00f4le l'identit\u00e9 de l'utilisateur sur le serveur LDAP,</p> <p>3. Les politiques d'acc\u00e8s attach\u00e9es \u00e0 cet utilisateur peuvent alors lui \u00eatre appliqu\u00e9es, pour permettre l'acc\u00e8s aux ressources r\u00e9seau internes.</p>"},{"location":"documentation/Stormshield/fiche11_infrastructure_cles_publiques_SNS/#authentification-de-serveurs-et-ou-de-clients","title":"Authentification de serveurs (et / ou de clients)","text":"<ol> <li> <p>Le serveur, lors de l'initialisation d'une session, pr\u00e9sente son certificat serveur au client, lequel v\u00e9rifie sa validit\u00e9,</p> </li> <li> <p>\u00c9ventuellement, le client pr\u00e9sente son certificat client au serveur, lequel v\u00e9rifie sa validit\u00e9. Lorsque cette \u00e9tape est pr\u00e9sente, il s'agit d'une session avec authentification mutuelle (c'est le cas par exemple d'une session TCP/TLS entre le firewall client et le serveur Syslog Stormshield Visibility Center),</p> </li> <li> <p>Apr\u00e8s l'authentification, le client et le serveur n\u00e9gocient une cl\u00e9 de session.</p> </li> </ol>"},{"location":"documentation/Stormshield/fiche11_infrastructure_cles_publiques_SNS/#authentification-de-passerelles-ipsec","title":"Authentification de passerelles IPSec","text":"<ol> <li> <p>Lors de la phase d'\u00e9tablissement du tunnel, le firewall qui initie le tunnel (Initiator) pr\u00e9sente son certificat \u00e0 la passerelle distante, laquelle v\u00e9rifie sa validit\u00e9,</p> </li> <li> <p>Le firewall qui r\u00e9pond (Responder) pr\u00e9sente son certificat \u00e0 la passerelle distante, laquelle v\u00e9rifie sa validit\u00e9,</p> </li> <li> <p>Outre les v\u00e9rifications effectu\u00e9es sur la validit\u00e9 des certificats pr\u00e9sent\u00e9s (int\u00e9grit\u00e9, signature num\u00e9rique, p\u00e9riode de validit\u00e9, etc.), le certificat de l'autorit\u00e9 de certification ayant sign\u00e9 le certificat de la passerelle distante doit appartenir au groupe de confiance de CA, 'est-\u00e0-dire aux autorit\u00e9s de certification accept\u00e9es dans la politique VPN Ipsec,</p> </li> <li> <p>La v\u00e9rification de l'identit\u00e9 de la passerelle distante permet de garantir que le tunnel est mont\u00e9 avec la passerelle identifi\u00e9e par le certificat, ce point optionnel ne peut \u00eatre d\u00e9fini qu'en CLI.</p> </li> </ol>"},{"location":"documentation/Stormshield/fiche12_vpn_openvpn/","title":"Fiche 12 -- VPN pour utilisateurs nomades","text":""},{"location":"documentation/Stormshield/fiche12_vpn_openvpn/#le-vpn-ssl","title":"Le VPN SSL","text":"<p>Les pare-feux Stormshield int\u00e8grent deux types de VPN SSL qui peuvent \u00eatre utilis\u00e9s simultan\u00e9ment\u00a0:</p> <ul> <li>VPN SSL portail qui permet l'acc\u00e8s aux serveurs Web HTTP et serveurs     applicatifs via le portail captif apr\u00e8s authentification.</li> <li>VPN SSL (complet) qui permet l'acc\u00e8s au r\u00e9seau interne d'une mani\u00e8re     transparente.</li> </ul> <p>La fiche ne concerne que le VPN SSL en mode complet.</p>"},{"location":"documentation/Stormshield/fiche12_vpn_openvpn/#concepts-et-generalites","title":"Concepts et g\u00e9n\u00e9ralit\u00e9s","text":"<p>Le VPN SSL permet \u00e0 des utilisateurs distants d'acc\u00e9der de mani\u00e8re s\u00e9curis\u00e9e aux ressources internes d'une entreprise. Les communications entre l'utilisateur distant et le pare-feu sont encapsul\u00e9es et prot\u00e9g\u00e9es via un tunnel TLS chiffr\u00e9. L'\u00e9tablissement de ce tunnel est bas\u00e9 sur la pr\u00e9sentation de certificats serveur et client sign\u00e9s par une autorit\u00e9 de confiance (CA). Cette solution garantit donc authentification, confidentialit\u00e9, int\u00e9grit\u00e9 et non-r\u00e9pudiation.</p> <p>Au niveau du pare-feu, les tunnels VPN SSL sont g\u00e9r\u00e9s par le serveur OpenVPN (logiciel libre) qui est int\u00e9gr\u00e9 dans le firmware en tant que nouveau service. OpenVPN peut fonctionner sur n'importe quel port TCP (par d\u00e9faut 443) et/ou UDP (par d\u00e9faut 1194), \u00e0 l'exception de quelques-uns, qui sont utilis\u00e9s pour les processus internes du pare-feu.</p> <p>Le fonctionnement sur le port TCP 443 offre un acc\u00e8s ais\u00e9 depuis les r\u00e9seaux avec filtrage d'acc\u00e8s \u00e0 Internet (h\u00f4tels, wifi public, connexion 3G, etc.).</p> <p>En ce qui concerne les utilisateurs nomades, le tunnel est g\u00e9r\u00e9 par le client VPN SSL (Stormshield ou openVPN standard), qui doit \u00eatre install\u00e9 et configur\u00e9 sur les machines. Ce client est installable sur tout type de terminal (Windows, IOS, Android, etc.). Les diff\u00e9rents \u00e9l\u00e9ments de configuration (certificats, fichier de conf, etc.) sont r\u00e9cup\u00e9r\u00e9s sur le portail captif. Une fois le tunnel mis en \u0153uvre, l\\'h\u00f4te distant r\u00e9cup\u00e8re une adresse IP fournie par le serveur VPN SSL. Elle sera consid\u00e9r\u00e9e comme faisant partie des r\u00e9seaux internes (prot\u00e9g\u00e9s) du pare-feu et l'utilisateur sera vu comme authentifi\u00e9.</p> <p>La mise en \u0153uvre du tunnel VPN SSL s'effectue en trois \u00e9tapes principales\u00a0:</p> <p></p> <ol> <li> <p>Le client VPN SSL authentifie l'utilisateur via le portail captif. Durant cette \u00e9tape, le pare-feu v\u00e9rifie si l'utilisateur authentifi\u00e9 poss\u00e8de les droits lui permettant d'ouvrir un tunnel VPN SSL.</p> </li> <li> <p>Si l'authentification r\u00e9ussit, le client envoie une requ\u00eate pour r\u00e9cup\u00e9rer les fichiers de configuration renvoy\u00e9s par le pare-feu dans un dossier compress\u00e9 \u00ab\u00a0openvpn_client.zip\u00a0\u00bb. Le dossier contient les fichiers suivants :</p> <ul> <li>Le certificat de l'autorit\u00e9 de certification (CA.cert.pem),</li> <li>Le certificat du client et sa cl\u00e9 priv\u00e9e (openvpnclient.cert.pem et     openvpnclient.pkey.pem),</li> <li>La configuration du client OpenVPN.</li> </ul> </li> <li> <p>Le client lance le processus de mise en \u0153uvre du tunnel TLS avec authentification par certificat \u00e0 l\\'aide des certificats r\u00e9cup\u00e9r\u00e9s lors de l'\u00e9tape pr\u00e9c\u00e9dente. Avant la mise en \u0153uvre du tunnel, le pare-feu v\u00e9rifie que le nombre maximal d'utilisateurs n'est pas encore atteint et qu'un sous-r\u00e9seau peut \u00eatre r\u00e9serv\u00e9 pour ce nouveau client. Si toutes les conditions sont v\u00e9rifi\u00e9es, le tunnel est mis en \u0153uvre et l'utilisateur est consid\u00e9r\u00e9 comme authentifi\u00e9.</p> </li> </ol> <p>Info</p> <p>Si le serveur VPN SSL est accessible via un port UDP ou TCP, le client VPN SSL tente d'abord de mettre en \u0153uvre le tunnel avec le protocole UDP et en cas d'\u00e9chec, il effectue automatiquement une nouvelle tentative avec le protocole TCP.</p>"},{"location":"documentation/Stormshield/fiche12_vpn_openvpn/#configurer-le-service-vpn-ssl","title":"Configurer le service VPN SSL","text":"<p>Pr\u00e9alables</p> <p>La premi\u00e8re \u00e9tape de mise en \u0153uvre d'un tunnel VPN SSL est l'authentification de l'utilisateur via le portail captif, ce qui signifie :</p> <ul> <li>qu'un annuaire externe ou interne doit \u00eatre configur\u00e9 au niveau du     pare-feu (voir fiche 10)\u00a0;</li> </ul> <p></p> <ul> <li>qu'une m\u00e9thode d'authentification doit \u00eatre configur\u00e9e\u00a0:</li> </ul> <p></p> <ul> <li>qu'un profil du portail captif doit \u00eatre rattach\u00e9 \u00e0 l'interface     depuis laquelle les utilisateurs se connectent\u00a0:</li> </ul> <p></p> <p>Les m\u00e9thodes d'authentification possibles pour le service VPN SSL sont les m\u00e9thodes explicites qui n\u00e9cessitent un couple identifiant/mot de passe, en l'occurrence LDAP (interne, externe ou Microsoft Active Directory), Kerberos et Radius.</p> <p>Des certificats seront utilis\u00e9s pour l'authentification entre le client et le serveur VPN SSL. Pour cela, une autorit\u00e9 de certification racine (CA) existe dans la configuration usine de tous les pare-feux Stormshield Network. Cette CA est nomm\u00e9e sslvpn-full-default-authority, et elle contient un certificat serveur (qui identifie le serveur VPN SSL), et un certificat client (qui identifie tous les clients\u00a0: chacun d'entre eux sera ensuite diff\u00e9renci\u00e9 par un couple login/mot de passe).</p> <p></p> <p>Configuration du serveur SSL</p> <ul> <li>Cliquer sur le module Configuration &gt; VPN &gt; VPN SSL et     activer le Activer le VPN SSL.</li> </ul> <p></p> <p>Param\u00e8tres r\u00e9seaux</p> <ul> <li> <p>Indiquer l'adresse IP ou le FQDN pour lequel le pare-feu Stormshield     Network sera joignable pour \u00e9tablir les tunnels VPN SSL. Ce doit     \u00eatre une adresse IP publique (accessible sur Internet) ou une     adresse IP priv\u00e9e accessible via une redirection.</p> </li> <li> <p>Dans le champ R\u00e9seaux ou machines accessibles, s\u00e9lectionner ou     cr\u00e9er l'objet repr\u00e9sentant les r\u00e9seaux et/ou machines qui seront     joignables au travers du tunnel SSL. Cet objet peut \u00eatre un r\u00e9seau,     une machine ou un groupe incluant des r\u00e9seaux et / ou des machines.</p> </li> </ul> <p>Info</p> <p>Il sera n\u00e9cessaire de d\u00e9finir les routes n\u00e9cessaires pour joindre l'ensemble des ressources et d'affiner les r\u00e8gles de filtrage.</p> <ul> <li> <p>Param\u00e8tres DNS envoy\u00e9s au client</p> </li> <li> <p>Indiquer le suffixe DNS qui sera utilis\u00e9 par les clients pour r\u00e9aliser leurs r\u00e9solutions de noms d'h\u00f4tes.</p> </li> <li> <p>Pr\u00e9ciser les serveurs DNS primaire et secondaire \u00e0 lui attribuer.</p> </li> </ul> <p>Important</p> <p>Les r\u00e9seaux assign\u00e9s aux clients UDP et TCP doivent \u00eatre diff\u00e9rents. Choisir des r\u00e9seaux enti\u00e8rement d\u00e9di\u00e9s aux clients VPN SSL et n'appartenant pas aux r\u00e9seaux internes existants ou d\u00e9clar\u00e9s par une route statique. En effet, l'interface utilis\u00e9e pour le VPN SSL \u00e9tant prot\u00e9g\u00e9e, le pare-feu d\u00e9tecterait alors une tentative d'usurpation d'adresse IP (spoofing) et bloquerait les flux correspondants.</p> <p>Astuce</p> <p>Afin d'\u00e9viter des conflits de routage sur les postes clients lors de la connexion au VPN, choisir plut\u00f4t, pour vos clients VPN, des sous-r\u00e9seaux peu commun\u00e9ment utilis\u00e9s (exemple\u00a0: 10.60.77.0/24, etc.). En effet, de nombreux r\u00e9seaux d'acc\u00e8s internet filtr\u00e9s (wifi public, h\u00f4tels, etc) ou r\u00e9seaux locaux priv\u00e9s utilisent les premi\u00e8res plages d'adresses r\u00e9serv\u00e9es \u00e0 ces usages (exemple\u00a0: 10.0.0.0/24, 192.168.0.0/24).</p> <p>Le nombre maximum de tunnels simultan\u00e9s est automatiquement calcul\u00e9 et affich\u00e9. Par exemple, pour une plage en /24, seules 63 adresses sont disponibles. Cela correspond au minimum des deux valeurs suivantes\u00a0:</p> <ol> <li> <ul> <li>Le quart du nombre d'adresses IP, moins une, incluses dans le         r\u00e9seau client choisi. Un tunnel SSL utilise en effet 4 adresses         IP,</li> <li>Le nombre maximal de tunnels autoris\u00e9s selon le mod\u00e8le de     pare-feu utilis\u00e9.</li> </ul> </li> </ol> <p></p> <ul> <li>S\u00e9lectionner l'objet repr\u00e9sentant l'adresse IP de L'UTM pour     permettre un acc\u00e8s via le port UDP.</li> </ul> <p>Il vous est aussi possible de personnaliser le laps de temps (en secondes) au terme duquel les cl\u00e9s utilis\u00e9es par les algorithmes de chiffrement seront ren\u00e9goci\u00e9es (\u00e9tapes 1 et 2 de l'\u00e9tablissement de tunnel). La valeur par d\u00e9faut est de 4 heures (14400 secondes).</p> <ul> <li>Scripts \u00e0 ex\u00e9cuter sur le client</li> </ul> <p>Vous pouvez s\u00e9lectionner des scripts que Stormshield Network SSL VPN Client ex\u00e9cutera lors de la connexion et/ou d\u00e9connexion au pare-feu (uniquement sur Windows). Il est possible, par exemple, de connecter/d\u00e9connecter automatiquement un lecteur r\u00e9seau Windows par cette m\u00e9thode. Un exemple de script est pr\u00e9sent\u00e9 dans la section Pour aller plus loin.</p> <p></p> <ul> <li>Certificats utilis\u00e9s</li> </ul> <p></p> <p>Les certificats que doivent pr\u00e9senter le service VPN SSL du pare-feu et le client pour \u00e9tablir un tunnel sont cr\u00e9\u00e9s par d\u00e9faut.</p> <p>Si vous choisissez de cr\u00e9er votre propre CA, vous devez utiliser deux certificats, et leur cl\u00e9 priv\u00e9e respective, sign\u00e9s par celle-ci. S'il ne s'agit pas d'une autorit\u00e9 racine, les deux certificats doivent \u00eatre issus de la m\u00eame sous-autorit\u00e9.</p> <p>Configuration des droits d'acc\u00e8s au VPN SSL</p> <ul> <li>Se rendre au menu Configuration &gt; Utilisateurs &gt; Droits     d\\'acc\u00e8s, l'onglet Acc\u00e8s par d\u00e9faut permet d'autoriser ou     d'interdire l'utilisation du VPN SSL \u00e0 l'ensemble des utilisateurs     sans aucune distinction.</li> </ul> <p></p> <p>Pour autoriser des utilisateurs sp\u00e9cifiques (recommand\u00e9 par Stormshield), il faut laisser \u00ab\u00a0Interdire\u00a0\u00bb ici puis\u00a0:</p> <ul> <li>Cliquer sur l'onglet \u00ab\u00a0Acc\u00e8s d\u00e9taill\u00e9\u00a0\u00bb et cliquer sur Ajouter     afin de cr\u00e9er une r\u00e8gle d'acc\u00e8s personnalis\u00e9e.</li> <li>Activer la r\u00e8gle (colonne Etat), s\u00e9lectionner les utilisateurs ou     le groupe d'utilisateurs autoris\u00e9s (colonne Utilisateur -- groupe     d'utilisateurs) et choisir l'action Autoriser dans la colonne     VPN SSL.</li> </ul> <p></p>"},{"location":"documentation/Stormshield/fiche12_vpn_openvpn/#methode-dauthentification","title":"M\u00e9thode d'authentification","text":"<p>D\u00e9finition des r\u00e8gles de filtrage pour autoriser / interdire les flux entre les clients VPN SSL et les ressources internes</p> <ul> <li> <p>Ajouter les r\u00e8gles n\u00e9cessaires de filtrage au pare-feu comme\u00a0:</p> </li> <li> <p>celle autorisant n'importe quelle adresse IP sur Internet \u00e0 se     connecter sur le service VPN (1194/UDP ou 443/TCP) du pare-feu sur     son interface externe\u00a0;</p> </li> </ul> <p></p> <ul> <li>l'initiation de connexions \u00e0 partir des clients VPN SSL et \u00e0     destination des serveurs Web internes</li> <li>permettre aux clients vpn d'acc\u00e9der \u00e0 Internet\u00a0;</li> <li> <p>etc.</p> </li> <li> <p>Ajouter ou modifier si besoin la r\u00e8gle NAT permettant aux clients     d'utiliser le VPN SSL pour acc\u00e9der \u00e0 internet.</p> </li> </ul> <p>Info</p> <p>**Les tunnels VPN SSL sont compatibles avec les fonctions avanc\u00e9es de filtrage du pare-feu Stormshield Network. Les r\u00e8gles de filtrage peuvent donc faire appel aux profils d'inspection, proxies applicatifs, contr\u00f4le antiviral, etc.</p> <p>Info</p> <p>Pour permettre aux clients VPN SSL d'acc\u00e9der au portail d'authentification sur les interfaces associ\u00e9es aux profils d'authentification du pare-feu, la r\u00e8gle de filtrage implicite nomm\u00e9e Autoriser l'acc\u00e8s au portail d'authentification et au VPN SSL pour les interfaces associ\u00e9es aux profils d'authentification (Authd) doit \u00eatre activ\u00e9e.</p> <p>Si tel n'est pas le cas, il est imp\u00e9ratif d'ajouter des r\u00e8gles de filtrage explicites dans la politique active autorisant les flux \u00e0 destination de l'interface publique sur le port d'\u00e9coute du service.</p>"},{"location":"documentation/Stormshield/fiche12_vpn_openvpn/#installation-et-configuration-du-client-vpn-ssl","title":"Installation et configuration du client VPN SSL","text":"<p>Il est possible de configurer un client VPN sur n'importe quel syst\u00e8me d'exploitation. Il ne sera d\u00e9velopp\u00e9 ci-apr\u00e8s que les proc\u00e9dures sur Windows et Linux.</p> <p>Pour aller plus loin au niveau des d\u00e9tails et de l'installation du client sur d'autres syst\u00e8mes\u00a0: https://documentation.stormshield.eu/SNS/v4/fr/Content/SSL_VPN_tunnels/Installation_and_configuration_of_the_client.htm.</p> <p>Sur Windows, il est possible d'utiliser le client VPN de Stormshield. Ce client peut \u00eatre t\u00e9l\u00e9charg\u00e9 sur l'espace priv\u00e9 https://mystormshield.eu et sur le portail captif du pare-feu apr\u00e8s authentification\u00a0:</p> <p></p> <p>Configuration du client VPN SSL Stormshield Network</p> <ul> <li>T\u00e9l\u00e9charger \u00ab\u00a0VPN SSL client\u00a0\u00bb sur le portail captif     (https://(@IP_pare-feu | FQDN_pare-feu)/auth).</li> </ul> <p>Information</p> <p>VPN SSL Client ne peut \u00eatre utilis\u00e9 que sous un seul profil utilisateur Windows. Il doit donc \u00eatre imp\u00e9rativement install\u00e9 sous le profil Windows de l'utilisateur final du logiciel.</p> <p>Vigilence</p> <p>D'autre part, cette installation requiert une \u00e9l\u00e9vation de privil\u00e8ges. Si l'utilisateur ne poss\u00e8de pas les droits d'administration sur le poste de travail, il devra fournir, au cours de l'installation, le nom et le mot de passe d'un compte ayant les droits d'administration.</p> <ul> <li> <p>Faire un double clic sur l'ex\u00e9cutable enregistr\u00e9 sur le poste de     travail.</p> </li> <li> <p>Suivre les diff\u00e9rentes fen\u00eatres propos\u00e9es par l'assistant     d'installation. Seuls le chemin d'installation et un groupe de     programme \u00e0 associer sont \u00e9ventuellement \u00e0 personnaliser.</p> </li> </ul> <p>Le t\u00e9l\u00e9chargement et l'int\u00e9gration des fichiers de configuration sont r\u00e9alis\u00e9s automatiquement lors de l'utilisation de \u00ab\u00a0Stormshield Network SSL VPN Client\u00a0\u00bb. Apr\u00e8s authentification et validation du droit \u00e0 l'utilisation du VPN SSL, le client r\u00e9cup\u00e8re l'ensemble des donn\u00e9es n\u00e9cessaires pour se configurer.</p> <ul> <li> <p>D\u00e9marrer et param\u00e9trer le client. Une fois d\u00e9marr\u00e9, le client VPN     SSL n\u00e9cessite trois param\u00e8tres\u00a0:</p> </li> <li> <p>l'adresse IP ou le FQDN du pare-feu \u00e0 contacter\u00a0:</p> <ul> <li>l'adresse IP ou le FQDN doit bien \u00e9videmment \u00eatre accessible     soit directement soit via une redirection\u00a0;</li> <li> <p>si le port n'est pas le port par d\u00e9faut (1194 en UDP et 443 en     TCP), l'adresse IP ou le FQDN doit \u00eatre suivi de     \u00ab\u00a0:numero_port\u00a0\u00bb</p> <p></p> </li> <li> <p>l'identifiant de l'utilisateur disposant des droits     pour le VPN SSL\u00a0;</p> </li> <li> <p>Le mot de passe de l'utilisateur.</p> </li> </ul> </li> </ul> <p>Une fen\u00eatre indique que la connexion \u00e0 ce site n'est pas s\u00e9curis\u00e9e, car le client ne fait pas confiance \u00e0 la CA signataire du certificat serveur pr\u00e9sent\u00e9 par le portail captif du pare-feu. Il est donc possible :</p> <ul> <li> <p>d'afficher le certificat pour savoir quelle CA l'a sign\u00e9\u00a0;</p> </li> <li> <p>de faire confiance \u00e0 ce certificat, ce qui signifie que la CA est     ajout\u00e9e aux autorit\u00e9s de confiance et qu'il est possible de     continuer avec la configuration du tunnel\u00a0;</p> </li> <li>d'annuler la connexion, ce qui arr\u00eatera la configuration du tunnel.</li> </ul> <p>L'ic\u00f4ne du client VPN SSL Stormshield qui appara\u00eet dans la zone de notification de la barre de t\u00e2ches de Windows poss\u00e8de un code couleur qui correspond \u00e0 son \u00e9tat\u00a0:</p> <ul> <li>Rouge\u00a0: le client est d\u00e9connect\u00e9,</li> <li>Jaune\u00a0: le client essaye de mettre en \u0153uvre le tunnel,</li> <li>Bleu\u00a0: le client est connect\u00e9 (lorsque le client est connect\u00e9, des     informations sur la connexion apparaissent lorsque le curseur de la     souris est positionn\u00e9 sur l'ic\u00f4ne.)</li> </ul> <p>La page de supervision du pare-feu permet de visualiser (et \u00e9ventuellement supprimer en d\u00e9connectant l'utiliateur) les tunnels VPN SSL ouverts dans l'onglet Supervision =&gt; tunnels VPN SSL .</p> <p></p> <p>Les utilisateurs connect\u00e9s via un tunnel VPN SSL sont consid\u00e9r\u00e9s comme authentifi\u00e9s et peuvent \u00eatre visualis\u00e9s dans les traces.</p> <p>Info</p> <p>En cas d'\u00e9chec de la configuration du tunnel, faire un clic droit sur l'ic\u00f4ne VPN SSL Stormshield Network pour afficher les traces.</p> <p>Le client VPN SSL Stormshield poss\u00e8de une fonction de carnet d'adresses, qui peut aider \u00e0 sauvegarder diff\u00e9rents profils VPN dans un seul fichier chiffr\u00e9. Le mot de passe utilis\u00e9 pour prot\u00e9ger le fichier est sp\u00e9cifique. Pour ajouter une entr\u00e9e au carnet d'adresses\u00a0:</p> <ul> <li>Cliquer sur le bouton \u00ab\u00a0Ajouter\u00a0\u00bb, renseigner les d\u00e9tails et cliquer     sur \u00ab\u00a0OK\u00a0\u00bb pour sauvegarder.</li> </ul> <p>Info</p> <p>Il est \u00e9galement possible d'importer/exporter des entr\u00e9es. Le carnet d'adresses se trouve \u00e0 l'emplacement suivant\u00a0:  %USERPROFILE%\\AppData\\Local\\Stormshield\\Stormshield SSL VPN Client\\AddrBook.gap</p> <p>Lorsque le tunnel est mont\u00e9, le poste client disposera d'une interface sp\u00e9cifique au tunnel VPN SSL dont l'adresse IP fait partie de l'objet R\u00e9seau assign\u00e9 au client de la configuration serveur. Les routes n\u00e9cessaires sont automatiquement cr\u00e9\u00e9es. Par exemple sur Linux\u00a0:</p> <pre><code>route -n\n\nTable de routage IP du noyau\n\nDestination Passerelle Genmask Indic Metric Ref Use Iface\n0.0.0.0 10.60.50.5 0.0.0.0 UG 50 0 0 tun0\n10.60.50.0 10.60.50.5 255.255.255.0 UG 50 0 0 tun0\n10.60.50.1 10.60.50.5 255.255.255.255 UGH 50 0 0 tun0\n10.60.50.5 0.0.0.0 255.255.255.255 UH 50 0 0 tun0\n10.61.50.0 10.60.50.5 255.255.255.0 UG 50 0 0 tun0\n10.61.50.1 10.60.50.5 255.255.255.255 UGH 50 0 0 tun0\n172.16.5.0 10.60.50.5 255.255.255.0 UG 50 0 0 tun0\n192.168.5.0 10.60.50.5 255.255.255.128 UG 50 0 0 tun0\n192.168.5.128 10.60.50.5 255.255.255.192 UG 50 0 0 tun0\n192.168.5.192 10.60.50.5 255.255.255.192 UG 50 0 0 tun0\n</code></pre> <p>R\u00e9sultat</p> <p>On peut voir qu'une route par d\u00e9faut est cr\u00e9\u00e9e \u21d2 Du moment que le poste est int\u00e9gr\u00e9 au VPN toutes les communications (y compris l'acc\u00e8s \u00e0 Internet) passe par le pare-feu Stormshield. Il est possible de modifier ce comportement mais cela n'est pas conseill\u00e9 pour des raisons \u00e9videntes de s\u00e9curit\u00e9.</p>"},{"location":"documentation/Stormshield/fiche12_vpn_openvpn/#configuration-du-client-openvpn-ssl-sur-linux","title":"Configuration du client openVPN SSL sur Linux","text":"<p>Le fichier \u00ab\u00a0openvpn_client.zip\u00a0\u00bb doit \u00eatre r\u00e9cup\u00e9r\u00e9 sur portail captif de Stormshield et d\u00e9compress\u00e9. Il comprend le fichier de conf du profil (voir ci-dessous) et les certificats\u00a0:</p> <p><pre><code>dev tun\nremote 192.36.253.50 1194 udp\nremote 192.36.253.50 443 tcp\ncipher AES-256-CBC\ntls-cipher TLS-ECDHE-RSA-WITH-AES-128-CBC-SHA256\nauth SHA256\nnobind\nresolv-retry infinite\npersist-key\npersist-tun\nca \\\"CA.cert.pem\\\"\ncert \\\"openvpnclient.cert.pem\\\"\nkey \\\"openvpnclient.pkey.pem\\\"\ncompress lz4\nverb 0\nauth-user-pass\nauth-retry interact\nauth-nocache\nreneg-sec 0\n</code></pre> Configuration sur Linux en UDP avec network-manager (seuls les \u00e9l\u00e9ments modifi\u00e9s sont pr\u00e9cis\u00e9s)\u00a0:</p> <p></p> <ul> <li> <p>Se rendre au menu Param\u00e8tres / R\u00e9seau et cliquer sur \u00ab\u00a0+\u00a0\u00bb au     niveau du VPN</p> </li> <li> <p>Cliquer sur l'onglet \u00ab\u00a0Identit\u00e9\u00a0\u00bb</p> </li> </ul> <p>Ici, le FQDN \u00ab\u00a0cub.corsica\u00a0\u00bb est r\u00e9solu par l'adresse IP publique et le port 1195 est redirig\u00e9 vers le port UDP/1194 du pare-feu Stormshield.</p> <ul> <li>Cliquer sur \u00ab\u00a0Advanced\u00a0\u00bb</li> </ul> <p></p> <p>Il s'agit ici du port d'\u00e9coute en UDP du serveur VPN configur\u00e9 sur le pare-feu.</p> <p></p> <ul> <li> <p>Cliquer sur l'onglet \u00ab\u00a0S\u00e9curit\u00e9</p> <p> -   Enregistrer en cliquant sur \u00ab\u00a0Appliquer\u00a0\u00bb et activer le VPN</p> </li> </ul> <p>Configuration sur Linux en TCP avec network-manager (seuls les \u00e9l\u00e9ments modifi\u00e9s sont pr\u00e9cis\u00e9s)\u00a0:</p> <p> -   Se rendre au menu Param\u00e8tres / R\u00e9seau et cliquer sur \u00ab\u00a0+\u00a0\u00bb au     niveau du VPN</p> <ul> <li>Cliquer sur l'onglet \u00ab\u00a0Identit\u00e9\u00a0\u00bb</li> </ul> <p>Ici, le FQDN \u00ab\u00a0cub.corsica\u00a0\u00bb est r\u00e9solu par l'adresse IP publique et le port 4435 est redirig\u00e9 vers le port TCP/443 du pare-feu Stormshield.</p> <ul> <li>Cliquer sur \u00ab\u00a0Advanced\u00a0\u00bb</li> </ul> <p></p> <p>Il s'agit ici du port d'\u00e9coute en TCP du serveur VPN configur\u00e9 sur le pare-feu.</p> <ul> <li>Cocher \u00ab\u00a0Utiliser une connexion TCP\u00a0\u00bb car, par d\u00e9faut, le client VPN     initie une connexion UDP\u00a0\u00bb</li> </ul> <p></p> <ul> <li>Enregistrer en cliquant sur \u00ab\u00a0Appliquer\u00a0\u00bb et activer le VPN</li> </ul> <p></p>"},{"location":"documentation/Stormshield/fiche13_vpn_ipsec/","title":"Fiche 13 -- VPN site \u00e0 site","text":""},{"location":"documentation/Stormshield/fiche13_vpn_ipsec/#le-vpn-ipsec","title":"Le VPN IPSec","text":""},{"location":"documentation/Stormshield/fiche13_vpn_ipsec/#concepts-et-generalites","title":"Concepts et g\u00e9n\u00e9ralit\u00e9s","text":"<p>Le tunnel VPN IPsec site-\u00e0-site permet de connecter deux r\u00e9seaux priv\u00e9s via un r\u00e9seau public tout en assurant les services de s\u00e9curit\u00e9 suivants :</p> <ul> <li>l'authentification : permet la v\u00e9rification des identit\u00e9s des     deux extr\u00e9mit\u00e9s de tunnel. Deux m\u00e9thodes d'authentification sont     possibles : cl\u00e9 pr\u00e9-partag\u00e9e (PSK : Pre-Shared key) ou certificats     (PKI : Public Key Infrastructure)\u00a0;</li> <li>l'int\u00e9grit\u00e9 : v\u00e9rifie que les donn\u00e9es n'ont pas \u00e9t\u00e9 modifi\u00e9es en     utilisant les algorithmes de hachage\u00a0;</li> <li>la confidentialit\u00e9 : assure que les donn\u00e9es ne peuvent \u00eatre lues     par une personne tierce capturant le trafic\u00a0;</li> <li>l'anti-rejeu : permet d'ignorer des anciens paquets (des     paquets dont le num\u00e9ro de s\u00e9quence est ant\u00e9rieur \u00e0 un certain seuil)     d\u00e9j\u00e0 re\u00e7us, s'ils sont transmis \u00e0 nouveau.</li> </ul> <p>La n\u00e9gociation du tunnel entre les deux extr\u00e9mit\u00e9s s'effectue avec le protocole ISAKMP (Internet Security Association Key Management Protocol) appel\u00e9 aussi IKE dont la derni\u00e8re version se nomme IKEv2.</p> <p>Une fois le tunnel \u00e9tabli entre les deux \u00e9quipements, les extr\u00e9mit\u00e9s de trafic correspondantes aux r\u00e9seaux priv\u00e9s peuvent communiquer via le protocole ESP (Encapsultating Security Payload) qui assure la confidentialit\u00e9 et l'int\u00e9grit\u00e9 des donn\u00e9es \u00e9chang\u00e9es. Le protocole ESP est encapsul\u00e9 directement dans un datagramme IP.</p> <p></p> <p>Important </p> <p>Dans le respect des bonnes pratiques, il est recommand\u00e9 d'utiliser le protocole IKEv2 pour la mise en \u0153uvre du tunnel et une authentification forte par certificats X509.</p> <p>Vous pouvez bien evidement commencer par un premier test avec une Shared Key (cl\u00e9 partag\u00e9) aux deux extermit\u00e9s du tunnel.</p> <p></p> <p>Phase 1\u00a0: Les deux extr\u00e9mit\u00e9s du tunnel n\u00e9gocient un profil de chiffrement phase 1 et s'authentifient avec un cl\u00e9 pr\u00e9-partag\u00e9e ou des certificats X509. Un dialogue d'application chiffr\u00e9 nomm\u00e9 PARENT-SA permet ensuite de d\u00e9marrer la n\u00e9gociation de la phase 2. Si les deux extr\u00e9mit\u00e9s n'arrivent pas \u00e0 se mettre d'accord sur un profil de chiffrement ou \u00e0 s'authentifier, la n\u00e9gociation s'arr\u00eate imm\u00e9diatement.</p> <p>Phase\u00a02\u00a0: Les deux extr\u00e9mit\u00e9s vont n\u00e9gocier le profil de chiffrement de la phase 2 et les extr\u00e9mit\u00e9s de trafic qui permettront la communication \u00e0 travers le tunnel. Deux canaux sont ouverts pour le transmission des donn\u00e9es, un pour chaque direction. Chaque canal utilise sa propre cl\u00e9 de chiffrement appel\u00e9e CHILD-SA1 et CHILD-SA2. Chaque extr\u00e9mit\u00e9 poss\u00e9dera donc deux cl\u00e9s sym\u00e9triques, une pour chiffrer les donn\u00e9es \u00e0 envoyer et l'autre pour d\u00e9chiffrer les donn\u00e9es re\u00e7ues dans l'autre canal.</p> <p>Attention </p> <p>Les tunnels IPSec sont g\u00e9n\u00e9rallement mont\u00e9 sur des routeurs ayant des IP Publiques.  Quand le Tunnel doit \u00eatre mont\u00e9 sur des routeurs \"cach\u00e9s\" derri\u00e8re du NAT, il faut configurer ce qu'on appelle commun\u00e9ment le NAT-T (NAT Traversal)</p>"},{"location":"documentation/Stormshield/fiche13_vpn_ipsec/#configurer-le-service-vpn-ipsec","title":"Configurer le service VPN IPSec","text":"<p>L'authentification lors de la cr\u00e9ation d'un tunnel VPN IPSec peut se faire de deux fa\u00e7ons\u00a0:</p> <ul> <li>par la d\u00e9finition d'une cl\u00e9 pr\u00e9-partag\u00e9e commune\u00a0;</li> <li>par l'utilisation de certificats X509 cr\u00e9\u00e9s pour chaque extr\u00e9mit\u00e9 \u00e0     l'aide d'une PKI (Infrastructure \u00e0 cl\u00e9s publiques utilisant une     autorit\u00e9 de certification).</li> </ul> <p>L'utilisation de la cl\u00e9 pr\u00e9-partag\u00e9e est d\u00e9conseill\u00e9e en production et valable uniquement lors de phase de tests ou du maquettage. Nous choisirons ici l'authentification par certificats.</p>"},{"location":"documentation/Stormshield/fiche13_vpn_ipsec/#gestion-de-la-pki-du-sns","title":"Gestion de la PKI du SNS","text":"<p>Dans un premier temps, il est donc n\u00e9cessaire de cr\u00e9er une PKI sur l'un des pare-feux puis de cr\u00e9er des certificats serveurs pour chaque extr\u00e9mit\u00e9 du tunnel (ex\u00a0: un certificat pour le pare-feu de edimbourg et un certificat pour le pare-feu de frankfurt).</p> <p>Cliquer sur Configuration &gt; Objets &gt; Certificats et PKI</p> <p></p> <p>Puis sur Ajouter &gt; Autorit\u00e9 racine</p> <p></p> <p></p> <p></p> <p></p> <p>Une fois la nouvelle PKI cr\u00e9\u00e9e, il est n\u00e9cessaire de g\u00e9n\u00e9rer 2 certificats pour les 2 pare-feux concern\u00e9s. Pour cela, s\u00e9lectionner la PKI pki.cub.fr et cliquer sur Ajouter &gt; Identit\u00e9 serveur afin de cr\u00e9er un certificat pour le pare-feu d'Edimbourg.</p> <p></p> <p></p> <p></p> <p></p> <p></p> <p>Il faut ensuite r\u00e9aliser la m\u00eame op\u00e9ration afin de cr\u00e9er un certificat pour le pare-feu de Frankfurt en adaptant certains param\u00e8tres dont en particulier le CN (Common Name) du certificat.</p> <p>Nous avons maintenant \u00e0 notre disposition une PKI et 2 certificats g\u00e9n\u00e9r\u00e9s.</p> <p></p> <p>Comme la PKI a \u00e9t\u00e9 cr\u00e9\u00e9e sur le pare-feu d'Edimbourg, il est n\u00e9cessaire d'exporter le certificat du pare-feu de Frankfurt sur le pare-feu de l'agence de Frankfurt.</p> <p>Pour cela, clique droit sur le certificat concern\u00e9 puis T\u00e9l\u00e9charger &gt; Identit\u00e9 &gt; au format P12. Il est demand\u00e9 d'entrer un mot de passe qui permettra de prot\u00e9ger votre cl\u00e9 priv\u00e9e en particulier en cas de vol ou de compromission.</p> Format P12 <p>Certificat P12 (PKCS#12) - Encodage : Le format P12 est encod\u00e9 en binaire. - Structure : C'est un conteneur binaire qui peut stocker \u00e0 la fois des certificats, des cl\u00e9s priv\u00e9es et m\u00eame des cha\u00eenes de certificats (certificats interm\u00e9diaires et racine). - Utilisation : Le format P12 est utilis\u00e9 pour transporter \u00e0 la fois un certificat et sa cl\u00e9 priv\u00e9e dans un seul fichier, souvent pour les besoins d'import/export (ex. : sur les navigateurs, serveurs ou clients). - Extension de fichier : Les fichiers P12 ont souvent l'extension <code>.p12</code> ou <code>.pfx</code>. - S\u00e9curit\u00e9 : Le fichier P12 peut \u00eatre prot\u00e9g\u00e9 par un mot de passe pour s\u00e9curiser les cl\u00e9s priv\u00e9es qu'il contient. - Lisibilit\u00e9 : Non lisible en texte brut, car c'est un fichier binaire. Il doit \u00eatre ouvert avec des outils sp\u00e9cialis\u00e9s (comme <code>OpenSSL</code> ou les gestionnaires de certificats dans les syst\u00e8mes d'exploitation).</p> <p></p> <p></p> <p>Une fois le fichier p12 t\u00e9l\u00e9charg\u00e9 sur le poste, il est n\u00e9cessaire de l'importer dans l'autre pare-feu en l'occurence celui de Franckfurt. Pour cela, se connecter sur l'interface d'administration du pare-feu concern\u00e9 en s'assurant de disposer du fichier p12 sur le poste client d'administration.</p> <p>Puis cliquer sur Configuration &gt; Objets &gt; Certificats et PKI puis sur Ajouter &gt; Importer un fichier.</p> <p></p> <p></p>"},{"location":"documentation/Stormshield/fiche13_vpn_ipsec/#configuration-du-vpn-ipsec","title":"Configuration du VPN IPSEC","text":"<p>Maintenant que chaque pare-feu dispose de son certificat sign\u00e9 par la PKI pr\u00e9c\u00e9demment cr\u00e9\u00e9e, il s'agit de configurer le tunnel VPN IPSEC sur les deux extr\u00e9mit\u00e9s.</p> <p>Sur le pare-feu de Edimbourg, cliquer sur Configuration &gt; VPN &gt; VPN IPsec et choisir la politique IPsec 04 (04) qu'il faudra renommer IPsec-EdFk.</p> <p></p> <p>Puis cliquer sur Ajouter &gt; Tunnel site \u00e0 site simple.</p> <p>Un assistant s'ouvre et permet de d\u00e9finir quel sous-r\u00e9seau ou VLAN de votre agence (ici Edimbourg) pourra envoyer et recevoir des flux par le tunnel VPN IPSec jusqu'\u00e0 l'autre agence (ici Frankfurt). Ainsi, en ressources locales, indiquer le sous-r\u00e9seau ou le VLAN pr\u00e9sent dans votre agence (si vous souhaitez permettre la communication de plusieurs sous-r\u00e9seaux, il faut au pr\u00e9alable cr\u00e9er un objet groupe contenant l'ensemble des sous-r\u00e9seaux concern\u00e9s).</p> <p>En r\u00e9seaux distants, vous indiquerez un objet r\u00e9seau correspondant au sous-r\u00e9seau \u00e0 joindre dans l'autre agence. Enfin, il sera indispensable de d\u00e9finir un correspondant et de le s\u00e9lectionner.</p> <p></p> <p></p> <p></p> <p>Attention</p> <p>Attention\u00a0! Cette \u00e9tape peut porter \u00e0 confusion. Bien que le terme \u00ab\u00a0identification du correspondant\u00a0\u00bb soit employ\u00e9 ici, c'est bien le certificat du pare-feu sur lequel vous \u00eates connect\u00e9 (ici pare-feu Edimbourg) qu'il faut indiquer et non celui du pare-feu distant.</p> <p></p> <p></p> <p></p> <p>Lorsque la cr\u00e9ation du tunnel IPSec est effective, il faut bien \u00e9videmment l'activer (on) et d\u00e9finir une valeur en seconde de Keepalive (vous veillerez \u00e0 d\u00e9finir la m\u00eame valeur sur le pare-feu distant, ici, Frankfurt). Cela permettra de faciliter l'activation du tunnel et assurera le maintien de ce dernier m\u00eame en cas d'absence de trafic \u00e0 l'int\u00e9rieur de celui-ci (lire l'explication ci-dessous).</p> <p>KeepAlive</p> <p>L'option suppl\u00e9mentaire Keepalive permet de maintenir les tunnels mont\u00e9s de fa\u00e7on artificielle. Cette m\u00e9canique envoie des paquets initialisant et for\u00e7ant le maintien du tunnel. Cette option est d\u00e9sactiv\u00e9e par d\u00e9faut pour \u00e9viter une charge inutile, dans le cas de configuration contenant de nombreux tunnels, mont\u00e9s en m\u00eame temps sans r\u00e9el besoin.</p> <p>Pour activer cette option, affectez une valeur supp\u00e9rieur \u00e0  0, correspondant \u00e0 l'intervalle en seconde, entre chaque envoi de paquet UDP.</p>"},{"location":"documentation/Stormshield/fiche13_vpn_ipsec/#mise-en-uvre-des-regles-de-filtrage-adaptees","title":"Mise en \u0153uvre des r\u00e8gles de filtrage adapt\u00e9es","text":"<p>Pour que la communication par l'interm\u00e9diaire de ce tunnel IPsec soit pleinement fonctionnel, il est n\u00e9cessaire de cr\u00e9er les r\u00e8gles de filtrage permettant d'autoriser la cr\u00e9ation du VPN puis la communication entre les sous-r\u00e9seaux distants.</p> <p>Toujours sur le pare-feu de l'agence d'Edimbourg, il faut autoriser l'\u00e9tablissement du tunnel (protocoles ISAKMP et ESP) entre les deux pare-feux. Normalement, une r\u00e8gle implicite est pr\u00e9vue \u00e0 cet effet, cependant lors de diff\u00e9rentes phases de test, cela s'est av\u00e9r\u00e9 peu concluant, ce qui nous am\u00e8ne \u00e0 proposer des r\u00e8gles explicites \u00e0 ce sujet.</p> <p></p> <p>Enfin, il faut d\u00e9finir les r\u00e8gles n\u00e9cessaires autorisant la communication des sous-r\u00e9seaux d\u00e9finis dans la configuration du tunnel au niveau des r\u00e8gles de filtrage.</p> <p></p> <p>La directive \u00ab\u00a0via Tunnel VPN IPsec\u00a0\u00bb dans la seconde r\u00e8gle est tr\u00e8s importante et obligatoire. Il est possible de la d\u00e9finir lors de la cr\u00e9ation de la r\u00e8gle dans le menu Source &gt; Configuration avanc\u00e9e &gt; Via\u00a0: Tunnel VPN IPSec.</p> <p>\u00c0 partir de l\u00e0, il s'agira de r\u00e9aliser exactement les m\u00eames op\u00e9rations dans le sens inverse sur le pare-feu de l'autre agence (ici Frankfurt) afin de rendre le tunnel pleinement op\u00e9rationnel.</p> <p>Nota Bene</p> <p>NB\u00a0: La plupart des erreurs rencontr\u00e9es proviennent de diff\u00e9rences de configuration entre les deux extr\u00e9mit\u00e9s du tunnel (Profil de chiffrement utilis\u00e9, Keepalive, d\u00e9finition des sous-r\u00e9seaux habilit\u00e9s \u00e0 solliciter le tunnel VPN, etc). Il s'agit donc de faire preuve de rigueur et d'attention sur ces \u00e9l\u00e9ments en particulier.</p>"},{"location":"documentation/Stormshield/fiche13_vpn_ipsec/#gestion-du-nat-traversal-nat-t","title":"Gestion du NAT-Traversal (NAT-T)","text":"<p>Lorsque vous montez un tunnel IPSec entre deux \u00e9quipements Stormshield, ces \u00e9quipements vont chiffrer les paquets et les encapsuler dans le protocole ESP (Encapsulating Security Payload), qui est un protocole de la suite IPSec.</p> <p>Probl\u00e8me : Les routeurs Cisco situ\u00e9s entre les deux \u00e9quipements effectuent du NAT (Network Address Translation). Le NAT pose un probl\u00e8me avec ESP, car :</p> <ul> <li>ESP est un protocole IP (\u201cprotocol 50\u201d) et ne poss\u00e8de pas de num\u00e9ro de port. Cela pose un probl\u00e8me avec le NAT (Network Address Translation) (comme avec TCP ou UDP).</li> <li>Le NAT modifie les adresses IP : Cela casse l\u2019int\u00e9grit\u00e9 du paquet IPSec, car les \u00e9quipements IPSec v\u00e9rifient l\u2019int\u00e9grit\u00e9 des paquets (checksum + hash) et d\u00e9tectent toute modification comme une attaque.</li> </ul> <p>Solution : NAT-Traversal (NAT-T) Pour contourner ce probl\u00e8me, on encapsule les paquets ESP dans de l'UDP/4500.</p> <p>Voici les \u00e9tapes du NAT-T :</p> <ul> <li>D\u00e9tection du NAT : Lors de la phase d\u2019\u00e9tablissement du tunnel IPSec (IKE), les \u00e9quipements Stormshield et Cisco \u00e9changent des messages pour d\u00e9tecter s\u2019il y a un NAT entre eux.</li> <li>L\u2019usage du NAT-T provoquera l\u2019ajout d\u2019un en-t\u00eate UDP de 8 octets.</li> <li>Encapsulation ESP dans UDP/4500 : Une fois le NAT d\u00e9tect\u00e9, les paquets ESP sont encapsul\u00e9s dans des paquets UDP, port 4500, ce qui permet au NAT de fonctionner correctement.</li> <li>D\u00e9capsulation : \u00c0 la r\u00e9ception, l\u2019\u00e9quipement IPSec retire l\u2019en-t\u00eate UDP et traite normalement le paquet ESP.</li> </ul> <p></p> <p>Important</p> <p>NB\u00a0: Certains routeurs supportent l'autodetection de NAT-T, dautres non. Il faut evidement s'adapter au materiel utilis\u00e9. Nos vieux routeurs ne le supporte pas.</p> <p>Si l'\u00e9quipement supporte nativement NAT-T il suffit de l'activer.  Exemple sur un \u00e9quipement cisco:</p> <pre><code>crypto isakmp nat-traversal 20  #Le 20 correspond au d\u00e9lai en secondes pour d\u00e9tecter un NAT.\n</code></pre> <p>Dans le cas contraire, il faut forcer l'activation du NAT-T sur le firewall (Stromshield en l'occurence). et bien configurer la redirection du port UDP 4500 (pour ikeV2). Le port UDP 500 \u00e9tait autrefois utilis\u00e9 pour IKEv1.</p> <pre><code>    ! Activer la redirection des ports UDP 4500 (NAT-T)\nip nat inside source static udp 192.168.1.1 4500 interface GigabitEthernet0/0 4500\n</code></pre>"},{"location":"documentation/Versioning/2--Etckeeper/","title":"Gestion des versions de /etc avec Etckeeper","text":"<p>Information</p> <p>Cette documentation est issue du site de St\u00e9phane Robert, sp\u00e9cialiste de la culture DevOps et DevSecOps. Elle a ainsi \u00e9t\u00e9 retranscrite ici apr\u00e8s obtention pr\u00e9alable de son accord. </p>"},{"location":"documentation/Versioning/2--Etckeeper/#1-pourquoi-mettre-en-place-une-gestion-de-versions-du-repertoire-etc","title":"1. Pourquoi mettre en place une gestion de versions du r\u00e9pertoire /etc ?","text":"<p>Le r\u00e9pertoire /etc contient l\u2019ensemble des fichiers de configuration syst\u00e8me sur une machine Linux. Cela inclut des \u00e9l\u00e9ments aussi critiques que la configuration r\u00e9seau, les comptes utilisateurs, les services d\u00e9marr\u00e9s au boot, les r\u00e8gles de s\u00e9curit\u00e9 et bien plus encore. Si un fichier est accidentellement modifi\u00e9 ou supprim\u00e9, les cons\u00e9quences peuvent \u00eatre lourdes : panne r\u00e9seau, impossibilit\u00e9 de d\u00e9marrer des services essentiels, voire blocage complet du serveur.</p> <p>C\u2019est ici que g\u00e9rer les versions du r\u00e9pertoire /etc avec Git via etckeeper prend tout son sens. Voici pourquoi :</p> <ul> <li>Historique complet des changements : chaque modification est enregistr\u00e9e, dat\u00e9e et associ\u00e9e \u00e0 un auteur. Cela me permet d\u2019identifier facilement quand et pourquoi un changement a \u00e9t\u00e9 fait.</li> <li>Retour en arri\u00e8re simplifi\u00e9 : en cas de probl\u00e8me, je peux restaurer rapidement une ancienne version d\u2019un fichier ou de l\u2019ensemble du r\u00e9pertoire.</li> <li>Audit facilit\u00e9 : lors d\u2019une analyse de s\u00e9curit\u00e9, pouvoir montrer un historique clair de la configuration est un vrai plus.</li> <li>Travail en \u00e9quipe s\u00e9curis\u00e9 : sur des syst\u00e8mes g\u00e9r\u00e9s par plusieurs administrateurs, cela permet d\u2019\u00e9viter des conflits ou des erreurs silencieuses.</li> <li>Sauvegarde efficace : m\u00eame si ce n\u2019est pas une sauvegarde compl\u00e8te du syst\u00e8me, garder une copie versionn\u00e9e de /etc est un \u00e9l\u00e9ment cl\u00e9 d\u2019une bonne strat\u00e9gie de sauvegarde des fichiers /etc.</li> </ul>"},{"location":"documentation/Versioning/2--Etckeeper/#2-installation-detckeeper-sur-debian","title":"2. Installation d'etckeeper sur Debian","text":"<pre><code>sudo apt install etckeeper\n</code></pre> <p>V\u00e9rification de la pr\u00e9sence d'etckeeper sur le syst\u00e8me</p> <pre><code>etckeeper --version\n</code></pre>"},{"location":"documentation/Versioning/2--Etckeeper/#3-choix-du-systeme-de-controle-de-version-vcs","title":"3. Choix du syst\u00e8me de contr\u00f4le de version (VCS)","text":"<p>Par d\u00e9faut, Git est utilis\u00e9, ce qui est parfait pour la majorit\u00e9 des besoins. Si je souhaite utiliser un autre VCS (comme Mercurial ou Bazaar), je peux modifier la ligne suivante :</p> <pre><code>sudoedit /etc/etckeeper/etckeeper.conf\n</code></pre> <pre><code>VCS=\"git\"\n</code></pre> <p>Il est n\u00e9cessaire (si cela n'a pas \u00e9t\u00e9 fait automatiquement) d'initialiser manuellement le d\u00e9p\u00f4t Git pour le r\u00e9pertoire /etc.</p> <p><pre><code>sudo etckeeper init\nsudo etckeeper commit \"Commit inital pour /etc\"\n</code></pre> Cela cr\u00e9e une premi\u00e8re version (snapshot) de l\u2019\u00e9tat actuel de tous les fichiers de configuration.</p>"},{"location":"documentation/Versioning/2--Etckeeper/#4-integration-de-etckeeper-avec-le-gestionnaire-de-paquets-debian-apt","title":"4. Int\u00e9gration de etckeeper avec le gestionnaire de paquets Debian APT","text":"<p>L\u2019un des grands avantages d\u2019etckeeper est son int\u00e9gration automatique avec les gestionnaires de paquets. \u00c0 chaque installation, mise \u00e0 jour ou suppression de paquet, un commit Git est g\u00e9n\u00e9r\u00e9 pour enregistrer les modifications dans_/etc_.</p>"},{"location":"documentation/Versioning/2--Etckeeper/#41-comment-cela-fonctionne","title":"4.1 Comment \u00e7ela fonctionne ?","text":"<p>etckeeper utilise des scripts de hooks qui sont d\u00e9clench\u00e9s automatiquement par le gestionnaire de paquets. \u00c0 chaque op\u00e9ration sur les paquets, un commit automatique est r\u00e9alis\u00e9 si des changements sont d\u00e9tect\u00e9s.</p>"},{"location":"documentation/Versioning/2--Etckeeper/#42-exemple-pratique","title":"4.2 Exemple pratique","text":"<p>Quand j\u2019installe un nouveau paquet avec apt :</p> <pre><code>sudo apt install nginx\n</code></pre> <p>etckeeper va, en coulisses :</p> <ul> <li>Effectuer un commit avant l\u2019installation pour enregistrer l\u2019\u00e9tat actuel.</li> <li>Installer le paquet.</li> <li>Effectuer un commit apr\u00e8s l\u2019installation pour capturer toute modification apport\u00e9e \u00e0 /etc.</li> </ul> <p>Je peux voir les changements avec une simple commande Git :</p> <pre><code>cd /etc\nsudo git log\n</code></pre> <pre><code>commit acd94001bbdb8ed8c0e3196e8c760566d8b546e9 (HEAD -&gt; master)\nAuthor: St\u00e9phane ROBERT &lt;toto@toto.com&gt;\nDate:   Sat Apr 26 12:33:37 2025 +0000\n\n    committing changes in /etc made by \"apt install nginx\"\n\n    Packages with configuration changes:\n    +nginx-common 1.24.0-2ubuntu7.3 all\n\n    Package changes:\n    +nginx 1.24.0-2ubuntu7.3 amd64\n    +nginx-common 1.24.0-2ubuntu7.3 all\n</code></pre>"},{"location":"documentation/Versioning/2--Etckeeper/#43-activation-ou-desactivation-des-commits-automatiques","title":"4.3 Activation ou d\u00e9sactivation des commits automatiques","text":"<p>Dans le fichier /etc/etckeeper/etckeeper.conf, je peux ajuster cette option :</p> <pre><code>sudoedit /etc/etckeeper/etckeeper.conf\n</code></pre> <pre><code>COMMIT_AFTER_INSTALL=\"yes\"\n</code></pre> <p>Si je pr\u00e9f\u00e8re g\u00e9rer manuellement les commits, je peux changer ce param\u00e8tre en \"no\".</p> <p>Gr\u00e2ce \u00e0 cette automatisation des commits de configuration, je garde un historique pr\u00e9cis sans devoir y penser \u00e0 chaque manipulation de mon syst\u00e8me.</p>"},{"location":"documentation/Versioning/2--Etckeeper/#5-gestion-des-metadonnees-et-des-permissions","title":"5. Gestion des m\u00e9tadonn\u00e9es et des permissions","text":"<p>Quand je met en place une gestion de version de /etc avec etckeeper, je dois aussi penser \u00e0 pr\u00e9server les m\u00e9tadonn\u00e9es des fichiers, comme les permissions, les propri\u00e9taires et les groupes. Ces informations sont essentielles pour garantir le bon fonctionnement du syst\u00e8me apr\u00e8s une restauration.</p>"},{"location":"documentation/Versioning/2--Etckeeper/#51-metadonnees-prises-en-charge","title":"5.1 M\u00e9tadonn\u00e9es prises en charge","text":"<p>etckeeper s\u2019occupe automatiquement de pr\u00e9server les m\u00e9tadonn\u00e9es essentielles, telles que :</p> <ul> <li>Les permissions (chmod)</li> <li>Les propri\u00e9taires (chown)</li> <li>Les groupes (chgrp)</li> <li>Les dates de modification (dans certaines configurations)</li> </ul> <p>Pour cela, il g\u00e9n\u00e8re des fichiers sp\u00e9ciaux contenant les m\u00e9tadonn\u00e9es \u00e0 chaque commit. Ces fichiers sont stock\u00e9s dans le d\u00e9p\u00f4t Git sous forme de fichiers suppl\u00e9mentaires, comme :</p> <pre><code>.etckeeper\n.etckeeper-meta\n</code></pre>"},{"location":"documentation/Versioning/2--Etckeeper/#52-activation-de-la-gestion-avancee","title":"5.2 Activation de la gestion avanc\u00e9e","text":"<p>Dans le fichier de configuration /etc/etckeeper/etckeeper.conf, je peux v\u00e9rifier cette option :</p> <pre><code>PRESERVE_METADATA=\"yes\"\n</code></pre> <p>Elle est activ\u00e9e par d\u00e9faut sur la plupart des distributions. Si elle est d\u00e9sactiv\u00e9e, je risque de perdre des r\u00e9glages critiques apr\u00e8s une restauration.</p>"},{"location":"documentation/Versioning/2--Etckeeper/#53-bonnes-pratiques-pour-les-metadonnees","title":"5.3 Bonnes pratiques pour les m\u00e9tadonn\u00e9es","text":"<ul> <li>Toujours r\u00e9aliser un commit apr\u00e8s une modification importante dans /etc pour \u00e9viter d\u2019oublier les changements de permissions.</li> <li>V\u00e9rifier les fichiers de m\u00e9tadonn\u00e9es en cas de migration ou de restauration d\u2019un syst\u00e8me sur une nouvelle machine.</li> <li>Restaurer avec pr\u00e9caution : si je fais un git checkout sur un fichier sensible, je dois m\u2019assurer que ses permissions sont correctement r\u00e9tablies.</li> </ul> <p>Gr\u00e2ce \u00e0 cette gestion des permissions et des propri\u00e9taires, l\u2019usage d\u2019etckeeper devient fiable m\u00eame pour des environnements sensibles o\u00f9 la moindre erreur de droit d\u2019acc\u00e8s pourrait compromettre la s\u00e9curit\u00e9 du syst\u00e8me.</p>"},{"location":"documentation/Versioning/2--Etckeeper/#6-sauvegarde-et-restauration-des-configurations","title":"6. Sauvegarde et restauration des configurations","text":"<p>L\u2019un des principaux atouts d\u2019etckeeper est de faciliter la sauvegarde et la restauration de la configuration syst\u00e8me sans efforts complexes.</p>"},{"location":"documentation/Versioning/2--Etckeeper/#61-sauvegarder-le-repertoire-etc","title":"6.1 Sauvegarder le r\u00e9pertoire /etc","text":"<p>Pour une sauvegarde compl\u00e8te, je m\u2019assure de copier non seulement les fichiers de /etc, mais aussi l\u2019historique Git associ\u00e9. Je peux utiliser une commande simple comme :</p> <pre><code>sudo tar czf etc-backup.tar.gz /etc\n</code></pre> <p>Cela inclut tout le contenu de /etc, y compris le dossier cach\u00e9 .git qui contient l\u2019historique des changements. Je peux ensuite stocker cette archive sur un serveur de sauvegarde externe ou dans une solution de stockage cloud.</p>"},{"location":"documentation/Versioning/2--Etckeeper/#62-restaurer-la-configuration-avec-etckeeper","title":"6.2 Restaurer la configuration avec etckeeper","text":"<p>En cas de probl\u00e8me, je peux restaurer l\u2019archive sauvegard\u00e9e :</p> <pre><code>sudo tar xzf etc-backup.tar.gz -C /\n</code></pre> <p>Puis je peux revenir \u00e0 un \u00e9tat ant\u00e9rieur avec Git :</p> <pre><code>cd /etc\nsudo git log --oneline\nsudo git checkout &lt;id_commit&gt;\n</code></pre> <p>Cela me permet de restaurer rapidement un fichier sp\u00e9cifique ou l\u2019ensemble du r\u00e9pertoire /etc \u00e0 une date donn\u00e9e.</p> <p>Exemple : restaurer un fichier sp\u00e9cifique</p> <p>Si, par exemple, j\u2019ai cass\u00e9 ma configuration nginx, je peux restaurer uniquement ce fichier.</p> <pre><code>cd /etc\nsudo git checkout HEAD^ -- nginx/nginx.conf\n</code></pre> <p>Je r\u00e9cup\u00e8re ainsi la derni\u00e8re version fonctionnelle sans affecter le reste du syst\u00e8me.</p> <p>Gr\u00e2ce \u00e0 la sauvegarde des fichiers /etc avec etckeeper, je b\u00e9n\u00e9ficie d\u2019une solution fiable pour s\u00e9curiser mes configurations critiques et r\u00e9duire le temps de r\u00e9cup\u00e9ration en cas d\u2019incident.</p>"},{"location":"documentation/Versioning/2--Etckeeper/#63-restaurer-des-fichiers-ou-la-totalite-de-etc-avec-etckeeper","title":"6.3 Restaurer des fichiers ou la totalit\u00e9 de /etc avec etckeeper","text":"<p>Avec etckeeper, restaurer une ancienne version de /etc est simple gr\u00e2ce \u00e0 Git.</p> <p>Voir l\u2019historique des changements</p> <p>Listez les commits pass\u00e9s :</p> <pre><code>cd /etc\nsudo git log --oneline\n</code></pre> <p>Exemple : <pre><code>e2d9c24 Ajout de la config SSL nginx\na7d0f91 Commit apr\u00e8s update des paquets\n1f3c6b2 Commit initial\n</code></pre></p>"},{"location":"documentation/Versioning/2--Etckeeper/#64-restaurer-tout-etc-a-un-etat-precedent","title":"6.4 Restaurer tout /etc \u00e0 un \u00e9tat pr\u00e9c\u00e9dent","text":"<p>Si vous voulez restaurer tout le r\u00e9pertoire /etc \u00e0 une version ant\u00e9rieure :</p> <pre><code>sudo git checkout &lt;ID_du_commit&gt;\n</code></pre> <p>Par exemple :</p> <pre><code>sudo git checkout a7d0f91\n</code></pre> <p>Attention</p> <p>Cela remplace l\u2019ensemble du contenu de /etc avec l\u2019\u00e9tat du commit. Pensez \u00e0 faire une sauvegarde avant en cas de doute !</p>"},{"location":"documentation/Versioning/2--Etckeeper/#65-restaurer-un-fichier-specifique","title":"6.5 Restaurer un fichier sp\u00e9cifique","text":"<p>Si seule une partie doit \u00eatre restaur\u00e9e (ex: nginx.conf cass\u00e9) :</p> <pre><code>sudo git checkout &lt;ID_du_commit&gt; -- chemin/vers/le/fichier\n</code></pre> <p>Exemple : <pre><code>sudo git checkout HEAD^ -- nginx/nginx.conf\n</code></pre></p> <p>Cela r\u00e9cup\u00e8re uniquement l\u2019ancien fichier sans toucher au reste.</p>"},{"location":"documentation/Versioning/2--Etckeeper/#66-annuler-des-changements-non-commites","title":"6.6 Annuler des changements non commit\u00e9s","text":"<p>Si vous avez fait des modifications locales non d\u00e9sir\u00e9es :</p> <pre><code>sudo git checkout -- etc/[&lt;dossier&gt;/]&lt;fichier&gt;\n</code></pre> <p>Cela annule les modifications non encore commit\u00e9s.</p>"}]}